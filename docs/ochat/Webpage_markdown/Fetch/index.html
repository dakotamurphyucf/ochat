<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Fetch (ochat.Webpage_markdown.Fetch)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../';
let search_urls = ['../../db.js','../../../sherlodoc.js'];
</script><script src="../../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">Index</a> &#x00BB; <a href="../../index.html">ochat</a> &#x00BB; <a href="../index.html">Webpage_markdown</a> &#x00BB; Fetch</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="ðŸ”Ž Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Webpage_markdown.Fetch</span></code></h1><p>Lightweight HTTP helper to retrieve remote HTML documents.</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#overview">Overview</a></li></ul></nav></div><div class="odoc-content"><h2 id="overview"><a href="#overview" class="anchor"></a>Overview</h2><p>The <code>Fetch</code> module is a single-function API built on top of <a href="../../Io/Net/index.html#val-get"><code>Io.Net.get</code></a>. It takes care of:</p><p>â€¢ Following *only* the HTTPS GET happy-path (no redirects). â€¢ Transparent *gzip* / *deflate* decompression (even when the server forgets to set a <code>Content-Encoding</code> header). â€¢ Basic *content-type* vetting â€“ `text/html`, `text/plain` or no header are accepted; everything else is rejected early. â€¢ A safety cap of 5 MB on the <em>decompressed</em> body to avoid pathological pages.</p><p>The implementation is intentionally minimal because downstream modules (<a href="../Html_to_md/index.html"><code>Webpage_markdown.Html_to_md</code></a>, <a href="../Md_render/index.html"><code>Webpage_markdown.Md_render</code></a> â€¦) only need a raw HTML string â€“ no cookies, no CSP, no streaming.</p><div class="odoc-spec"><div class="spec value anchored" id="val-get"><a href="#val-get" class="anchor"></a><code><span><span class="keyword">val</span> get : <span><span class="label">net</span>:<span><span class="type-var">_</span> <span class="xref-unresolved">Eio</span>.Net.t</span> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(string, string)</span> <span class="xref-unresolved">Core</span>.Result.t</span></span></code></div><div class="spec-doc"><p><code>get ~net url</code> downloads the body of <code>url</code> and returns it as a UTF-8 string.</p><p>A best-effort attempt is made to decompress <code>gzip</code> and <code>deflate</code> payloads. The function fails if the resulting string is larger than five megabytes.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">net</span> <p>Active <code>Eio.Net</code> capability obtained from the ambient environment (e.g. <code>Eio.Stdenv.net env</code>).</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>Ok html</code> on success.</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>Error msg</code> on:</p><ul><li>network failure (timeout, TLS error, â€¦)</li><li>unsupported <code>Content-Type</code> header</li><li>decompressed size &gt; 5 MB</li><li>`application/json` responses â€“ the JSON is returned in <code>msg</code> for diagnostics</li></ul></li></ul></div></div></div></body></html>
