<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Odoc_snippet (ochat.Odoc_snippet)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../';
let search_urls = ['../db.js','../../sherlodoc.js'];
</script><script src="../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">Index</a> &#x00BB; <a href="../index.html">ochat</a> &#x00BB; Odoc_snippet</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="ðŸ”Ž Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Odoc_snippet</span></code></h1><p>Token-bounded slicing of Markdown documentation.</p><p><code>`Odoc_snippet`</code> turns a single Markdown document â€“ typically the result of running</p><pre>  odoc html --output-dir=_doc/_html &lt;pkg&gt;.odoc</pre><p>followed by an HTML-to-Markdown converter â€“ into an array of *snippets* optimised for retrieval-augmented generation systems.</p><p>Each snippet is:</p><p>â€¢ between **64** and **320** BPE tokens (as estimated by <a href="../Tikitoken/index.html#val-encode"><code>Tikitoken.encode</code></a>); â€¢ overlapped by **64** tokens with its neighbour to give the LLM additional context; â€¢ prefixed with a small ocamldoc-style header so that the document viewer can later reconstruct source links.</p><p>The core algorithm is exposed as <a href="#val-slice"><code>slice</code></a>. It is purely functional and CPU-bound â€“ safe to call concurrently from multiple domains.</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#example">Example</a></li><li><a href="#low-level-helpers">Low-level helpers</a></li></ul></nav></div><div class="odoc-content"><h2 id="example"><a href="#example" class="anchor"></a>Example</h2><p>```ocaml let markdown = In_channel.read_all &quot;Switch/index.md&quot; in let snippets = Odoc_snippet.slice ~pkg:&quot;eio&quot; ~doc_path:&quot;Eio/Switch/index.html&quot; ~markdown ~tiki_token_bpe:&quot;ochat-4&quot; () in List.iter snippets ~f:(fun (meta, body) -&gt; printf &quot;id=%s lines=%d-%d\n&quot; meta.id meta.line_start meta.line_end) ```</p><div class="odoc-spec"><div class="spec type anchored" id="type-meta"><a href="#type-meta" class="anchor"></a><code><span><span class="keyword">type</span> meta</span><span> = </span><span>{</span></code><ol><li id="type-meta.id" class="def record field anchored"><a href="#type-meta.id" class="anchor"></a><code><span>id : string;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Stable MD5 of the *full* snippet including header â€“ can be used as a cache key.</p><span class="comment-delim">*)</span></div></li><li id="type-meta.pkg" class="def record field anchored"><a href="#type-meta.pkg" class="anchor"></a><code><span>pkg : string;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Opam package this snippet belongs to (e.g. <code>&quot;core&quot;</code>).</p><span class="comment-delim">*)</span></div></li><li id="type-meta.doc_path" class="def record field anchored"><a href="#type-meta.doc_path" class="anchor"></a><code><span>doc_path : string;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Relative path of the originating HTML page, for example <code>&quot;Eio/Switch/index.html&quot;</code>. Used to build jump-to-source links in UIs.</p><span class="comment-delim">*)</span></div></li><li id="type-meta.title" class="def record field anchored"><a href="#type-meta.title" class="anchor"></a><code><span>title : <span>string option</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>First markdown heading (<code># </code> or <code>## </code>) encountered in the document, if any.</p><span class="comment-delim">*)</span></div></li><li id="type-meta.line_start" class="def record field anchored"><a href="#type-meta.line_start" class="anchor"></a><code><span>line_start : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>1-based inclusive starting line (after HTML-&gt;Markdown conversion).</p><span class="comment-delim">*)</span></div></li><li id="type-meta.line_end" class="def record field anchored"><a href="#type-meta.line_end" class="anchor"></a><code><span>line_end : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Inclusive ending line. Together with <code>line_start</code> this defines the coverage of the snippet within the source document.</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Metadata attached to every snippet.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sexp_of_meta"><a href="#val-sexp_of_meta" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_meta : <span><a href="#type-meta">meta</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Sexplib0</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-meta_of_sexp"><a href="#val-meta_of_sexp" class="anchor"></a><code><span><span class="keyword">val</span> meta_of_sexp : <span><span class="xref-unresolved">Sexplib0</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-meta">meta</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_shape_meta"><a href="#val-bin_shape_meta" class="anchor"></a><code><span><span class="keyword">val</span> bin_shape_meta : <span class="xref-unresolved">Bin_prot</span>.Shape.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_size_meta"><a href="#val-bin_size_meta" class="anchor"></a><code><span><span class="keyword">val</span> bin_size_meta : <span><a href="#type-meta">meta</a> <span class="xref-unresolved">Bin_prot</span>.Size.sizer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_write_meta"><a href="#val-bin_write_meta" class="anchor"></a><code><span><span class="keyword">val</span> bin_write_meta : <span><a href="#type-meta">meta</a> <span class="xref-unresolved">Bin_prot</span>.Write.writer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_writer_meta"><a href="#val-bin_writer_meta" class="anchor"></a><code><span><span class="keyword">val</span> bin_writer_meta : <span><a href="#type-meta">meta</a> <span class="xref-unresolved">Bin_prot</span>.Type_class.writer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_read_meta"><a href="#val-bin_read_meta" class="anchor"></a><code><span><span class="keyword">val</span> bin_read_meta : <span><a href="#type-meta">meta</a> <span class="xref-unresolved">Bin_prot</span>.Read.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-__bin_read_meta__"><a href="#val-__bin_read_meta__" class="anchor"></a><code><span><span class="keyword">val</span> __bin_read_meta__ : <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> <a href="#type-meta">meta</a>)</span> <span class="xref-unresolved">Bin_prot</span>.Read.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_reader_meta"><a href="#val-bin_reader_meta" class="anchor"></a><code><span><span class="keyword">val</span> bin_reader_meta : <span><a href="#type-meta">meta</a> <span class="xref-unresolved">Bin_prot</span>.Type_class.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_meta"><a href="#val-bin_meta" class="anchor"></a><code><span><span class="keyword">val</span> bin_meta : <span><a href="#type-meta">meta</a> <span class="xref-unresolved">Bin_prot</span>.Type_class.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-hash_fold_meta"><a href="#val-hash_fold_meta" class="anchor"></a><code><span><span class="keyword">val</span> hash_fold_meta : 
  <span><span class="xref-unresolved">Ppx_hash_lib</span>.Std.Hash.state <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-meta">meta</a> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppx_hash_lib</span>.Std.Hash.state</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-hash_meta"><a href="#val-hash_meta" class="anchor"></a><code><span><span class="keyword">val</span> hash_meta : <span><a href="#type-meta">meta</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Ppx_hash_lib</span>.Std.Hash.hash_value</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-compare_meta"><a href="#val-compare_meta" class="anchor"></a><code><span><span class="keyword">val</span> compare_meta : <span><a href="#type-meta">meta</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-meta">meta</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-slice"><a href="#val-slice" class="anchor"></a><code><span><span class="keyword">val</span> slice : 
  <span><span class="label">pkg</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">doc_path</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">markdown</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">tiki_token_bpe</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-meta">meta</a> * string)</span> list</span></span></code></div><div class="spec-doc"><p><code>slice ~pkg ~doc_path ~markdown ~tiki_token_bpe ()</code> partitions <code>markdown</code> into overlapping windows and returns them in document order.</p><p>Each returned <code>text</code> begins with a header of the form:</p><pre>(** Package:&lt;pkg&gt; Module:&lt;module_path&gt; Lines:&lt;start&gt;-&lt;end&gt; *)

&lt;body&gt;</pre><p>where <code>module_path</code> is inferred from <code>doc_path</code> (&quot;README&quot; for package top-level READMEs).</p><p>Arguments:</p><p>â€¢ <code>pkg</code> â€” opam package name; â€¢ <code>doc_path</code> â€” relative path of the HTML page the markdown was derived from; â€¢ <code>markdown</code> â€” UTF-8 markdown body to slice; â€¢ <code>tiki_token_bpe</code> â€” JSON BPE definition passed to <a href="../Tikitoken/index.html#val-create_codec"><code>Tikitoken.create_codec</code></a> (e.g. <code>&quot;ochat-4&quot;</code>).</p><p>Returns: a list of <code>(meta, text)</code> pairs in the same order as the source document. No guarantees are made about the exact number of snippets produced except that it is â‰¥ 1 for non-empty input.</p><p>The function never raises; in case of internal tokenisation errors it falls back to a simple length-based heuristic.</p></div></div><h2 id="low-level-helpers"><a href="#low-level-helpers" class="anchor"></a>Low-level helpers</h2><p>The <a href="Chunker/index.html"><code>Chunker</code></a> sub-module is exposed for advanced usage such as interactive viewers or unit tests that need to inspect the raw block segmentation performed by the algorithm. Most applications should stick to <a href="#val-slice"><code>slice</code></a>.</p><div class="odoc-spec"><div class="spec module anchored" id="module-Chunker"><a href="#module-Chunker" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Chunker/index.html">Chunker</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>
