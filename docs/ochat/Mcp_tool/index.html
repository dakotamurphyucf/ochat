<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Mcp_tool (ochat.Mcp_tool)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../';
let search_urls = ['../db.js','../../sherlodoc.js'];
</script><script src="../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">Index</a> &#x00BB; <a href="../index.html">ochat</a> &#x00BB; Mcp_tool</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="ðŸ”Ž Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Mcp_tool</span></code></h1><p>----------------------------------------------------------------------- Remote MCP tool â†’ Ochat_function wrapper</p><p>This helper turns a tool discovered via `tools/list` on an MCP server into a <code>Ochat_function.t</code> that can be exposed to the chat runtime. It hides the JSON-RPC plumbing and converts the wire-level <code>Mcp_types.Tool_result.t</code> into a simple string result that fits the existing Chat_response driver. ------------------------------------------------------------------------</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec module anchored" id="module-Client"><a href="#module-Client" class="anchor"></a><code><span><span class="keyword">module</span> Client</span><span> = <a href="../Mcp_client/index.html">Mcp_client</a></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Tool"><a href="#module-Tool" class="anchor"></a><code><span><span class="keyword">module</span> Tool</span><span> = <a href="../Mcp_types/Tool/index.html">Mcp_types.Tool</a></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Result_"><a href="#module-Result_" class="anchor"></a><code><span><span class="keyword">module</span> Result_</span><span> = <a href="../Mcp_types/Tool_result/index.html">Mcp_types.Tool_result</a></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Jsonaf"><a href="#module-Jsonaf" class="anchor"></a><code><span><span class="keyword">module</span> Jsonaf</span><span> = <a href="../Jsonaf_ext/index.html">Jsonaf_ext</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-string_of_content"><a href="#val-string_of_content" class="anchor"></a><code><span><span class="keyword">val</span> string_of_content : <span><a href="../Mcp_types/Tool_result/index.html#type-content">Result_.content</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Convert one piece of tool output into plain text. * <code>Text</code> â€“ returned unchanged. * <code>Json</code> * <code>Rich</code> â€“ pretty-printed using <a href="../Jsonaf_ext/index.html#val-to_string"><code>Jsonaf_ext.to_string</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-string_of_result"><a href="#val-string_of_result" class="anchor"></a><code><span><span class="keyword">val</span> string_of_result : <span><a href="../Mcp_types/Tool_result/index.html#type-t">Result_.t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Flatten a multi-part <a href="../Mcp_types/Tool_result/index.html#type-t"><code>Mcp_types.Tool_result.t</code></a> into a single newline- separated string.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ochat_function_of_remote_tool"><a href="#val-ochat_function_of_remote_tool" class="anchor"></a><code><span><span class="keyword">val</span> ochat_function_of_remote_tool : 
  <span><span class="label">sw</span>:<span class="xref-unresolved">Eio__core</span>.Switch.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">client</span>:<a href="../Mcp_client/index.html#type-t">Client.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">strict</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Mcp_types/Tool/index.html#type-t">Tool.t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../Ochat_function/index.html#type-t">Ochat_function.t</a></span></code></div><div class="spec-doc"><p><code>ochat_function_of_remote_tool ~sw ~client ~strict tool</code> converts the remote description <code>tool</code> into a fully-callable <a href="../Ochat_function/index.html#type-t"><code>Ochat_function.t</code></a>.</p><p>Parameters: â€¢ <code>sw</code> â€“ parent <code>Eio.Switch.t</code>. The wrapper creates one *daemon* fiber under this switch to print server notifications. When the switch finishes the daemon is cancelled automatically. â€¢ <code>client</code> â€“ already-connected <a href="../Mcp_client/index.html#type-t"><code>Mcp_client.t</code></a>. The caller is responsible for keeping the client alive for at least as long as the returned function may be invoked. â€¢ <code>?strict</code> â€“ forwarded to <a href="../Ochat_function/index.html#val-create_function"><code>Ochat_function.create_function</code></a>. If <code>true</code> (default), the function raises <code>Invalid_argument</code> when OpenAI sends arguments that donâ€™t match <code>tool.input_schema</code>.</p><p>Result: a <a href="../Ochat_function/index.html#type-t"><code>Ochat_function.t</code></a> whose name, description and JSON-schema are copied verbatim from the remote declaration and whose implementation performs a synchronous <code>`tools/call`</code> RPC.</p><p>Example â€“ wrapping the server-side *echo* tool and invoking it:</p><pre class="language-ocaml"><code>  let () =
    Eio_main.run @@ fun env -&gt;
    Eio.Switch.run @@ fun sw -&gt;
      let client =
        Mcp_client.connect ~sw ~env &quot;stdio:python3 -m mcp.reference_server&quot;
      in
      let tools = Mcp_client.list_tools client |&gt; Result.ok_or_failwith in
      let echo_desc = List.find_exn tools ~f:(fun t -&gt; String.equal t.name &quot;echo&quot;) in
      let echo_fn = ochat_function_of_remote_tool ~sw ~client ~strict:true echo_desc in
      let args = `Assoc [ &quot;text&quot;, `String &quot;hi&quot; ] in
      Printf.printf &quot;%s\n&quot; (Ochat_function.call echo_fn args)</code></pre><p>The call prints &quot;hi&quot; and then terminates. Notifications (if any) from the server appear concurrently on <code>stdout</code>.</p></div></div></div></body></html>
