<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Prompt_factory (ochat.Meta_prompting.Prompt_factory)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../';
let search_urls = ['../../db.js','../../../sherlodoc.js'];
</script><script src="../../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">Index</a> &#x00BB; <a href="../../index.html">ochat</a> &#x00BB; <a href="../index.html">Meta_prompting</a> &#x00BB; Prompt_factory</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="ðŸ”Ž Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Meta_prompting.Prompt_factory</span></code></h1><p>Prompt_factory â€“ one-stop **string-only** generator for the so-called *prompt packs* that drive the meta-prompting pipeline.</p><p>A *prompt pack* is a single multiline string that contains every piece of guidance the assistant needs â€“ from the high-level system message down to telemetry guidelines. The exact sections, their names, and their order are dictated by the repositoryâ€™s prompt specification (see <code>meta-prompt/spec/input_schema.json</code>) and must stay stable so that the downstream runner can parse them reliably.</p><p>This module provides two high-level helpers:</p><p>â€¢ <a href="#val-create_pack"><code>create_pack</code></a> â€“ build a brand-new pack from the user intent. â€¢ <a href="#val-iterate_pack"><code>iterate_pack</code></a> â€“ take an *existing* prompt and emit the textual diff / replacement instructions required to reach the next revision.</p><p>Both helpers are **pure** â€“ they perform *no* I/O. That means they can be used inside expect tests and do not need mocking. Any optional or missing field is filled with a conservative default that matches the current repository policies. Adding a new optional field therefore never breaks old call-sites.</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#types">Types</a></li></ul></nav></div><div class="odoc-content"><h2 id="types"><a href="#types" class="anchor"></a>Types</h2><p>The concrete generators are parameterised by a handful of record types that capture *only* the information needed for the task at hand. Keeping the records minimal helps unit-testing and prevents accidental divergence from the advisory schema.</p><div class="odoc-spec"><div class="spec type anchored" id="type-eagerness"><a href="#type-eagerness" class="anchor"></a><code><span><span class="keyword">type</span> eagerness</span><span> = </span></code><ol><li id="type-eagerness.Low" class="def variant constructor anchored"><a href="#type-eagerness.Low" class="anchor"></a><code><span>| </span><span><span class="constructor">Low</span></span></code></li><li id="type-eagerness.Medium" class="def variant constructor anchored"><a href="#type-eagerness.Medium" class="anchor"></a><code><span>| </span><span><span class="constructor">Medium</span></span></code></li><li id="type-eagerness.High" class="def variant constructor anchored"><a href="#type-eagerness.High" class="anchor"></a><code><span>| </span><span><span class="constructor">High</span></span></code></li></ol></div><div class="spec-doc"><p>Eagerness profile â€“ how hard the assistant should push forward before handing control back to the user. The level tunes the behaviour of the &lt;agentic_controls/&gt; section.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-create_params"><a href="#type-create_params" class="anchor"></a><code><span><span class="keyword">type</span> create_params</span><span> = </span><span>{</span></code><ol><li id="type-create_params.agent_name" class="def record field anchored"><a href="#type-create_params.agent_name" class="anchor"></a><code><span>agent_name : string;</span></code></li><li id="type-create_params.goal" class="def record field anchored"><a href="#type-create_params.goal" class="anchor"></a><code><span>goal : string;</span></code></li><li id="type-create_params.success_criteria" class="def record field anchored"><a href="#type-create_params.success_criteria" class="anchor"></a><code><span>success_criteria : <span>string list</span>;</span></code></li><li id="type-create_params.audience" class="def record field anchored"><a href="#type-create_params.audience" class="anchor"></a><code><span>audience : <span>string option</span>;</span></code></li><li id="type-create_params.tone" class="def record field anchored"><a href="#type-create_params.tone" class="anchor"></a><code><span>tone : <span>string option</span>;</span></code></li><li id="type-create_params.domain" class="def record field anchored"><a href="#type-create_params.domain" class="anchor"></a><code><span>domain : <span>string option</span>;</span></code></li><li id="type-create_params.use_responses_api" class="def record field anchored"><a href="#type-create_params.use_responses_api" class="anchor"></a><code><span>use_responses_api : bool;</span></code></li><li id="type-create_params.markdown_allowed" class="def record field anchored"><a href="#type-create_params.markdown_allowed" class="anchor"></a><code><span>markdown_allowed : bool;</span></code></li><li id="type-create_params.eagerness" class="def record field anchored"><a href="#type-create_params.eagerness" class="anchor"></a><code><span>eagerness : <a href="#type-eagerness">eagerness</a>;</span></code></li><li id="type-create_params.reasoning_effort" class="def record field anchored"><a href="#type-create_params.reasoning_effort" class="anchor"></a><code><span>reasoning_effort : <span>[ `Minimal <span>| `Low</span> <span>| `Medium</span> <span>| `High</span> ]</span>;</span></code></li><li id="type-create_params.verbosity_target" class="def record field anchored"><a href="#type-create_params.verbosity_target" class="anchor"></a><code><span>verbosity_target : <span>[ `Low <span>| `Medium</span> <span>| `High</span> ]</span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Parameters required to *create* a brand-new prompt pack. Every field maps 1-to-1 to the advisory schema so that upstream callers can serialise the value to JSON if required.</p><p>Missing optional fields are filled with policy-driven defaults inside <a href="#val-create_pack"><code>create_pack</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_pack"><a href="#val-create_pack" class="anchor"></a><code><span><span class="keyword">val</span> create_pack : <span><a href="#type-create_params">create_params</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">prompt</span>:string <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>create_pack params ~prompt</code> assembles a complete *prompt pack*.</p><p>â€¢ <code>prompt</code> â€“ free-form user instruction that becomes the body of the system message. â€¢ <code>params</code> â€“ see <a href="#type-create_params"><code>create_params</code></a>.</p><p>The resulting string contains â€“ in this order â€“ every mandatory section understood by the runner:</p><p>1. <code>&lt;system_prompt/&gt;</code> 2. <code>&lt;assistant_rules/&gt;</code> 3. <code>&lt;tool_preambles/&gt;</code> 4. <code>&lt;agentic_controls/&gt;</code> 5. <code>&lt;context_gathering/&gt;</code> 6. <code>&lt;formatting_and_verbosity/&gt;</code> 7. Optional <code>&lt;domain_module/&gt;</code> (only when <code>params.domain</code> = <code>Some _</code>) 8. <code>&lt;safety_and_handback/&gt;</code> 9. <code>Recommended_API_Parameters</code> 10. Smoke-test checklist and telemetry boilerplate.</p><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p>Fully-formed prompt pack â€“ **ready to send to the model**.</p></li></ul></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-iterate_params"><a href="#type-iterate_params" class="anchor"></a><code><span><span class="keyword">type</span> iterate_params</span><span> = </span><span>{</span></code><ol><li id="type-iterate_params.goal" class="def record field anchored"><a href="#type-iterate_params.goal" class="anchor"></a><code><span>goal : string;</span></code></li><li id="type-iterate_params.desired_behaviors" class="def record field anchored"><a href="#type-iterate_params.desired_behaviors" class="anchor"></a><code><span>desired_behaviors : <span>string list</span>;</span></code></li><li id="type-iterate_params.undesired_behaviors" class="def record field anchored"><a href="#type-iterate_params.undesired_behaviors" class="anchor"></a><code><span>undesired_behaviors : <span>string list</span>;</span></code></li><li id="type-iterate_params.safety_boundaries" class="def record field anchored"><a href="#type-iterate_params.safety_boundaries" class="anchor"></a><code><span>safety_boundaries : <span>string list</span>;</span></code></li><li id="type-iterate_params.stop_conditions" class="def record field anchored"><a href="#type-iterate_params.stop_conditions" class="anchor"></a><code><span>stop_conditions : <span>string list</span>;</span></code></li><li id="type-iterate_params.reasoning_effort" class="def record field anchored"><a href="#type-iterate_params.reasoning_effort" class="anchor"></a><code><span>reasoning_effort : <span>[ `Minimal <span>| `Low</span> <span>| `Medium</span> <span>| `High</span> ]</span>;</span></code></li><li id="type-iterate_params.verbosity_target" class="def record field anchored"><a href="#type-iterate_params.verbosity_target" class="anchor"></a><code><span>verbosity_target : <span>[ `Low <span>| `Medium</span> <span>| `High</span> ]</span>;</span></code></li><li id="type-iterate_params.use_responses_api" class="def record field anchored"><a href="#type-iterate_params.use_responses_api" class="anchor"></a><code><span>use_responses_api : bool;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Parameters used when *iterating* (refining) an existing prompt pack. All lists may be empty â€“ the function will then emit placeholders to make manual review easier.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-iterate_pack"><a href="#val-iterate_pack" class="anchor"></a><code><span><span class="keyword">val</span> iterate_pack : <span><a href="#type-iterate_params">iterate_params</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">current_prompt</span>:string <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>iterate_pack params ~current_prompt</code> analyses <code>current_prompt</code> and emits an *update pack* â€“ effectively a text-only pull request that explains what to change and why.</p><p>The pack is structured into human-readable sections (<code>Issues_Found</code>, <code>Minimal_Edit_List</code>, â€¦) so that a reviewer can quickly spot the relevant bits.</p><p>Use this helper when the assistant has already produced a prompt but further fine-tuning is needed (e.g. add an extra safety boundary).</p><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p>Update pack string â€“ safe for expect tests.</p></li></ul></div></div></div></body></html>
