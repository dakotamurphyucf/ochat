<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Evaluator (ochat.Meta_prompting.Evaluator)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../';
let search_urls = ['../../db.js','../../../sherlodoc.js'];
</script><script src="../../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">Index</a> &#x00BB; <a href="../../index.html">ochat</a> &#x00BB; <a href="../index.html">Meta_prompting</a> &#x00BB; Evaluator</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="ðŸ”Ž Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Meta_prompting.Evaluator</span></code></h1><p>Promptâ€“answer evaluation framework.</p><p>This module provides a composable set of <i>judges</i> together with a container that aggregates their individual scores into a single scalar. The design centres around two first-class module signatures:</p><p>â€¢ <a href="module-type-Judge/index.html"><code>Judge</code></a> â€“ scores a single candidate answer in isolation. â€¢ <a href="module-type-Pairwise_judge/index.html"><code>Pairwise_judge</code></a> â€“ compares an incumbent answer with a challenger and outputs the win-probability of the challenger.</p><p>An <a href="#type-t"><code>t</code></a> bundles one or more such judges and exposes <a href="#val-evaluate"><code>evaluate</code></a>. The function runs every judge (concurrently when an <code>Eio</code> environment is supplied), combines the raw numbers with an <a href="../Aggregator/index.html"><code>Aggregator</code></a> and memoises the result so that repeated calls with the same candidate are O(1).</p><p>All scores are normalised to the closed interval [0, 1] where 0 denotes a poor / losing answer and 1 denotes an excellent / winning answer. Callers should treat the absolute value as an un-calibrated heuristic. When a judge fails (exception, timeout, missing API key) the framework converts the error into a neutral score of 0.5 to keep downstream logic simple and deterministic in CI.</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#primitive-types">Primitive types</a></li><li><a href="#judge-interfaces">Judge interfaces</a></li><li><a href="#built-in-judges">Built-in judges</a></li><li><a href="#self-consistency-wrapper">Self-consistency wrapper</a></li><li><a href="#evaluator-container">Evaluator container</a></li></ul></nav></div><div class="odoc-content"><h2 id="primitive-types"><a href="#primitive-types" class="anchor"></a>Primitive types</h2><div class="odoc-spec"><div class="spec type anchored" id="type-score"><a href="#type-score" class="anchor"></a><code><span><span class="keyword">type</span> score</span><span> = float</span></code></div><div class="spec-doc"><p>A floating-point score in the range [0, 1]. Higher is better.</p></div></div><h2 id="judge-interfaces"><a href="#judge-interfaces" class="anchor"></a>Judge interfaces</h2><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-Judge"><a href="#module-type-Judge" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-Judge/index.html">Judge</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-Pairwise_judge"><a href="#module-type-Pairwise_judge" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-Pairwise_judge/index.html">Pairwise_judge</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-judge"><a href="#type-judge" class="anchor"></a><code><span><span class="keyword">type</span> judge</span><span> = </span></code><ol><li id="type-judge.Judge" class="def variant constructor anchored"><a href="#type-judge.Judge" class="anchor"></a><code><span>| </span><span><span class="constructor">Judge</span> <span class="keyword">of</span> <span>(<span class="keyword">module</span> <a href="module-type-Judge/index.html">Judge</a>)</span></span></code></li><li id="type-judge.Pairwise_judge" class="def variant constructor anchored"><a href="#type-judge.Pairwise_judge" class="anchor"></a><code><span>| </span><span><span class="constructor">Pairwise_judge</span> <span class="keyword">of</span> <span>(<span class="keyword">module</span> <a href="module-type-Pairwise_judge/index.html">Pairwise_judge</a>)</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Existential wrapper that allows heterogenous judges to coexist in the same list.</p><span class="comment-delim">*)</span></div></li></ol></div></div><h2 id="built-in-judges"><a href="#built-in-judges" class="anchor"></a>Built-in judges</h2><p>The constants below expose commonly used judges so that callers do not need to instantiate them manually. All of them degrade gracefully to a deterministic score of 0.5 when the required OpenAI credentials are absent.</p><div class="odoc-spec"><div class="spec value anchored" id="val-pairwise_arena_judge"><a href="#val-pairwise_arena_judge" class="anchor"></a><code><span><span class="keyword">val</span> pairwise_arena_judge : <span>(<span class="keyword">module</span> <a href="module-type-Pairwise_judge/index.html">Pairwise_judge</a>)</span></span></code></div><div class="spec-doc"><p>Elo-style arena that repeatedly pits prompts against each other and updates their ratings using the logistic Elo formula. The returned score is the updated win-probability of the challenger.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-rubric_critic_judge"><a href="#val-rubric_critic_judge" class="anchor"></a><code><span><span class="keyword">val</span> rubric_critic_judge : <span>(<span class="keyword">module</span> <a href="module-type-Judge/index.html">Judge</a>)</span></span></code></div><div class="spec-doc"><p>JSON-based rubric critic grading <em>correctness</em>, <em>completeness</em>, <em>depth</em>, <em>style</em> and <em>safety</em>. Returns the mean of the five sub-scores normalised to [0, 1].</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-prompt_reward_model_judge"><a href="#val-prompt_reward_model_judge" class="anchor"></a><code><span><span class="keyword">val</span> prompt_reward_model_judge : <span>(<span class="keyword">module</span> <a href="module-type-Judge/index.html">Judge</a>)</span></span></code></div><div class="spec-doc"><p>High-fidelity reward model powered by OpenAIâ€™s *grader* endpoint.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tool_description_reward_model_judge"><a href="#val-tool_description_reward_model_judge" class="anchor"></a><code><span><span class="keyword">val</span> tool_description_reward_model_judge : <span>(<span class="keyword">module</span> <a href="module-type-Judge/index.html">Judge</a>)</span></span></code></div><div class="spec-doc"><p>Same reward-model judge but with a custom rubric for *tool descriptions* (i.e. OpenAI function calling). Returns a scalar in the range [0,1] where higher indicates a better description.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Reward_model_judge"><a href="#module-Reward_model_judge" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Reward_model_judge/index.html">Reward_model_judge</a></span><span> : <a href="module-type-Judge/index.html">Judge</a></span></code></div><div class="spec-doc"><p>Low-level access to the underlying judge modules. These are useful when callers need *first-class* modules instead of the pre-packed functions above. Most users should prefer the aliases exposed via <a href="#val-prompt_reward_model_judge"><code>prompt_reward_model_judge</code></a> and <a href="#val-tool_description_reward_model_judge"><code>tool_description_reward_model_judge</code></a>.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Tool_description_reward_model_judge"><a href="#module-Tool_description_reward_model_judge" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Tool_description_reward_model_judge/index.html">Tool_description_reward_model_judge</a></span><span> : <a href="module-type-Judge/index.html">Judge</a></span></code></div></div><h2 id="self-consistency-wrapper"><a href="#self-consistency-wrapper" class="anchor"></a>Self-consistency wrapper</h2><div class="odoc-spec"><div class="spec type anchored" id="type-sc_strategy"><a href="#type-sc_strategy" class="anchor"></a><code><span><span class="keyword">type</span> sc_strategy</span><span> = </span></code><ol><li id="type-sc_strategy.Mean" class="def variant constructor anchored"><a href="#type-sc_strategy.Mean" class="anchor"></a><code><span>| </span><span><span class="constructor">Mean</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Arithmetic mean of the <code>k</code> runs.</p><span class="comment-delim">*)</span></div></li><li id="type-sc_strategy.Majority" class="def variant constructor anchored"><a href="#type-sc_strategy.Majority" class="anchor"></a><code><span>| </span><span><span class="constructor">Majority</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Majority vote interpreting a score &gt; 0.5 as success.</p><span class="comment-delim">*)</span></div></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-string_of_sc_strategy"><a href="#val-string_of_sc_strategy" class="anchor"></a><code><span><span class="keyword">val</span> string_of_sc_strategy : <span><a href="#type-sc_strategy">sc_strategy</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wrap_self_consistency_judge"><a href="#val-wrap_self_consistency_judge" class="anchor"></a><code><span><span class="keyword">val</span> wrap_self_consistency_judge : 
  <span><span class="label">k</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">strategy</span>:<a href="#type-sc_strategy">sc_strategy</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="keyword">module</span> <a href="module-type-Judge/index.html">Judge</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span>(<span class="keyword">module</span> <a href="module-type-Judge/index.html">Judge</a>)</span></span></code></div><div class="spec-doc"><p><code>wrap_self_consistency_judge ~k ~strategy base</code> runs <code>base</code> <code>k</code> times on the same candidate and combines the outcomes according to <code>strategy</code>.</p></div></div><h2 id="evaluator-container"><a href="#evaluator-container" class="anchor"></a>Evaluator container</h2><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>A collection of judges together with a caching layer and an aggregation function. Use <a href="#val-create"><code>create</code></a> to obtain a fresh value.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : <span><span class="optlabel">?judges</span>:<span><a href="#type-judge">judge</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="optlabel">?aggregate</span>:<a href="../Aggregator/index.html#type-t">Aggregator.t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>create ?judges ?aggregate ()</code> constructs a new evaluator. â€¢ <code>judges</code> â€“ collection of heterogenous judges (defaults to a stub that always returns the neutral score 0.5). â€¢ <code>aggregate</code> â€“ function used to combine the individual scores into a single scalar. Defaults to <a href="../Aggregator/index.html#val-mean"><code>Aggregator.mean</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-default"><a href="#val-default" class="anchor"></a><code><span><span class="keyword">val</span> default : <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Singleton using the module default parameters.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-evaluate"><a href="#val-evaluate" class="anchor"></a><code><span><span class="keyword">val</span> evaluate : 
  <span><span class="optlabel">?env</span>:<span class="xref-unresolved">Eio_unix</span>.Stdenv.base <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?best</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-score">score</a></span></code></div><div class="spec-doc"><p><code>evaluate ?env t ?best candidate</code> obtains a score for <code>candidate</code> by running all judges in <code>t</code> and aggregating the results. Results are cached, therefore repeated calls with the same <code>candidate</code> are effectively free.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-aggregate"><a href="#val-aggregate" class="anchor"></a><code><span><span class="keyword">val</span> aggregate : <span><span><a href="#type-score">score</a> list</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-score">score</a></span></code></div><div class="spec-doc"><p>Legacy helper equal to <a href="../Aggregator/index.html#val-mean"><code>Aggregator.mean</code></a>. New code should pass an explicit <code>aggregate</code> argument to <a href="#val-create"><code>create</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-evaluate_default"><a href="#val-evaluate_default" class="anchor"></a><code><span><span class="keyword">val</span> evaluate_default : <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-score">score</a></span></code></div><div class="spec-doc"><p>Shortcut for <code>evaluate {!val:default}</code>.</p></div></div></div></body></html>
