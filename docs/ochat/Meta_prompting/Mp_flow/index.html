<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Mp_flow (ochat.Meta_prompting.Mp_flow)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../';
let search_urls = ['../../db.js','../../../sherlodoc.js'];
</script><script src="../../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> ‚Äì <a href="../../../index.html">Index</a> &#x00BB; <a href="../../index.html">ochat</a> &#x00BB; <a href="../index.html">Meta_prompting</a> &#x00BB; Mp_flow</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="üîé Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Meta_prompting.Mp_flow</span></code></h1><p>High-level orchestration helpers for *recursive meta-prompting*.</p><p>The two entry-points <a href="#val-first_flow"><code>first_flow</code></a> and <a href="#val-tool_flow"><code>tool_flow</code></a> take an initial draft prompt and iterate a refinement loop powered by <a href="../Recursive_mp/index.html"><code>Recursive_mp</code></a>. Each iteration calls a *proposer* model (GPT-4o by default) to transform the prompt and then evaluates the candidate with an OpenAI reward-model based <a href="../Evaluator/index.html"><code>Evaluator</code></a>. The best-scoring candidate is kept and the process stops once the score plateaus or the fixed maximum number of iterations is reached.</p><p><a href="#val-first_flow"><code>first_flow</code></a> targets *general* prompts whereas <a href="#val-tool_flow"><code>tool_flow</code></a> specialises on *tool descriptions*. Other than the evaluator rubric the control-flow and defaults are identical.</p><p>Both helpers require an <code>Eio_unix.Stdenv.base</code> capability record so that all IO (HTTP requests to the OpenAI API, vector-DB look-ups, ‚Ä¶) is executed inside the caller-supplied event loop.</p><p>Neither function raises; any network or evaluator error degrades gracefully by falling back to conservative defaults provided by the underlying modules.</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#api">API</a></li></ul></nav></div><div class="odoc-content"><div class="odoc-spec"><div class="spec module anchored" id="module-RMP"><a href="#module-RMP" class="anchor"></a><code><span><span class="keyword">module</span> RMP</span><span> = <a href="../Recursive_mp/index.html">Recursive_mp</a></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-E"><a href="#module-E" class="anchor"></a><code><span><span class="keyword">module</span> E</span><span> = <a href="../Evaluator/index.html">Evaluator</a></span></code></div></div><h2 id="api"><a href="#api" class="anchor"></a>API</h2><p>Refine a general prompt using recursive meta-prompting.</p><p><code>first_flow ~env ~task ~prompt ?action ()</code> constructs an initial <code>Prompt_intf.t</code> from <code>task</code> and <code>prompt</code>, spawns a <a href="../Recursive_mp/index.html"><code>Recursive_mp</code></a> loop with a reward-model evaluator and returns the improved <code>body</code> string.</p><p>Parameter description: ‚Ä¢ <code>env</code> ‚Äì Eio capability value obtained from <code>Eio_main.run</code>. ‚Ä¢ <code>task</code> ‚Äì Natural-language description of the user task. It is wrapped in a <code>`&lt;user-task&gt;`</code> XML-like tag so that the LLM transformation agent always receives the full specification. ‚Ä¢ <code>prompt</code> ‚Äì Initial draft prompt to refine. ‚Ä¢ <code>?action</code> ‚Äì Whether to <code>Context.Generate</code> a new prompt or <code>Context.Update</code> an existing one. Defaults to <code>Generate</code>.</p><p>Return value: the refined prompt text ready to be sent to the language model (header and footnotes are stripped).</p><p>Example refining a prompt:</p><pre class="language-ocaml"><code>  let refined =
    Mp_flow.first_flow
      ~env
      ~task:&quot;Summarise the linked article&quot;
      ~prompt:&quot;Read the article and summarise the key points.&quot;
      ()
  in
  print_endline refined</code></pre><div class="odoc-spec"><div class="spec value anchored" id="val-first_flow"><a href="#val-first_flow" class="anchor"></a><code><span><span class="keyword">val</span> first_flow : 
  <span><span class="label">env</span>:<span class="xref-unresolved">Eio_unix</span>.Stdenv.base <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">task</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">prompt</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?action</span>:<a href="../Context/index.html#type-action">Context.action</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  string</span></code></div></div><p>Refine a *tool description* using recursive meta-prompting.</p><p>The only differences to <a href="#val-first_flow"><code>first_flow</code></a> are:</p><p>‚Äì The evaluator judge is switched to <a href="../Evaluator/Tool_description_reward_model_judge/index.html"><code>Evaluator.Tool_description_reward_model_judge</code></a>, which is trained specifically on tool description quality. ‚Äì The context field <code>prompt_type</code> is set to <code>Tool</code> so that the proposer and executor instruction templates match the OpenAI ‚Äúfunction calling‚Äù guidelines.</p><p>All parameters share the same meaning as in <a href="#val-first_flow"><code>first_flow</code></a>.</p><p>Example:</p><pre class="language-ocaml"><code>  let refined_tool =
    Mp_flow.tool_flow
      ~env
      ~task:&quot;Expose a translate function&quot;
      ~prompt:&quot;Translate between English and French.&quot;
      ()
  in
  print_endline refined_tool</code></pre><div class="odoc-spec"><div class="spec value anchored" id="val-tool_flow"><a href="#val-tool_flow" class="anchor"></a><code><span><span class="keyword">val</span> tool_flow : 
  <span><span class="label">env</span>:<span class="xref-unresolved">Eio_unix</span>.Stdenv.base <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">task</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">prompt</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?action</span>:<a href="../Context/index.html#type-action">Context.action</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  string</span></code></div></div></div></body></html>
