<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Markdown_indexer (ochat.Markdown_indexer)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../';
let search_urls = ['../db.js','../../sherlodoc.js'];
</script><script src="../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">Index</a> &#x00BB; <a href="../index.html">ochat</a> &#x00BB; Markdown_indexer</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="ðŸ”Ž Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Markdown_indexer</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-index_directory"><a href="#val-index_directory" class="anchor"></a><code><span><span class="keyword">val</span> index_directory : 
  <span><span class="optlabel">?vector_db_root</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">env</span>:<span class="xref-unresolved">Eio_unix</span>.Stdenv.base <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">index_name</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">description</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">root</span>:<span><span class="type-var">_</span> <span class="xref-unresolved">Eio</span>.Path.t</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>index_directory ?vector_db_root ~env ~index_name ~description ~root</code> indexes every Markdown document under directory <code>root</code>.</p><p>The function performs the following high-level steps:</p><p>1. Traverse <code>root</code> recursively using <a href="../Markdown_crawler/index.html#val-crawl"><code>Markdown_crawler.crawl</code></a>. All files whose basename ends with <code>&quot;.md&quot;</code>, <code>&quot;.markdown&quot;</code> or <code>&quot;.mdown&quot;</code> and whose size is in the range (0&amp;nbsp;B, 10&amp;nbsp;MiB] are passed to the pipeline. 2. Each document is cut into overlapping, token-bounded windows using <a href="../Markdown_snippet/index.html#val-slice"><code>Markdown_snippet.slice</code></a>. Window ids are stable MD5 hashes of the file path and byte offsets which makes the operation idempotent â€“ re-indexing the same directory leaves existing embeddings untouched. 3. All snippets are embedded in batches via <a href="../Embed_service/index.html#val-create"><code>Embed_service.create</code></a> which wraps the OpenAI <em>Embeddings</em> endpoint with retry logic and a configurable request rate. 4. The resulting dense vectors are written to <code>&lt;vector_db_root&gt;/&lt;index_name&gt;/vectors.binio</code> using <a href="../Vector_db/Vec/index.html#val-write_vectors_to_disk"><code>Vector_db.Vec.write_vectors_to_disk</code></a>. Each snippet body is stored as a separate Markdown file below <code>snippets/</code>. 5. Finally, a centroid vector is computed and the global catalogue <code>&lt;vector_db_root&gt;/md_index_catalog.binio</code> is updated via <a href="../Md_index_catalog/index.html#val-add_or_update"><code>Md_index_catalog.add_or_update</code></a> so that the new index becomes discoverable by <a href="../Vector_db/index.html"><code>Vector_db</code></a>-based search helpers.</p><p>All I/O is executed through Eioâ€™s non-blocking API and therefore runs in the callerâ€™s fibre. The whole operation is cancel-safe and can be composed with other Eio code.</p><p>Parameters: â€¢ <code>vector_db_root</code> â€“ top-level directory holding one sub-directory per logical index (default <code>&quot;.md_index&quot;</code>). â€¢ <code>env</code> â€“ standard Eio environment obtained from <code>Eio_main.run</code>. â€¢ <code>index_name</code> â€“ unique identifier of the index, used as on-disk folder name and as catalogue key. â€¢ <code>description</code> â€“ free-text summary shown in UIs. â€¢ <code>root</code> â€“ directory tree to be indexed.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Failure</code> <p>if <code>root</code> does not exist or is not a directory.</p></li></ul></div></div></div></body></html>
