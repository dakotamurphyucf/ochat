<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Session (ochat.Session)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../';
let search_urls = ['../db.js','../../sherlodoc.js'];
</script><script src="../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> ‚Äì <a href="../../index.html">Index</a> &#x00BB; <a href="../index.html">ochat</a> &#x00BB; Session</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="üîé Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Session</span></code></h1><p>Persistent chat session state.</p><p>A value of type <a href="#type-t"><code>t</code></a> bundles everything the assistant needs to restore a chat between two executions of the binary:</p><p>* the system/user prompt file that seeded the conversation * the full message exchange with OpenAI (the <a href="History/index.html"><code>History</code></a>) * an optional lightweight task-list * arbitrary key/value metadata * a virtual file-system (VFS) root used by tooling</p><p>The module handles **schema migrations** transparently via the <a href="Legacy/index.html"><code>Legacy</code></a> sub-module. Every serialised snapshot embeds its authoring version; upon deserialisation the value is upgraded to <a href="#val-current_version"><code>current_version</code></a> so callers always operate on the latest layout.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec module anchored" id="module-History"><a href="#module-History" class="anchor"></a><code><span><span class="keyword">module</span> <a href="History/index.html">History</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Task"><a href="#module-Task" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Task/index.html">Task</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Task tracking for ‚Äúaction items‚Äù discovered during the chat.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-current_version"><a href="#val-current_version" class="anchor"></a><code><span><span class="keyword">val</span> current_version : int</span></code></div><div class="spec-doc"><p>Schema version emitted by the current binary. Increment whenever the latest <a href="#type-t"><code>t</code></a> becomes incompatible with its previous shape.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span><span> = </span><span>{</span></code><ol><li id="type-t.version" class="def record field anchored"><a href="#type-t.version" class="anchor"></a><code><span>version : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Authoring schema version.</p><span class="comment-delim">*)</span></div></li><li id="type-t.id" class="def record field anchored"><a href="#type-t.id" class="anchor"></a><code><span>id : string;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Globally-unique session identifier.</p><span class="comment-delim">*)</span></div></li><li id="type-t.prompt_file" class="def record field anchored"><a href="#type-t.prompt_file" class="anchor"></a><code><span>prompt_file : string;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Absolute path of the source prompt file.</p><span class="comment-delim">*)</span></div></li><li id="type-t.local_prompt_copy" class="def record field anchored"><a href="#type-t.local_prompt_copy" class="anchor"></a><code><span>local_prompt_copy : <span>string option</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Optional prompt copy inside the session directory.</p><span class="comment-delim">*)</span></div></li><li id="type-t.history" class="def record field anchored"><a href="#type-t.history" class="anchor"></a><code><span>history : <a href="History/index.html#type-t">History.t</a>;</span></code></li><li id="type-t.tasks" class="def record field anchored"><a href="#type-t.tasks" class="anchor"></a><code><span>tasks : <span><a href="Task/index.html#type-t">Task.t</a> list</span>;</span></code></li><li id="type-t.kv_store" class="def record field anchored"><a href="#type-t.kv_store" class="anchor"></a><code><span>kv_store : <span><span>(string * string)</span> list</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Arbitrary metadata keyed by user-defined strings.</p><span class="comment-delim">*)</span></div></li><li id="type-t.vfs_root" class="def record field anchored"><a href="#type-t.vfs_root" class="anchor"></a><code><span>vfs_root : string;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Root directory for virtual files.</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Latest on-disk representation (post-migration).</p></div></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <span class="xref-unresolved">Core</span>.Bin_prot.Binable.S <span class="keyword">with</span> <span><span class="keyword">type</span> <span class="xref-unresolved">t</span> := <span class="xref-unresolved">t</span></span></span></code></summary><div class="odoc-spec"><div class="spec value anchored" id="val-bin_size_t"><a href="#val-bin_size_t" class="anchor"></a><code><span><span class="keyword">val</span> bin_size_t : <span><a href="#type-t">t</a> <span class="xref-unresolved">Bin_prot__</span>.Size.sizer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_write_t"><a href="#val-bin_write_t" class="anchor"></a><code><span><span class="keyword">val</span> bin_write_t : <span><a href="#type-t">t</a> <span class="xref-unresolved">Bin_prot__</span>.Write.writer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_read_t"><a href="#val-bin_read_t" class="anchor"></a><code><span><span class="keyword">val</span> bin_read_t : <span><a href="#type-t">t</a> <span class="xref-unresolved">Bin_prot__</span>.Read.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-__bin_read_t__"><a href="#val-__bin_read_t__" class="anchor"></a><code><span><span class="keyword">val</span> __bin_read_t__ : <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a>)</span> <span class="xref-unresolved">Bin_prot__</span>.Read.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_shape_t"><a href="#val-bin_shape_t" class="anchor"></a><code><span><span class="keyword">val</span> bin_shape_t : <span class="xref-unresolved">Bin_prot__</span>.Shape.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_writer_t"><a href="#val-bin_writer_t" class="anchor"></a><code><span><span class="keyword">val</span> bin_writer_t : <span><a href="#type-t">t</a> <span class="xref-unresolved">Bin_prot__</span>.Type_class.writer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_reader_t"><a href="#val-bin_reader_t" class="anchor"></a><code><span><span class="keyword">val</span> bin_reader_t : <span><a href="#type-t">t</a> <span class="xref-unresolved">Bin_prot__</span>.Type_class.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_t"><a href="#val-bin_t" class="anchor"></a><code><span><span class="keyword">val</span> bin_t : <span><a href="#type-t">t</a> <span class="xref-unresolved">Bin_prot__</span>.Type_class.t</span></span></code></div></div></details></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <span class="xref-unresolved">Sexplib0</span>.Sexpable.S <span class="keyword">with</span> <span><span class="keyword">type</span> <span class="xref-unresolved">t</span> := <span class="xref-unresolved">t</span></span></span></code></summary><div class="odoc-spec"><div class="spec value anchored" id="val-t_of_sexp"><a href="#val-t_of_sexp" class="anchor"></a><code><span><span class="keyword">val</span> t_of_sexp : <span><span class="xref-unresolved">Sexplib0__</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sexp_of_t"><a href="#val-sexp_of_t" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_t : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Sexplib0__</span>.Sexp.t</span></code></div></div></details></div><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : 
  <span><span class="optlabel">?id</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">prompt_file</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?local_prompt_copy</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?history</span>:<a href="History/index.html#type-t">History.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?tasks</span>:<span><a href="Task/index.html#type-t">Task.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?kv_store</span>:<span><span>(string * string)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?vfs_root</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>create ?id ?local_prompt_copy ?history ?tasks ?kv_store ?vfs_root ~prompt_file ()</code> constructs a brand-new session value.</p><p>All optional arguments default to the empty/neutral value except <code>id</code> which ‚Äì when omitted ‚Äì is auto-generated just like in <a href="Task/index.html#val-create"><code>Task.create</code></a>.</p><p>Example ‚Äì start a session for <code>docs/prompt.txt</code>:</p><pre class="language-ocaml"><code>  let open Session in
  let s = create ~prompt_file:&quot;docs/prompt.txt&quot; () in
  ...</code></pre></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-reset"><a href="#val-reset" class="anchor"></a><code><span><span class="keyword">val</span> reset : <span><span class="optlabel">?prompt_file</span>:string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>reset ?prompt_file session</code> returns **a copy** of <code>session</code> with an empty <a href="#type-t.history"><code>history</code></a>. Use it when the conversation should start over while preserving bookkeeping and VFS content.</p><p>The prompt path is overwritten when <code>prompt_file</code> is supplied.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-reset_keep_history"><a href="#val-reset_keep_history" class="anchor"></a><code><span><span class="keyword">val</span> reset_keep_history : <span><span class="optlabel">?prompt_file</span>:string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>reset_keep_history ?prompt_file session</code> behaves like <a href="#val-reset"><code>reset</code></a> but keeps the current message history intact. Only the prompt file may change.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Latest"><a href="#module-Latest" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Latest/index.html">Latest</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Legacy"><a href="#module-Legacy" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Legacy/index.html">Legacy</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Previous schema versions plus upgrade paths to <a href="Latest/index.html"><code>Latest</code></a>.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Io"><a href="#module-Io" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Io/index.html">Io</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Convenience wrappers for `Bin_prot_utils_eio` so that callers can persist or restore a session snapshot from within an Eio fiber.</p></div></div></div></body></html>
