<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Oauth2_client_store (ochat.Oauth2_client_store)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../';
let search_urls = ['../db.js','../../sherlodoc.js'];
</script><script src="../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">Index</a> &#x00BB; <a href="../index.html">ochat</a> &#x00BB; Oauth2_client_store</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="ðŸ”Ž Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Oauth2_client_store</span></code></h1><p>Cache OAuth 2.0 dynamic-registration credentials on disk.</p><p>A successful Dynamic Client Registration (RFC 7591) returns a <code>client_id</code> â€“ and sometimes a <code>client_secret</code> â€“ that should be re-used on subsequent exchanges with the same issuer. Creating a new client for every invocation is wasteful and often rate-limited. This module persistently stores the credentials so that independent CLI runs share a single identifier.</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#storage-layout">Storage layout</a></li></ul></nav></div><div class="odoc-content"><h2 id="storage-layout"><a href="#storage-layout" class="anchor"></a>Storage layout</h2><p>â€¢ Location : <code>$XDG_CONFIG_HOME/ocamlochat/registered.json</code> (or <code>$HOME/.config/ocamlochat/registered.json</code> as a fallback).</p><p>â€¢ Structure : a JSON object mapping issuer URLs â†’ credential â€“ e.g.</p><pre class="language-ocaml"><code>  &quot;https://auth.example&quot; : {
    &quot;client_id&quot;     : &quot;abc&quot;,
    &quot;client_secret&quot; : &quot;s3cr3t&quot;
  }</code></pre><div class="odoc-spec"><div class="spec module anchored" id="module-Credential"><a href="#module-Credential" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Credential/index.html">Credential</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-lookup"><a href="#val-lookup" class="anchor"></a><code><span><span class="keyword">val</span> lookup : <span><span class="label">env</span>:<span class="xref-unresolved">Eio_unix</span>.Stdenv.base <span class="arrow">&#45;&gt;</span></span> <span><span class="label">issuer</span>:string <span class="arrow">&#45;&gt;</span></span> <span><a href="Credential/index.html#type-t">Credential.t</a> option</span></span></code></div><div class="spec-doc"><p><code>lookup ~env ~issuer</code> returns the cached credentials for <code>issuer</code> or <code>None</code> when the issuer is unknown.</p><p>The function never raises â€“ malformed, unreadable, or missing files are treated as an empty cache.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-store"><a href="#val-store" class="anchor"></a><code><span><span class="keyword">val</span> store : <span><span class="label">env</span>:<span class="xref-unresolved">Eio_unix</span>.Stdenv.base <span class="arrow">&#45;&gt;</span></span> <span><span class="label">issuer</span>:string <span class="arrow">&#45;&gt;</span></span> <span><a href="Credential/index.html#type-t">Credential.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>store ~env ~issuer cred</code> writes <code>cred</code> as the credentials for <code>issuer</code>, replacing any previous value.</p><p>The operation is atomic: it writes to a <code>*.tmp</code> file first and then <code>Eio.Path.rename</code>s the result. The final file mode is <code>0o600</code>.</p></div></div></div></body></html>
