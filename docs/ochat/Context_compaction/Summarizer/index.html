<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Summarizer (ochat.Context_compaction.Summarizer)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../';
let search_urls = ['../../db.js','../../../sherlodoc.js'];
</script><script src="../../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">Index</a> &#x00BB; <a href="../../index.html">ochat</a> &#x00BB; <a href="../index.html">Context_compaction</a> &#x00BB; Summarizer</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="ðŸ”Ž Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Context_compaction.Summarizer</span></code></h1><p>Conversation summariser used by <a href="../index.html"><code>Context_compaction</code></a>.</p><p>A compaction cycle starts with <a href="../Relevance_judge/index.html"><code>Relevance_judge</code></a> selecting a subset of the chat history that must survive. This module converts that list of <a href="../../Openai/Responses/Item/index.html"><code>Openai.Responses.Item</code></a> values into a **single textual summary** that subsequently replaces the original messages. The aim is to reduce token usage without losing critical context for the next model call.</p><p>Two execution modes are supported:</p><p>â€¢ <em>Online</em> â€“ triggered when an <code>OPENAI_API_KEY</code> is available and a capability-based *Eio* environment is provided. In this mode <a href="../../Openai/Responses/index.html#val-post_response"><code>Openai.Responses.post_response</code></a> is invoked with a handcrafted system prompt (see the <code>prompt</code> constant in <code>file:summarizer.ml</code>). The call uses model <code>`Gpt4_1`</code>, a temperature of 0.3 and a generous <code>max_output_tokens</code> limit of 100_000 to avoid premature truncation.</p><p>â€¢ <em>Offline stub</em> â€“ activated whenever the API key or the environment is missing, or if the online call throws. We shove the conversation transcript through a 2â€‰000-character truncate and return the result verbatim. This deterministic path is just for unit tests.</p><p>All errors are handled internally; the public API is synchronous and exception-free.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-summarise"><a href="#val-summarise" class="anchor"></a><code><span><span class="keyword">val</span> summarise : 
  <span><span class="label">relevant_items</span>:<span><a href="../../Openai/Responses/Item/index.html#type-t">Openai.Responses.Item.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">env</span>:<span><span class="xref-unresolved">Eio_unix</span>.Stdenv.base option</span> <span class="arrow">&#45;&gt;</span></span>
  string</span></code></div><div class="spec-doc"><p><code>summarise ~relevant_items ~env</code> synthesises a concise summary of <code>relevant_items</code>.</p><p>Parameters â€¢ <code>relevant_items</code> â€“ ordered sub-sequence of the conversation that must survive compaction. Items may originate from the user, the assistant, or be function/tool-call artefacts.</p><p>â€¢ <code>env</code> â€“ optional <code>Eio_unix.Stdenv.base</code>. Passing <code>None</code> unequivocally selects the offline stub. When <code>Some</code>, the online path is attempted (and silently downgraded to the stub on any failure).</p><p>Returns an UTF-8 encoded string safe for direct injection into a system or developer message.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Never</code> <p>â€“ all internal failures are converted into the stub output.</p></li></ul></div></div></div></body></html>
