<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Config (ochat.Context_compaction.Config)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../';
let search_urls = ['../../db.js','../../../sherlodoc.js'];
</script><script src="../../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">Index</a> &#x00BB; <a href="../../index.html">ochat</a> &#x00BB; <a href="../index.html">Context_compaction</a> &#x00BB; Config</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="ðŸ”Ž Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Context_compaction.Config</span></code></h1><p>Persistent configuration record used by the context-compaction pipeline.</p><p>Applications can ship a user-writable JSON file to tweak the heuristics employed by <a href="../Relevance_judge/index.html"><code>Context_compaction.Relevance_judge</code></a> and <a href="../Summarizer/index.html"><code>Context_compaction.Summarizer</code></a>. If no file is found the library falls back on the hard-coded <a href="#val-default"><code>default</code></a> parameters so that it remains completely dependency-free and offline-friendly.</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#json-schema">JSON schema</a></li><li><a href="#search-path">Search path</a></li><li><a href="#usage-example">Usage example</a></li></ul></nav></div><div class="odoc-content"><h2 id="json-schema"><a href="#json-schema" class="anchor"></a>JSON schema</h2><p>The configuration file must contain a single JSON object with any combination of the following keys:</p><ul><li><code>&quot;context_limit&quot;</code> â€“ maximum number of tokens that the relevance judge is allowed to inspect before deciding which messages to keep. Defaults to <code>default.context_limit</code>.</li><li><code>&quot;relevance_threshold&quot;</code> â€“ minimum score (in the inclusive range <a href="https://en.wikipedia.org/wiki/Unit_interval"><code>0.0, 1.0</code></a>) a message has to achieve in order to survive filtering. Defaults to <code>default.relevance_threshold</code>.</li></ul><p>Unknown keys are silently ignored so that future versions can add more parameters without breaking backwards compatibility.</p><h2 id="search-path"><a href="#search-path" class="anchor"></a>Search path</h2><p><code>load</code> inspects the following locations, returning the first file that exists and parses successfully:</p><ol><li><code>$XDG_CONFIG_HOME/ochat/context_compaction.json</code> or, if the variable is unset, <code>$HOME/.config/ochat/context_compaction.json</code>;</li><li><code>$HOME/.ochat/context_compaction.json</code>.</li></ol><p>Malformed JSON files are skipped. If no valid file is found the default configuration is returned.</p><h2 id="usage-example"><a href="#usage-example" class="anchor"></a>Usage example</h2><pre class="language-ocaml"><code>  let cfg = Context_compaction.Config.load () in
  let open Context_compaction in
  let judge =
    Relevance_judge.create
      ~context_limit:cfg.context_limit
      ~threshold:cfg.relevance_threshold
  in
  (* â€¦ *)</code></pre><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span><span> = </span><span>{</span></code><ol><li id="type-t.context_limit" class="def record field anchored"><a href="#type-t.context_limit" class="anchor"></a><code><span>context_limit : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Maximum number of tokens that can be considered when computing relevance.</p><span class="comment-delim">*)</span></div></li><li id="type-t.relevance_threshold" class="def record field anchored"><a href="#type-t.relevance_threshold" class="anchor"></a><code><span>relevance_threshold : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Messages with a relevance score **â‰¥** this threshold are preserved.</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-default"><a href="#val-default" class="anchor"></a><code><span><span class="keyword">val</span> default : <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Hard-coded defaults used when no configuration file is present.</p><p>By default the library is conservative and keeps as much context as reasonably possible while discarding messages with a very low importance score:</p><pre class="language-ocaml"><code>  { context_limit = 20_000;
    relevance_threshold = 0.5; }</code></pre></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-load"><a href="#val-load" class="anchor"></a><code><span><span class="keyword">val</span> load : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>load ()</code> returns the first valid configuration found in the *search&amp;nbsp;path* (see the <b>Search path</b> section above) or <a href="#val-default"><code>default</code></a> if none is available. The function never raises â€“ unreadable or malformed files are skipped.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Compact_config"><a href="#module-Compact_config" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Compact_config/index.html">Compact_config</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Thin wrapper around this module that avoids naming collisions with the ubiquitous <code>Config</code> module from <code>compiler-libs</code>.</p></div></div></div></body></html>
