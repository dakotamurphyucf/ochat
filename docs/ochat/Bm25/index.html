<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Bm25 (ochat.Bm25)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../';
let search_urls = ['../db.js','../../sherlodoc.js'];
</script><script src="../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> ‚Äì <a href="../../index.html">Index</a> &#x00BB; <a href="../index.html">ochat</a> &#x00BB; Bm25</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="üîé Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Bm25</span></code></h1><p>A document that can be indexed.</p><p>The <code>id</code> must be unique within the corpus ‚Äì it is returned by <a href="#val-query"><code>query</code></a> so that the caller can look the document up again. The <code>text</code> field is free-form UTF-8. It will be split into lower-case tokens by <a href="#val-tokenize"><code>tokenize</code></a>.</p></header><div class="odoc-content"><p>Lightweight in-memory BM-25 index used as a fast fall-back to semantic vector search.</p><p><b>Intended use-case</b> ‚Äì corpora of up to ~50&amp;nbsp;k short documents (code snippets, README paragraphs, etc.).</p><p>All operations are single-threaded and allocate only standard OCaml data structures. For very large datasets use a dedicated search engine (e.g. Tantivy, MeiliSearch) isnstead.</p><div class="odoc-spec"><div class="spec type anchored" id="type-doc"><a href="#type-doc" class="anchor"></a><code><span><span class="keyword">type</span> doc</span><span> = </span><span>{</span></code><ol><li id="type-doc.id" class="def record field anchored"><a href="#type-doc.id" class="anchor"></a><code><span>id : int;</span></code></li><li id="type-doc.text" class="def record field anchored"><a href="#type-doc.text" class="anchor"></a><code><span>text : string;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>In-memory BM25 index. Use <a href="#val-create"><code>create</code></a> to build one, <a href="#val-query"><code>query</code></a> to search it, and <a href="#val-write_to_disk"><code>write_to_disk</code></a>/<a href="#val-read_from_disk"><code>read_from_disk</code></a> to persist it.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tokenize"><a href="#val-tokenize" class="anchor"></a><code><span><span class="keyword">val</span> tokenize : <span>string <span class="arrow">&#45;&gt;</span></span> <span>string list</span></span></code></div><div class="spec-doc"><p><code>tokenize s</code> splits <code>s</code> into lower-case tokens.</p><p>The splitter treats ASCII whitespace and a few punctuation characters ‚Äì `(){</p><p>}</p><p> ,;` ‚Äì as delimiters. Tokens found in a very small stop-word list are removed (currently the list is empty ‚Äì override it in <a href="#"><code>Bm25</code></a> ºs implementation if needed).</p><p>The function performs no stemming or diacritics removal; adapt or replace it if your corpus requires more advanced processing.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : <span><span><a href="#type-doc">doc</a> list</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>create docs</code> builds a BM25 index over <code>docs</code>.</p><p>Each document is tokenised with <a href="#val-tokenize"><code>tokenize</code></a>. The result contains enough information to evaluate BM25 with the usual parameters (k‚ÇÅ = 1.5, b = 0.75). Construction time is O(total-token-count) and memory usage is modest but the implementation has not been tuned for very large corpora (&gt; ~50 k documents).</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Invalid_argument</code> <p>if two documents share the same <code>id</code>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-query"><a href="#val-query" class="anchor"></a><code><span><span class="keyword">val</span> query : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">text</span>:string <span class="arrow">&#45;&gt;</span></span> <span><span class="label">k</span>:int <span class="arrow">&#45;&gt;</span></span> <span><span>(int * float)</span> list</span></span></code></div><div class="spec-doc"><p><code>query t ~text ~k</code> returns up to <code>k</code> documents ranked by BM25 relevance to <code>text</code>.</p><p>The score is a float &gt; 0. Results are sorted in descending order (best match first). For ties the order is unspecified.</p><p>The implementation applies an extra <b>coverage weight</b>: if the query contains several distinct tokens, documents that contain a larger proportion of them are promoted.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">k</span> <p>maximum number of hits to return (clamped to corpus size)</p></li></ul><p>Example ‚Äì indexing three fragments and retrieving the best match:</p><pre class="language-ocaml"><code>  let docs =
    [ { Bm25.id = 0; text = &quot;OCaml is a functional language&quot; }
    ; { id = 1; text = &quot;BM25 is a ranking function&quot; }
    ; { id = 2; text = &quot;OCaml and ReasonML share a syntax&quot; }
    ]
  in
  let idx   = Bm25.create docs in
  let hits  = Bm25.query idx ~text:&quot;ocaml ranking&quot; ~k:2 in
  (* [hits] might be [ (0, 0.73); (2, 0.44) ] *)</code></pre></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-write_to_disk"><a href="#val-write_to_disk" class="anchor"></a><code><span><span class="keyword">val</span> write_to_disk : <span><span><span class="xref-unresolved">Eio</span>.Fs.dir_ty <span class="xref-unresolved">Eio</span>.Path.t</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>write_to_disk path t</code> serialises <code>t</code> to <code>path</code> using <code>Bin_prot</code>. The file is overwritten (or created) with permissions `0o600`.</p><p>This function must run inside an <code>Eio</code> fibre ‚Äì it performs non-blocking I/O via <code>Eio.Path</code> and <code>Eio.Flow</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read_from_disk"><a href="#val-read_from_disk" class="anchor"></a><code><span><span class="keyword">val</span> read_from_disk : <span><span><span class="xref-unresolved">Eio</span>.Fs.dir_ty <span class="xref-unresolved">Eio</span>.Path.t</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>read_from_disk path</code> deserialises a snapshot previously written by <a href="#val-write_to_disk"><code>write_to_disk</code></a>.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Failure</code> <p>if <code>path</code> does not contain exactly one valid snapshot.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-dump_debug"><a href="#val-dump_debug" class="anchor"></a><code><span><span class="keyword">val</span> dump_debug : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>dump_debug t</code> prints basic statistics about the index to stdout. Intended for interactive debugging only.</p></div></div></div></body></html>
