<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Responses (ochat.Openai.Responses)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../';
let search_urls = ['../../db.js','../../../sherlodoc.js'];
</script><script src="../../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> ‚Äì <a href="../../../index.html">Index</a> &#x00BB; <a href="../../index.html">ochat</a> &#x00BB; <a href="../index.html">Openai</a> &#x00BB; Responses</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="üîé Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Openai.Responses</span></code></h1><p>OpenAI <code>/v1/responses</code> client.</p><p>This interface provides a faithful OCaml representation of the request and response payloads used by OpenAI‚Äôs experimental ‚Äúresponses‚Äù endpoint (a superset of the Chat Completions API that adds sophisticated tool-calling and streaming semantics).</p><p>Only one high-level helper is exposed ‚Äì <a href="#val-post_response"><code>post_response</code></a>. All other sub-modules are thin, auto-generated mirrors of the JSON schema and are useful when you need to construct a request by hand or inspect a streaming reply in a type-safe manner.</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#environment">Environment</a></li><li><a href="#quick-start">Quick-start</a></li></ul></nav></div><div class="odoc-content"><h2 id="environment"><a href="#environment" class="anchor"></a>Environment</h2><p>The function <a href="#val-post_response"><code>post_response</code></a> expects the environment variable <code>OPENAI_API_KEY</code> to hold a valid secret key. A missing or empty key will lead to HTTP 401 responses from the server.</p><h2 id="quick-start"><a href="#quick-start" class="anchor"></a>Quick-start</h2><pre class="language-ocaml"><code>  Eio_main.run @@ fun env -&gt;
    let net = Eio.Stdenv.net env in
    let dir = Eio.Stdenv.cwd env in

    (* Build a minimal user message *)
    let open Responses in
    let open Responses.Input_message in
    let user : Input_message.t =
      { role = User
      ; content = [ Text { text = &quot;Hello&quot;; _type = &quot;input_text&quot; } ]
      ; _type = &quot;message&quot;
      }
    in

    (* Blocking, non-streaming call *)
    let ({ Response.output; _ } : Response.t) =
      post_response Default ~dir net ~inputs:[ Item.Input_message user ]
    in
    match output with
    | [ Output_message { content = [ { text; _ } ]; _ } ] -&gt;
      Format.printf &quot;Assistant said: %s@.&quot; text
    | _ -&gt; Format.printf &quot;Unexpected reply@.&quot;</code></pre><div class="odoc-spec"><div class="spec module anchored" id="module-Input_message"><a href="#module-Input_message" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Input_message/index.html">Input_message</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Annotation"><a href="#module-Annotation" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Annotation/index.html">Annotation</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Annotation_added"><a href="#module-Annotation_added" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Annotation_added/index.html">Annotation_added</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Output_message"><a href="#module-Output_message" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Output_message/index.html">Output_message</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Function_call"><a href="#module-Function_call" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Function_call/index.html">Function_call</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Function_call_output"><a href="#module-Function_call_output" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Function_call_output/index.html">Function_call_output</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Web_search_call"><a href="#module-Web_search_call" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Web_search_call/index.html">Web_search_call</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-File_search_call"><a href="#module-File_search_call" class="anchor"></a><code><span><span class="keyword">module</span> <a href="File_search_call/index.html">File_search_call</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Reasoning"><a href="#module-Reasoning" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Reasoning/index.html">Reasoning</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Item"><a href="#module-Item" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Item/index.html">Item</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Request"><a href="#module-Request" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Request/index.html">Request</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Status"><a href="#module-Status" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Status/index.html">Status</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Error"><a href="#module-Error" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Error/index.html">Error</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Incomplete_details"><a href="#module-Incomplete_details" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Incomplete_details/index.html">Incomplete_details</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Text_cfg"><a href="#module-Text_cfg" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Text_cfg/index.html">Text_cfg</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Tool_choice"><a href="#module-Tool_choice" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Tool_choice/index.html">Tool_choice</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Usage"><a href="#module-Usage" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Usage/index.html">Usage</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Metadata"><a href="#module-Metadata" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Metadata/index.html">Metadata</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Response"><a href="#module-Response" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Response/index.html">Response</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Response_stream"><a href="#module-Response_stream" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Response_stream/index.html">Response_stream</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-response_type"><a href="#type-response_type" class="anchor"></a><code><span><span class="keyword">type</span> <span>_ response_type</span></span><span> = </span></code><ol><li id="type-response_type.Stream" class="def variant constructor anchored"><a href="#type-response_type.Stream" class="anchor"></a><code><span>| </span><span><span class="constructor">Stream</span> : <span>(<span><a href="Response_stream/index.html#type-t">Response_stream.t</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span> <span>unit <a href="#type-response_type">response_type</a></span></span></code></li><li id="type-response_type.Default" class="def variant constructor anchored"><a href="#type-response_type.Default" class="anchor"></a><code><span>| </span><span><span class="constructor">Default</span> : <span><a href="Response/index.html#type-t">Response.t</a> <a href="#type-response_type">response_type</a></span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Response_stream_parsing_error"><a href="#exception-Response_stream_parsing_error" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Response_stream_parsing_error</span> <span class="keyword">of</span> <span class="xref-unresolved">Jsonaf</span>.t * exn</span></code></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Response_parsing_error"><a href="#exception-Response_parsing_error" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Response_parsing_error</span> <span class="keyword">of</span> <span class="xref-unresolved">Jsonaf</span>.t * exn</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-post_response"><a href="#val-post_response" class="anchor"></a><code><span><span class="keyword">val</span> post_response : 
  <span><span><span class="type-var">'a</span> <a href="#type-response_type">response_type</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?max_output_tokens</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?temperature</span>:float <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?tools</span>:<span><a href="Request/Tool/index.html#type-t">Request.Tool.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?model</span>:<a href="Request/index.html#type-model">Request.model</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?parallel_tool_calls</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?reasoning</span>:<a href="Request/Reasoning/index.html#type-t">Request.Reasoning.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">dir</span>:<span><span class="xref-unresolved">Eio</span>.Fs.dir_ty <span class="xref-unresolved">Eio</span>.Path.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'n</span> <span class="xref-unresolved">Eio</span>.Net.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">inputs</span>:<span><a href="Item/index.html#type-t">Item.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>post_response response_type ?max_output_tokens ?temperature ?tools ?model ?reasoning ~dir net ~inputs</code> sends <code>inputs</code> to the <code>/v1/responses</code> endpoint using the capability-safe network handle <code>net</code>.</p><p>The behaviour depends on <code>response_type</code>:</p><p>‚Ä¢ <a href="#type-response_type.Default"><code>Default</code></a> blocks until the server returns the final JSON object and then parses it as <a href="Response/index.html#type-t"><code>Response.t</code></a>.</p><p>‚Ä¢ <code>Stream cb</code> establishes a Server-Sent Events connection and invokes <code>cb</code> for every incremental <a href="Response_stream/index.html#type-t"><code>Response_stream.t</code></a> event. The function returns <code>()</code> once the stream terminates normally or raises an exception on the first error.</p><p>Parameters</p><p><code>max_output_tokens</code> ‚Äì hard upper-bound on tokens in the assistant reply (default = 600).</p><p><code>temperature</code> ‚Äì higher values yield more random completions (same semantics as the Chat Completions API).</p><p><code>parallel_tool_calls</code> ‚Äì when set to <code>true</code> the model is permitted to issue several tool invocations in parallel. The default (<code>false</code>) instructs the backend to process tool calls sequentially, mirroring the behaviour of the Chat Completions REST API.</p><p><code>tools</code> ‚Äì optional list of tool definitions that the model is allowed to invoke via function calls, file search, or web search.</p><p><code>model</code> ‚Äì one of <a href="Request/index.html#type-model"><code>Request.model</code></a> (default = <code>Gpt4</code>).</p><p><code>reasoning</code> ‚Äì hints influencing how detailed the model‚Äôs chain-of-thought will be.</p><p><code>dir</code> ‚Äì directory capability used to write diagnostic logs (the file <code>raw-openai-streaming-response.txt</code>).</p><p><code>net</code> ‚Äì capability granting outbound HTTPS access.</p><p><code>inputs</code> ‚Äì heterogeneous list of request items (messages, function calls, ‚Ä¶).</p><p>Exceptions</p><p>‚Ä¢ <a href="#exception-Response_stream_parsing_error"><code>Response_stream_parsing_error</code></a> when the incremental JSON event cannot be decoded; the constructor carries the offending JSON value and the underlying error. ‚Ä¢ Any network or TLS exception thrown by <code>cohttp-eio</code>.</p><p>Example</p><pre class="language-ocaml"><code>  (* Stream the assistant‚Äôs answer token-by-token *)
  let print_stream = function
    | Responses.Response_stream.Output_text_delta { delta; _ } -&gt;
      Format.printf &quot;%s%!&quot; delta
    | _ -&gt; ()
  in

  Responses.post_response
    (Responses.Stream print_stream)
    ~temperature:0.7
    ~dir:(Eio.Stdenv.cwd env)
    net
    ~inputs:[ my_message ]</code></pre></div></div></div></body></html>
