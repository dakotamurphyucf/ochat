<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Completions (ochat.Openai.Completions)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../';
let search_urls = ['../../db.js','../../../sherlodoc.js'];
</script><script src="../../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> ‚Äì <a href="../../../index.html">Index</a> &#x00BB; <a href="../../index.html">ochat</a> &#x00BB; <a href="../index.html">Openai</a> &#x00BB; Completions</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="üîé Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Openai.Completions</span></code></h1><p>Chat completions (a.k.a. ‚ÄúOchat‚Äù) client.</p><p>This module exposes a minimal yet expressive wrapper around the OpenAI <code>v1/chat/completions</code> endpoint. It is designed for advanced use-cases that require</p><p>‚Ä¢ *Capability-safe*, effect-typed IO (uses <code>Eio</code>) ‚Ä¢ *Streaming* responses delivered incrementally ‚Ä¢ *Tool calling* / *function calling* with full JSON schemas</p><p>The high-level helper <a href="#val-post_chat_completion"><code>post_chat_completion</code></a> is all you need for most workflows. All record types below are faithful OCaml mirrors of OpenAI‚Äôs public JSON schema ‚Äì you will typically construct a list of <a href="#type-chat_message"><code>chat_message</code></a> values, invoke <code>post_chat_completion</code>, and then pattern-match on the returned choices.</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#environment">Environment</a></li><li><a href="#quick-start">Quick-start</a></li><li><a href="#error-handling">Error handling</a></li></ul></nav></div><div class="odoc-content"><h2 id="environment"><a href="#environment" class="anchor"></a>Environment</h2><p>The environment variable <code>OPENAI_API_KEY</code> must contain a valid secret key. A missing or empty key will result in HTTP 401.</p><h2 id="quick-start"><a href="#quick-start" class="anchor"></a>Quick-start</h2><pre class="language-ocaml"><code>  open Completions

  let assistant ?(model = Gpt3) net ~dir ~prompt =
    let user : chat_message =
      { role = &quot;user&quot;; content = Some (Text prompt); name = None
      ; tool_call_id = None; function_call = None; tool_calls = None }
    in
    match
      post_chat_completion Default ~dir net ~inputs:[ user ] ~model
    with
    | { finish_reason = Some &quot;stop&quot;; message = { content = Some c; _ } } -&gt;
      c
    | _ -&gt; failwith &quot;Unexpected reply&quot;</code></pre><h2 id="error-handling"><a href="#error-handling" class="anchor"></a>Error handling</h2><p>Network failures, JSON decoding issues, or non-2xx HTTP responses are raised as exceptions. Wrap calls with <a href="../../Io/index.html#val-to_res"><code>Io.to_res</code></a> or similar helpers if you prefer an error-returning style.</p><div class="odoc-spec"><div class="spec type anchored" id="type-function_call"><a href="#type-function_call" class="anchor"></a><code><span><span class="keyword">type</span> function_call</span><span> = </span><span>{</span></code><ol><li id="type-function_call.arguments" class="def record field anchored"><a href="#type-function_call.arguments" class="anchor"></a><code><span>arguments : string;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Raw JSON string with the arguments payload.</p><span class="comment-delim">*)</span></div></li><li id="type-function_call.name" class="def record field anchored"><a href="#type-function_call.name" class="anchor"></a><code><span>name : string;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Name of the server-side function to invoke.</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-jsonaf_of_function_call"><a href="#val-jsonaf_of_function_call" class="anchor"></a><code><span><span class="keyword">val</span> jsonaf_of_function_call : 
  <span><a href="#type-function_call">function_call</a> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-function_call_of_jsonaf"><a href="#val-function_call_of_jsonaf" class="anchor"></a><code><span><span class="keyword">val</span> function_call_of_jsonaf : 
  <span><span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-function_call">function_call</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sexp_of_function_call"><a href="#val-sexp_of_function_call" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_function_call : <span><a href="#type-function_call">function_call</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Sexplib0</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-function_call_of_sexp"><a href="#val-function_call_of_sexp" class="anchor"></a><code><span><span class="keyword">val</span> function_call_of_sexp : <span><span class="xref-unresolved">Sexplib0</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-function_call">function_call</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_shape_function_call"><a href="#val-bin_shape_function_call" class="anchor"></a><code><span><span class="keyword">val</span> bin_shape_function_call : <span class="xref-unresolved">Bin_prot</span>.Shape.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_size_function_call"><a href="#val-bin_size_function_call" class="anchor"></a><code><span><span class="keyword">val</span> bin_size_function_call : <span><a href="#type-function_call">function_call</a> <span class="xref-unresolved">Bin_prot</span>.Size.sizer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_write_function_call"><a href="#val-bin_write_function_call" class="anchor"></a><code><span><span class="keyword">val</span> bin_write_function_call : <span><a href="#type-function_call">function_call</a> <span class="xref-unresolved">Bin_prot</span>.Write.writer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_writer_function_call"><a href="#val-bin_writer_function_call" class="anchor"></a><code><span><span class="keyword">val</span> bin_writer_function_call : <span><a href="#type-function_call">function_call</a> <span class="xref-unresolved">Bin_prot</span>.Type_class.writer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_read_function_call"><a href="#val-bin_read_function_call" class="anchor"></a><code><span><span class="keyword">val</span> bin_read_function_call : <span><a href="#type-function_call">function_call</a> <span class="xref-unresolved">Bin_prot</span>.Read.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-__bin_read_function_call__"><a href="#val-__bin_read_function_call__" class="anchor"></a><code><span><span class="keyword">val</span> __bin_read_function_call__ : <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> <a href="#type-function_call">function_call</a>)</span> <span class="xref-unresolved">Bin_prot</span>.Read.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_reader_function_call"><a href="#val-bin_reader_function_call" class="anchor"></a><code><span><span class="keyword">val</span> bin_reader_function_call : <span><a href="#type-function_call">function_call</a> <span class="xref-unresolved">Bin_prot</span>.Type_class.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_function_call"><a href="#val-bin_function_call" class="anchor"></a><code><span><span class="keyword">val</span> bin_function_call : <span><a href="#type-function_call">function_call</a> <span class="xref-unresolved">Bin_prot</span>.Type_class.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-tool_call_chunk"><a href="#type-tool_call_chunk" class="anchor"></a><code><span><span class="keyword">type</span> tool_call_chunk</span><span> = </span><span>{</span></code><ol><li id="type-tool_call_chunk.id" class="def record field anchored"><a href="#type-tool_call_chunk.id" class="anchor"></a><code><span>id : string;</span></code></li><li id="type-tool_call_chunk.function_" class="def record field anchored"><a href="#type-tool_call_chunk.function_" class="anchor"></a><code><span>function_ : <a href="#type-function_call">function_call</a>;</span></code></li><li id="type-tool_call_chunk.type_" class="def record field anchored"><a href="#type-tool_call_chunk.type_" class="anchor"></a><code><span>type_ : string;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-jsonaf_of_tool_call_chunk"><a href="#val-jsonaf_of_tool_call_chunk" class="anchor"></a><code><span><span class="keyword">val</span> jsonaf_of_tool_call_chunk : 
  <span><a href="#type-tool_call_chunk">tool_call_chunk</a> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tool_call_chunk_of_jsonaf"><a href="#val-tool_call_chunk_of_jsonaf" class="anchor"></a><code><span><span class="keyword">val</span> tool_call_chunk_of_jsonaf : 
  <span><span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-tool_call_chunk">tool_call_chunk</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sexp_of_tool_call_chunk"><a href="#val-sexp_of_tool_call_chunk" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_tool_call_chunk : <span><a href="#type-tool_call_chunk">tool_call_chunk</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Sexplib0</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tool_call_chunk_of_sexp"><a href="#val-tool_call_chunk_of_sexp" class="anchor"></a><code><span><span class="keyword">val</span> tool_call_chunk_of_sexp : <span><span class="xref-unresolved">Sexplib0</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-tool_call_chunk">tool_call_chunk</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_shape_tool_call_chunk"><a href="#val-bin_shape_tool_call_chunk" class="anchor"></a><code><span><span class="keyword">val</span> bin_shape_tool_call_chunk : <span class="xref-unresolved">Bin_prot</span>.Shape.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_size_tool_call_chunk"><a href="#val-bin_size_tool_call_chunk" class="anchor"></a><code><span><span class="keyword">val</span> bin_size_tool_call_chunk : <span><a href="#type-tool_call_chunk">tool_call_chunk</a> <span class="xref-unresolved">Bin_prot</span>.Size.sizer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_write_tool_call_chunk"><a href="#val-bin_write_tool_call_chunk" class="anchor"></a><code><span><span class="keyword">val</span> bin_write_tool_call_chunk : <span><a href="#type-tool_call_chunk">tool_call_chunk</a> <span class="xref-unresolved">Bin_prot</span>.Write.writer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_writer_tool_call_chunk"><a href="#val-bin_writer_tool_call_chunk" class="anchor"></a><code><span><span class="keyword">val</span> bin_writer_tool_call_chunk : <span><a href="#type-tool_call_chunk">tool_call_chunk</a> <span class="xref-unresolved">Bin_prot</span>.Type_class.writer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_read_tool_call_chunk"><a href="#val-bin_read_tool_call_chunk" class="anchor"></a><code><span><span class="keyword">val</span> bin_read_tool_call_chunk : <span><a href="#type-tool_call_chunk">tool_call_chunk</a> <span class="xref-unresolved">Bin_prot</span>.Read.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-__bin_read_tool_call_chunk__"><a href="#val-__bin_read_tool_call_chunk__" class="anchor"></a><code><span><span class="keyword">val</span> __bin_read_tool_call_chunk__ : 
  <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> <a href="#type-tool_call_chunk">tool_call_chunk</a>)</span> <span class="xref-unresolved">Bin_prot</span>.Read.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_reader_tool_call_chunk"><a href="#val-bin_reader_tool_call_chunk" class="anchor"></a><code><span><span class="keyword">val</span> bin_reader_tool_call_chunk : <span><a href="#type-tool_call_chunk">tool_call_chunk</a> <span class="xref-unresolved">Bin_prot</span>.Type_class.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_tool_call_chunk"><a href="#val-bin_tool_call_chunk" class="anchor"></a><code><span><span class="keyword">val</span> bin_tool_call_chunk : <span><a href="#type-tool_call_chunk">tool_call_chunk</a> <span class="xref-unresolved">Bin_prot</span>.Type_class.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-tool_call_default"><a href="#type-tool_call_default" class="anchor"></a><code><span><span class="keyword">type</span> tool_call_default</span><span> = </span><span>{</span></code><ol><li id="type-tool_call_default.id" class="def record field anchored"><a href="#type-tool_call_default.id" class="anchor"></a><code><span>id : <span>string option</span>;</span></code></li><li id="type-tool_call_default.function_" class="def record field anchored"><a href="#type-tool_call_default.function_" class="anchor"></a><code><span>function_ : <span><a href="#type-function_call">function_call</a> option</span>;</span></code></li><li id="type-tool_call_default.type_" class="def record field anchored"><a href="#type-tool_call_default.type_" class="anchor"></a><code><span>type_ : <span>string option</span>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-jsonaf_of_tool_call_default"><a href="#val-jsonaf_of_tool_call_default" class="anchor"></a><code><span><span class="keyword">val</span> jsonaf_of_tool_call_default : 
  <span><a href="#type-tool_call_default">tool_call_default</a> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tool_call_default_of_jsonaf"><a href="#val-tool_call_default_of_jsonaf" class="anchor"></a><code><span><span class="keyword">val</span> tool_call_default_of_jsonaf : 
  <span><span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-tool_call_default">tool_call_default</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sexp_of_tool_call_default"><a href="#val-sexp_of_tool_call_default" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_tool_call_default : <span><a href="#type-tool_call_default">tool_call_default</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Sexplib0</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tool_call_default_of_sexp"><a href="#val-tool_call_default_of_sexp" class="anchor"></a><code><span><span class="keyword">val</span> tool_call_default_of_sexp : <span><span class="xref-unresolved">Sexplib0</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-tool_call_default">tool_call_default</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_shape_tool_call_default"><a href="#val-bin_shape_tool_call_default" class="anchor"></a><code><span><span class="keyword">val</span> bin_shape_tool_call_default : <span class="xref-unresolved">Bin_prot</span>.Shape.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_size_tool_call_default"><a href="#val-bin_size_tool_call_default" class="anchor"></a><code><span><span class="keyword">val</span> bin_size_tool_call_default : <span><a href="#type-tool_call_default">tool_call_default</a> <span class="xref-unresolved">Bin_prot</span>.Size.sizer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_write_tool_call_default"><a href="#val-bin_write_tool_call_default" class="anchor"></a><code><span><span class="keyword">val</span> bin_write_tool_call_default : <span><a href="#type-tool_call_default">tool_call_default</a> <span class="xref-unresolved">Bin_prot</span>.Write.writer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_writer_tool_call_default"><a href="#val-bin_writer_tool_call_default" class="anchor"></a><code><span><span class="keyword">val</span> bin_writer_tool_call_default : <span><a href="#type-tool_call_default">tool_call_default</a> <span class="xref-unresolved">Bin_prot</span>.Type_class.writer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_read_tool_call_default"><a href="#val-bin_read_tool_call_default" class="anchor"></a><code><span><span class="keyword">val</span> bin_read_tool_call_default : <span><a href="#type-tool_call_default">tool_call_default</a> <span class="xref-unresolved">Bin_prot</span>.Read.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-__bin_read_tool_call_default__"><a href="#val-__bin_read_tool_call_default__" class="anchor"></a><code><span><span class="keyword">val</span> __bin_read_tool_call_default__ : 
  <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> <a href="#type-tool_call_default">tool_call_default</a>)</span> <span class="xref-unresolved">Bin_prot</span>.Read.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_reader_tool_call_default"><a href="#val-bin_reader_tool_call_default" class="anchor"></a><code><span><span class="keyword">val</span> bin_reader_tool_call_default : <span><a href="#type-tool_call_default">tool_call_default</a> <span class="xref-unresolved">Bin_prot</span>.Type_class.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_tool_call_default"><a href="#val-bin_tool_call_default" class="anchor"></a><code><span><span class="keyword">val</span> bin_tool_call_default : <span><a href="#type-tool_call_default">tool_call_default</a> <span class="xref-unresolved">Bin_prot</span>.Type_class.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-image_url"><a href="#type-image_url" class="anchor"></a><code><span><span class="keyword">type</span> image_url</span><span> = </span><span>{</span></code><ol><li id="type-image_url.url" class="def record field anchored"><a href="#type-image_url.url" class="anchor"></a><code><span>url : string;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-jsonaf_of_image_url"><a href="#val-jsonaf_of_image_url" class="anchor"></a><code><span><span class="keyword">val</span> jsonaf_of_image_url : <span><a href="#type-image_url">image_url</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-image_url_of_jsonaf"><a href="#val-image_url_of_jsonaf" class="anchor"></a><code><span><span class="keyword">val</span> image_url_of_jsonaf : <span><span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-image_url">image_url</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sexp_of_image_url"><a href="#val-sexp_of_image_url" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_image_url : <span><a href="#type-image_url">image_url</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Sexplib0</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-image_url_of_sexp"><a href="#val-image_url_of_sexp" class="anchor"></a><code><span><span class="keyword">val</span> image_url_of_sexp : <span><span class="xref-unresolved">Sexplib0</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-image_url">image_url</a></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-content_item"><a href="#type-content_item" class="anchor"></a><code><span><span class="keyword">type</span> content_item</span><span> = </span><span>{</span></code><ol><li id="type-content_item.type_" class="def record field anchored"><a href="#type-content_item.type_" class="anchor"></a><code><span>type_ : string;</span></code></li><li id="type-content_item.text" class="def record field anchored"><a href="#type-content_item.text" class="anchor"></a><code><span>text : <span>string option</span>;</span></code></li><li id="type-content_item.image_url" class="def record field anchored"><a href="#type-content_item.image_url" class="anchor"></a><code><span>image_url : <span><a href="#type-image_url">image_url</a> option</span>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-jsonaf_of_content_item"><a href="#val-jsonaf_of_content_item" class="anchor"></a><code><span><span class="keyword">val</span> jsonaf_of_content_item : 
  <span><a href="#type-content_item">content_item</a> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-content_item_of_jsonaf"><a href="#val-content_item_of_jsonaf" class="anchor"></a><code><span><span class="keyword">val</span> content_item_of_jsonaf : 
  <span><span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-content_item">content_item</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sexp_of_content_item"><a href="#val-sexp_of_content_item" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_content_item : <span><a href="#type-content_item">content_item</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Sexplib0</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-content_item_of_sexp"><a href="#val-content_item_of_sexp" class="anchor"></a><code><span><span class="keyword">val</span> content_item_of_sexp : <span><span class="xref-unresolved">Sexplib0</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-content_item">content_item</a></span></code></div></div><p>Individual piece of content that can either be plain text or an image reference. Used when the user or assistant sends mixed media. For convenience, the helper <a href="#type-chat_message_content"><code>chat_message_content</code></a> wraps this in a variant.</p><div class="odoc-spec"><div class="spec type anchored" id="type-chat_message_content"><a href="#type-chat_message_content" class="anchor"></a><code><span><span class="keyword">type</span> chat_message_content</span><span> = </span></code><ol><li id="type-chat_message_content.Text" class="def variant constructor anchored"><a href="#type-chat_message_content.Text" class="anchor"></a><code><span>| </span><span><span class="constructor">Text</span> <span class="keyword">of</span> string</span></code></li><li id="type-chat_message_content.Items" class="def variant constructor anchored"><a href="#type-chat_message_content.Items" class="anchor"></a><code><span>| </span><span><span class="constructor">Items</span> <span class="keyword">of</span> <span><a href="#type-content_item">content_item</a> list</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sexp_of_chat_message_content"><a href="#val-sexp_of_chat_message_content" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_chat_message_content : <span><a href="#type-chat_message_content">chat_message_content</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Sexplib0</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-chat_message_content_of_sexp"><a href="#val-chat_message_content_of_sexp" class="anchor"></a><code><span><span class="keyword">val</span> chat_message_content_of_sexp : <span><span class="xref-unresolved">Sexplib0</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-chat_message_content">chat_message_content</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-jsonaf_of_chat_message_content"><a href="#val-jsonaf_of_chat_message_content" class="anchor"></a><code><span><span class="keyword">val</span> jsonaf_of_chat_message_content : 
  <span><a href="#type-chat_message_content">chat_message_content</a> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-chat_message_content_of_jsonaf"><a href="#val-chat_message_content_of_jsonaf" class="anchor"></a><code><span><span class="keyword">val</span> chat_message_content_of_jsonaf : 
  <span><span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-chat_message_content">chat_message_content</a></span></code></div></div><p>Content of a single chat message ‚Äì either a raw UTF-8 string (<code>Text</code>) or a structured list of <a href="#type-content_item"><code>content_item</code></a>s (<code>Items</code>).</p><div class="odoc-spec"><div class="spec type anchored" id="type-chat_message"><a href="#type-chat_message" class="anchor"></a><code><span><span class="keyword">type</span> chat_message</span><span> = </span><span>{</span></code><ol><li id="type-chat_message.role" class="def record field anchored"><a href="#type-chat_message.role" class="anchor"></a><code><span>role : string;</span></code></li><li id="type-chat_message.content" class="def record field anchored"><a href="#type-chat_message.content" class="anchor"></a><code><span>content : <span><a href="#type-chat_message_content">chat_message_content</a> option</span>;</span></code></li><li id="type-chat_message.name" class="def record field anchored"><a href="#type-chat_message.name" class="anchor"></a><code><span>name : <span>string option</span>;</span></code></li><li id="type-chat_message.tool_call_id" class="def record field anchored"><a href="#type-chat_message.tool_call_id" class="anchor"></a><code><span>tool_call_id : <span>string option</span>;</span></code></li><li id="type-chat_message.function_call" class="def record field anchored"><a href="#type-chat_message.function_call" class="anchor"></a><code><span>function_call : <span><a href="#type-function_call">function_call</a> option</span>;</span></code></li><li id="type-chat_message.tool_calls" class="def record field anchored"><a href="#type-chat_message.tool_calls" class="anchor"></a><code><span>tool_calls : <span><span><a href="#type-tool_call_default">tool_call_default</a> list</span> option</span>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sexp_of_chat_message"><a href="#val-sexp_of_chat_message" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_chat_message : <span><a href="#type-chat_message">chat_message</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Sexplib0</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-chat_message_of_sexp"><a href="#val-chat_message_of_sexp" class="anchor"></a><code><span><span class="keyword">val</span> chat_message_of_sexp : <span><span class="xref-unresolved">Sexplib0</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-chat_message">chat_message</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-jsonaf_of_chat_message"><a href="#val-jsonaf_of_chat_message" class="anchor"></a><code><span><span class="keyword">val</span> jsonaf_of_chat_message : 
  <span><a href="#type-chat_message">chat_message</a> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-chat_message_of_jsonaf"><a href="#val-chat_message_of_jsonaf" class="anchor"></a><code><span><span class="keyword">val</span> chat_message_of_jsonaf : 
  <span><span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-chat_message">chat_message</a></span></code></div></div><p>A complete chat message ready for transmission. At minimum a message must specify a <code>role</code> (&quot;user&quot;, &quot;assistant&quot;, &quot;system&quot; ‚Ä¶) and optionally carries text, image URLs, function calls, etc. For most interactions you‚Äôll build a small list of such records and pass them to <a href="#val-post_chat_completion"><code>post_chat_completion</code></a>.</p><div class="odoc-spec"><div class="spec type anchored" id="type-message"><a href="#type-message" class="anchor"></a><code><span><span class="keyword">type</span> message</span><span> = </span><span>{</span></code><ol><li id="type-message.content" class="def record field anchored"><a href="#type-message.content" class="anchor"></a><code><span>content : <span>string option</span>;</span></code></li><li id="type-message.refusal" class="def record field anchored"><a href="#type-message.refusal" class="anchor"></a><code><span>refusal : <span>string option</span>;</span></code></li><li id="type-message.role" class="def record field anchored"><a href="#type-message.role" class="anchor"></a><code><span>role : string;</span></code></li><li id="type-message.function_call" class="def record field anchored"><a href="#type-message.function_call" class="anchor"></a><code><span>function_call : <span><a href="#type-function_call">function_call</a> option</span>;</span></code></li><li id="type-message.tool_calls" class="def record field anchored"><a href="#type-message.tool_calls" class="anchor"></a><code><span>tool_calls : <span><span><a href="#type-tool_call_default">tool_call_default</a> list</span> option</span>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-jsonaf_of_message"><a href="#val-jsonaf_of_message" class="anchor"></a><code><span><span class="keyword">val</span> jsonaf_of_message : <span><a href="#type-message">message</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-message_of_jsonaf"><a href="#val-message_of_jsonaf" class="anchor"></a><code><span><span class="keyword">val</span> message_of_jsonaf : <span><span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-message">message</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sexp_of_message"><a href="#val-sexp_of_message" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_message : <span><a href="#type-message">message</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Sexplib0</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-message_of_sexp"><a href="#val-message_of_sexp" class="anchor"></a><code><span><span class="keyword">val</span> message_of_sexp : <span><span class="xref-unresolved">Sexplib0</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-message">message</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_shape_message"><a href="#val-bin_shape_message" class="anchor"></a><code><span><span class="keyword">val</span> bin_shape_message : <span class="xref-unresolved">Bin_prot</span>.Shape.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_size_message"><a href="#val-bin_size_message" class="anchor"></a><code><span><span class="keyword">val</span> bin_size_message : <span><a href="#type-message">message</a> <span class="xref-unresolved">Bin_prot</span>.Size.sizer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_write_message"><a href="#val-bin_write_message" class="anchor"></a><code><span><span class="keyword">val</span> bin_write_message : <span><a href="#type-message">message</a> <span class="xref-unresolved">Bin_prot</span>.Write.writer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_writer_message"><a href="#val-bin_writer_message" class="anchor"></a><code><span><span class="keyword">val</span> bin_writer_message : <span><a href="#type-message">message</a> <span class="xref-unresolved">Bin_prot</span>.Type_class.writer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_read_message"><a href="#val-bin_read_message" class="anchor"></a><code><span><span class="keyword">val</span> bin_read_message : <span><a href="#type-message">message</a> <span class="xref-unresolved">Bin_prot</span>.Read.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-__bin_read_message__"><a href="#val-__bin_read_message__" class="anchor"></a><code><span><span class="keyword">val</span> __bin_read_message__ : <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> <a href="#type-message">message</a>)</span> <span class="xref-unresolved">Bin_prot</span>.Read.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_reader_message"><a href="#val-bin_reader_message" class="anchor"></a><code><span><span class="keyword">val</span> bin_reader_message : <span><a href="#type-message">message</a> <span class="xref-unresolved">Bin_prot</span>.Type_class.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_message"><a href="#val-bin_message" class="anchor"></a><code><span><span class="keyword">val</span> bin_message : <span><a href="#type-message">message</a> <span class="xref-unresolved">Bin_prot</span>.Type_class.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-func"><a href="#type-func" class="anchor"></a><code><span><span class="keyword">type</span> func</span><span> = </span><span>{</span></code><ol><li id="type-func.name" class="def record field anchored"><a href="#type-func.name" class="anchor"></a><code><span>name : string;</span></code></li><li id="type-func.description" class="def record field anchored"><a href="#type-func.description" class="anchor"></a><code><span>description : <span>string option</span>;</span></code></li><li id="type-func.parameters" class="def record field anchored"><a href="#type-func.parameters" class="anchor"></a><code><span>parameters : <span class="xref-unresolved">Jsonaf</span>.t;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-jsonaf_of_func"><a href="#val-jsonaf_of_func" class="anchor"></a><code><span><span class="keyword">val</span> jsonaf_of_func : <span><a href="#type-func">func</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-func_of_jsonaf"><a href="#val-func_of_jsonaf" class="anchor"></a><code><span><span class="keyword">val</span> func_of_jsonaf : <span><span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-func">func</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sexp_of_func"><a href="#val-sexp_of_func" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_func : <span><a href="#type-func">func</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Sexplib0</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-func_of_sexp"><a href="#val-func_of_sexp" class="anchor"></a><code><span><span class="keyword">val</span> func_of_sexp : <span><span class="xref-unresolved">Sexplib0</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-func">func</a></span></code></div></div><p>JSON-schema description of a callable function that the model may invoke. Follows OpenAI‚Äôs *function calling* specification.</p><div class="odoc-spec"><div class="spec type anchored" id="type-tool_func"><a href="#type-tool_func" class="anchor"></a><code><span><span class="keyword">type</span> tool_func</span><span> = </span><span>{</span></code><ol><li id="type-tool_func.name" class="def record field anchored"><a href="#type-tool_func.name" class="anchor"></a><code><span>name : string;</span></code></li><li id="type-tool_func.description" class="def record field anchored"><a href="#type-tool_func.description" class="anchor"></a><code><span>description : <span>string option</span>;</span></code></li><li id="type-tool_func.parameters" class="def record field anchored"><a href="#type-tool_func.parameters" class="anchor"></a><code><span>parameters : <span class="xref-unresolved">Jsonaf</span>.t;</span></code></li><li id="type-tool_func.strict" class="def record field anchored"><a href="#type-tool_func.strict" class="anchor"></a><code><span>strict : bool;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-jsonaf_of_tool_func"><a href="#val-jsonaf_of_tool_func" class="anchor"></a><code><span><span class="keyword">val</span> jsonaf_of_tool_func : <span><a href="#type-tool_func">tool_func</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tool_func_of_jsonaf"><a href="#val-tool_func_of_jsonaf" class="anchor"></a><code><span><span class="keyword">val</span> tool_func_of_jsonaf : <span><span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-tool_func">tool_func</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sexp_of_tool_func"><a href="#val-sexp_of_tool_func" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_tool_func : <span><a href="#type-tool_func">tool_func</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Sexplib0</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tool_func_of_sexp"><a href="#val-tool_func_of_sexp" class="anchor"></a><code><span><span class="keyword">val</span> tool_func_of_sexp : <span><span class="xref-unresolved">Sexplib0</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-tool_func">tool_func</a></span></code></div></div><p>Richer description used when <code>&quot;type&quot; = &quot;tool&quot;</code>. The additional <code>strict</code> flag enforces schema compliance on the server side.</p><div class="odoc-spec"><div class="spec type anchored" id="type-tool"><a href="#type-tool" class="anchor"></a><code><span><span class="keyword">type</span> tool</span><span> = </span><span>{</span></code><ol><li id="type-tool.type_" class="def record field anchored"><a href="#type-tool.type_" class="anchor"></a><code><span>type_ : string;</span></code></li><li id="type-tool.function_" class="def record field anchored"><a href="#type-tool.function_" class="anchor"></a><code><span>function_ : <a href="#type-tool_func">tool_func</a>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-jsonaf_of_tool"><a href="#val-jsonaf_of_tool" class="anchor"></a><code><span><span class="keyword">val</span> jsonaf_of_tool : <span><a href="#type-tool">tool</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tool_of_jsonaf"><a href="#val-tool_of_jsonaf" class="anchor"></a><code><span><span class="keyword">val</span> tool_of_jsonaf : <span><span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-tool">tool</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sexp_of_tool"><a href="#val-sexp_of_tool" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_tool : <span><a href="#type-tool">tool</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Sexplib0</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tool_of_sexp"><a href="#val-tool_of_sexp" class="anchor"></a><code><span><span class="keyword">val</span> tool_of_sexp : <span><span class="xref-unresolved">Sexplib0</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-tool">tool</a></span></code></div></div><p>One entry in the <code>tools</code> array accepted by the API.</p><div class="odoc-spec"><div class="spec type anchored" id="type-schema"><a href="#type-schema" class="anchor"></a><code><span><span class="keyword">type</span> schema</span><span> = </span><span>{</span></code><ol><li id="type-schema.description" class="def record field anchored"><a href="#type-schema.description" class="anchor"></a><code><span>description : <span>string option</span>;</span></code></li><li id="type-schema.name" class="def record field anchored"><a href="#type-schema.name" class="anchor"></a><code><span>name : string;</span></code></li><li id="type-schema.schema" class="def record field anchored"><a href="#type-schema.schema" class="anchor"></a><code><span>schema : <span class="xref-unresolved">Jsonaf</span>.t;</span></code></li><li id="type-schema.strict" class="def record field anchored"><a href="#type-schema.strict" class="anchor"></a><code><span>strict : bool;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-jsonaf_of_schema"><a href="#val-jsonaf_of_schema" class="anchor"></a><code><span><span class="keyword">val</span> jsonaf_of_schema : <span><a href="#type-schema">schema</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-schema_of_jsonaf"><a href="#val-schema_of_jsonaf" class="anchor"></a><code><span><span class="keyword">val</span> schema_of_jsonaf : <span><span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-schema">schema</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sexp_of_schema"><a href="#val-sexp_of_schema" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_schema : <span><a href="#type-schema">schema</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Sexplib0</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-schema_of_sexp"><a href="#val-schema_of_sexp" class="anchor"></a><code><span><span class="keyword">val</span> schema_of_sexp : <span><span class="xref-unresolved">Sexplib0</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-schema">schema</a></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-response_format"><a href="#type-response_format" class="anchor"></a><code><span><span class="keyword">type</span> response_format</span><span> = </span><span>{</span></code><ol><li id="type-response_format.type_" class="def record field anchored"><a href="#type-response_format.type_" class="anchor"></a><code><span>type_ : string;</span></code></li><li id="type-response_format.json_schema" class="def record field anchored"><a href="#type-response_format.json_schema" class="anchor"></a><code><span>json_schema : <a href="#type-schema">schema</a>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-jsonaf_of_response_format"><a href="#val-jsonaf_of_response_format" class="anchor"></a><code><span><span class="keyword">val</span> jsonaf_of_response_format : 
  <span><a href="#type-response_format">response_format</a> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-response_format_of_jsonaf"><a href="#val-response_format_of_jsonaf" class="anchor"></a><code><span><span class="keyword">val</span> response_format_of_jsonaf : 
  <span><span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-response_format">response_format</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sexp_of_response_format"><a href="#val-sexp_of_response_format" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_response_format : <span><a href="#type-response_format">response_format</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Sexplib0</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-response_format_of_sexp"><a href="#val-response_format_of_sexp" class="anchor"></a><code><span><span class="keyword">val</span> response_format_of_sexp : <span><span class="xref-unresolved">Sexplib0</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-response_format">response_format</a></span></code></div></div><p>Desired format for the assistant reply. For example setting <code>{type_ = &quot;json_object&quot;; _}</code> instructs the model to emit valid JSON.</p><div class="odoc-spec"><div class="spec type anchored" id="type-delta"><a href="#type-delta" class="anchor"></a><code><span><span class="keyword">type</span> delta</span><span> = </span><span>{</span></code><ol><li id="type-delta.content" class="def record field anchored"><a href="#type-delta.content" class="anchor"></a><code><span>content : <span>string option</span>;</span></code></li><li id="type-delta.function_call" class="def record field anchored"><a href="#type-delta.function_call" class="anchor"></a><code><span>function_call : <span><a href="#type-function_call">function_call</a> option</span>;</span></code></li><li id="type-delta.refusal" class="def record field anchored"><a href="#type-delta.refusal" class="anchor"></a><code><span>refusal : <span>string option</span>;</span></code></li><li id="type-delta.role" class="def record field anchored"><a href="#type-delta.role" class="anchor"></a><code><span>role : <span>string option</span>;</span></code></li><li id="type-delta.tool_calls" class="def record field anchored"><a href="#type-delta.tool_calls" class="anchor"></a><code><span>tool_calls : <span><span><a href="#type-tool_call_chunk">tool_call_chunk</a> list</span> option</span>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-jsonaf_of_delta"><a href="#val-jsonaf_of_delta" class="anchor"></a><code><span><span class="keyword">val</span> jsonaf_of_delta : <span><a href="#type-delta">delta</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-delta_of_jsonaf"><a href="#val-delta_of_jsonaf" class="anchor"></a><code><span><span class="keyword">val</span> delta_of_jsonaf : <span><span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-delta">delta</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sexp_of_delta"><a href="#val-sexp_of_delta" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_delta : <span><a href="#type-delta">delta</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Sexplib0</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-delta_of_sexp"><a href="#val-delta_of_sexp" class="anchor"></a><code><span><span class="keyword">val</span> delta_of_sexp : <span><span class="xref-unresolved">Sexplib0</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-delta">delta</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_shape_delta"><a href="#val-bin_shape_delta" class="anchor"></a><code><span><span class="keyword">val</span> bin_shape_delta : <span class="xref-unresolved">Bin_prot</span>.Shape.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_size_delta"><a href="#val-bin_size_delta" class="anchor"></a><code><span><span class="keyword">val</span> bin_size_delta : <span><a href="#type-delta">delta</a> <span class="xref-unresolved">Bin_prot</span>.Size.sizer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_write_delta"><a href="#val-bin_write_delta" class="anchor"></a><code><span><span class="keyword">val</span> bin_write_delta : <span><a href="#type-delta">delta</a> <span class="xref-unresolved">Bin_prot</span>.Write.writer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_writer_delta"><a href="#val-bin_writer_delta" class="anchor"></a><code><span><span class="keyword">val</span> bin_writer_delta : <span><a href="#type-delta">delta</a> <span class="xref-unresolved">Bin_prot</span>.Type_class.writer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_read_delta"><a href="#val-bin_read_delta" class="anchor"></a><code><span><span class="keyword">val</span> bin_read_delta : <span><a href="#type-delta">delta</a> <span class="xref-unresolved">Bin_prot</span>.Read.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-__bin_read_delta__"><a href="#val-__bin_read_delta__" class="anchor"></a><code><span><span class="keyword">val</span> __bin_read_delta__ : <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> <a href="#type-delta">delta</a>)</span> <span class="xref-unresolved">Bin_prot</span>.Read.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_reader_delta"><a href="#val-bin_reader_delta" class="anchor"></a><code><span><span class="keyword">val</span> bin_reader_delta : <span><a href="#type-delta">delta</a> <span class="xref-unresolved">Bin_prot</span>.Type_class.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_delta"><a href="#val-bin_delta" class="anchor"></a><code><span><span class="keyword">val</span> bin_delta : <span><a href="#type-delta">delta</a> <span class="xref-unresolved">Bin_prot</span>.Type_class.t</span></span></code></div></div><p>Partial update emitted when streaming is enabled. The <a href="#val-post_chat_completion"><code>post_chat_completion</code></a> function converts each chunk to a <a href="#type-stream_choice"><code>stream_choice</code></a> and passes it to the callback supplied to <a href="#type-response_type.Stream"><code>Stream</code></a>.</p><div class="odoc-spec"><div class="spec type anchored" id="type-stream_choice"><a href="#type-stream_choice" class="anchor"></a><code><span><span class="keyword">type</span> stream_choice</span><span> = </span><span>{</span></code><ol><li id="type-stream_choice.delta" class="def record field anchored"><a href="#type-stream_choice.delta" class="anchor"></a><code><span>delta : <a href="#type-delta">delta</a>;</span></code></li><li id="type-stream_choice.finish_reason" class="def record field anchored"><a href="#type-stream_choice.finish_reason" class="anchor"></a><code><span>finish_reason : <span>string option</span>;</span></code></li><li id="type-stream_choice.index" class="def record field anchored"><a href="#type-stream_choice.index" class="anchor"></a><code><span>index : int;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-jsonaf_of_stream_choice"><a href="#val-jsonaf_of_stream_choice" class="anchor"></a><code><span><span class="keyword">val</span> jsonaf_of_stream_choice : 
  <span><a href="#type-stream_choice">stream_choice</a> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-stream_choice_of_jsonaf"><a href="#val-stream_choice_of_jsonaf" class="anchor"></a><code><span><span class="keyword">val</span> stream_choice_of_jsonaf : 
  <span><span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-stream_choice">stream_choice</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sexp_of_stream_choice"><a href="#val-sexp_of_stream_choice" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_stream_choice : <span><a href="#type-stream_choice">stream_choice</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Sexplib0</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-stream_choice_of_sexp"><a href="#val-stream_choice_of_sexp" class="anchor"></a><code><span><span class="keyword">val</span> stream_choice_of_sexp : <span><span class="xref-unresolved">Sexplib0</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-stream_choice">stream_choice</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_shape_stream_choice"><a href="#val-bin_shape_stream_choice" class="anchor"></a><code><span><span class="keyword">val</span> bin_shape_stream_choice : <span class="xref-unresolved">Bin_prot</span>.Shape.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_size_stream_choice"><a href="#val-bin_size_stream_choice" class="anchor"></a><code><span><span class="keyword">val</span> bin_size_stream_choice : <span><a href="#type-stream_choice">stream_choice</a> <span class="xref-unresolved">Bin_prot</span>.Size.sizer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_write_stream_choice"><a href="#val-bin_write_stream_choice" class="anchor"></a><code><span><span class="keyword">val</span> bin_write_stream_choice : <span><a href="#type-stream_choice">stream_choice</a> <span class="xref-unresolved">Bin_prot</span>.Write.writer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_writer_stream_choice"><a href="#val-bin_writer_stream_choice" class="anchor"></a><code><span><span class="keyword">val</span> bin_writer_stream_choice : <span><a href="#type-stream_choice">stream_choice</a> <span class="xref-unresolved">Bin_prot</span>.Type_class.writer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_read_stream_choice"><a href="#val-bin_read_stream_choice" class="anchor"></a><code><span><span class="keyword">val</span> bin_read_stream_choice : <span><a href="#type-stream_choice">stream_choice</a> <span class="xref-unresolved">Bin_prot</span>.Read.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-__bin_read_stream_choice__"><a href="#val-__bin_read_stream_choice__" class="anchor"></a><code><span><span class="keyword">val</span> __bin_read_stream_choice__ : <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> <a href="#type-stream_choice">stream_choice</a>)</span> <span class="xref-unresolved">Bin_prot</span>.Read.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_reader_stream_choice"><a href="#val-bin_reader_stream_choice" class="anchor"></a><code><span><span class="keyword">val</span> bin_reader_stream_choice : <span><a href="#type-stream_choice">stream_choice</a> <span class="xref-unresolved">Bin_prot</span>.Type_class.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_stream_choice"><a href="#val-bin_stream_choice" class="anchor"></a><code><span><span class="keyword">val</span> bin_stream_choice : <span><a href="#type-stream_choice">stream_choice</a> <span class="xref-unresolved">Bin_prot</span>.Type_class.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-chat_completion_chunk"><a href="#type-chat_completion_chunk" class="anchor"></a><code><span><span class="keyword">type</span> chat_completion_chunk</span><span> = </span><span>{</span></code><ol><li id="type-chat_completion_chunk.choices" class="def record field anchored"><a href="#type-chat_completion_chunk.choices" class="anchor"></a><code><span>choices : <span><a href="#type-stream_choice">stream_choice</a> list</span>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-jsonaf_of_chat_completion_chunk"><a href="#val-jsonaf_of_chat_completion_chunk" class="anchor"></a><code><span><span class="keyword">val</span> jsonaf_of_chat_completion_chunk : 
  <span><a href="#type-chat_completion_chunk">chat_completion_chunk</a> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-chat_completion_chunk_of_jsonaf"><a href="#val-chat_completion_chunk_of_jsonaf" class="anchor"></a><code><span><span class="keyword">val</span> chat_completion_chunk_of_jsonaf : 
  <span><span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-chat_completion_chunk">chat_completion_chunk</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sexp_of_chat_completion_chunk"><a href="#val-sexp_of_chat_completion_chunk" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_chat_completion_chunk : <span><a href="#type-chat_completion_chunk">chat_completion_chunk</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Sexplib0</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-chat_completion_chunk_of_sexp"><a href="#val-chat_completion_chunk_of_sexp" class="anchor"></a><code><span><span class="keyword">val</span> chat_completion_chunk_of_sexp : <span><span class="xref-unresolved">Sexplib0</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-chat_completion_chunk">chat_completion_chunk</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_shape_chat_completion_chunk"><a href="#val-bin_shape_chat_completion_chunk" class="anchor"></a><code><span><span class="keyword">val</span> bin_shape_chat_completion_chunk : <span class="xref-unresolved">Bin_prot</span>.Shape.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_size_chat_completion_chunk"><a href="#val-bin_size_chat_completion_chunk" class="anchor"></a><code><span><span class="keyword">val</span> bin_size_chat_completion_chunk : <span><a href="#type-chat_completion_chunk">chat_completion_chunk</a> <span class="xref-unresolved">Bin_prot</span>.Size.sizer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_write_chat_completion_chunk"><a href="#val-bin_write_chat_completion_chunk" class="anchor"></a><code><span><span class="keyword">val</span> bin_write_chat_completion_chunk : 
  <span><a href="#type-chat_completion_chunk">chat_completion_chunk</a> <span class="xref-unresolved">Bin_prot</span>.Write.writer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_writer_chat_completion_chunk"><a href="#val-bin_writer_chat_completion_chunk" class="anchor"></a><code><span><span class="keyword">val</span> bin_writer_chat_completion_chunk : 
  <span><a href="#type-chat_completion_chunk">chat_completion_chunk</a> <span class="xref-unresolved">Bin_prot</span>.Type_class.writer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_read_chat_completion_chunk"><a href="#val-bin_read_chat_completion_chunk" class="anchor"></a><code><span><span class="keyword">val</span> bin_read_chat_completion_chunk : <span><a href="#type-chat_completion_chunk">chat_completion_chunk</a> <span class="xref-unresolved">Bin_prot</span>.Read.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-__bin_read_chat_completion_chunk__"><a href="#val-__bin_read_chat_completion_chunk__" class="anchor"></a><code><span><span class="keyword">val</span> __bin_read_chat_completion_chunk__ : 
  <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> <a href="#type-chat_completion_chunk">chat_completion_chunk</a>)</span> <span class="xref-unresolved">Bin_prot</span>.Read.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_reader_chat_completion_chunk"><a href="#val-bin_reader_chat_completion_chunk" class="anchor"></a><code><span><span class="keyword">val</span> bin_reader_chat_completion_chunk : 
  <span><a href="#type-chat_completion_chunk">chat_completion_chunk</a> <span class="xref-unresolved">Bin_prot</span>.Type_class.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_chat_completion_chunk"><a href="#val-bin_chat_completion_chunk" class="anchor"></a><code><span><span class="keyword">val</span> bin_chat_completion_chunk : <span><a href="#type-chat_completion_chunk">chat_completion_chunk</a> <span class="xref-unresolved">Bin_prot</span>.Type_class.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-default_choice"><a href="#type-default_choice" class="anchor"></a><code><span><span class="keyword">type</span> default_choice</span><span> = </span><span>{</span></code><ol><li id="type-default_choice.finish_reason" class="def record field anchored"><a href="#type-default_choice.finish_reason" class="anchor"></a><code><span>finish_reason : <span>string option</span>;</span></code></li><li id="type-default_choice.message" class="def record field anchored"><a href="#type-default_choice.message" class="anchor"></a><code><span>message : <a href="#type-message">message</a>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-jsonaf_of_default_choice"><a href="#val-jsonaf_of_default_choice" class="anchor"></a><code><span><span class="keyword">val</span> jsonaf_of_default_choice : 
  <span><a href="#type-default_choice">default_choice</a> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-default_choice_of_jsonaf"><a href="#val-default_choice_of_jsonaf" class="anchor"></a><code><span><span class="keyword">val</span> default_choice_of_jsonaf : 
  <span><span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-default_choice">default_choice</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sexp_of_default_choice"><a href="#val-sexp_of_default_choice" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_default_choice : <span><a href="#type-default_choice">default_choice</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Sexplib0</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-default_choice_of_sexp"><a href="#val-default_choice_of_sexp" class="anchor"></a><code><span><span class="keyword">val</span> default_choice_of_sexp : <span><span class="xref-unresolved">Sexplib0</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-default_choice">default_choice</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_shape_default_choice"><a href="#val-bin_shape_default_choice" class="anchor"></a><code><span><span class="keyword">val</span> bin_shape_default_choice : <span class="xref-unresolved">Bin_prot</span>.Shape.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_size_default_choice"><a href="#val-bin_size_default_choice" class="anchor"></a><code><span><span class="keyword">val</span> bin_size_default_choice : <span><a href="#type-default_choice">default_choice</a> <span class="xref-unresolved">Bin_prot</span>.Size.sizer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_write_default_choice"><a href="#val-bin_write_default_choice" class="anchor"></a><code><span><span class="keyword">val</span> bin_write_default_choice : <span><a href="#type-default_choice">default_choice</a> <span class="xref-unresolved">Bin_prot</span>.Write.writer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_writer_default_choice"><a href="#val-bin_writer_default_choice" class="anchor"></a><code><span><span class="keyword">val</span> bin_writer_default_choice : <span><a href="#type-default_choice">default_choice</a> <span class="xref-unresolved">Bin_prot</span>.Type_class.writer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_read_default_choice"><a href="#val-bin_read_default_choice" class="anchor"></a><code><span><span class="keyword">val</span> bin_read_default_choice : <span><a href="#type-default_choice">default_choice</a> <span class="xref-unresolved">Bin_prot</span>.Read.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-__bin_read_default_choice__"><a href="#val-__bin_read_default_choice__" class="anchor"></a><code><span><span class="keyword">val</span> __bin_read_default_choice__ : <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> <a href="#type-default_choice">default_choice</a>)</span> <span class="xref-unresolved">Bin_prot</span>.Read.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_reader_default_choice"><a href="#val-bin_reader_default_choice" class="anchor"></a><code><span><span class="keyword">val</span> bin_reader_default_choice : <span><a href="#type-default_choice">default_choice</a> <span class="xref-unresolved">Bin_prot</span>.Type_class.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_default_choice"><a href="#val-bin_default_choice" class="anchor"></a><code><span><span class="keyword">val</span> bin_default_choice : <span><a href="#type-default_choice">default_choice</a> <span class="xref-unresolved">Bin_prot</span>.Type_class.t</span></span></code></div></div><p>Completed choice when the request is *not* streamed. The field <code>message</code> contains the assistant answer. <code>finish_reason</code> mirrors OpenAI‚Äôs reasons such as <code>&quot;stop&quot;</code>, <code>&quot;length&quot;</code>, etc.</p><div class="odoc-spec"><div class="spec type anchored" id="type-chat_completion"><a href="#type-chat_completion" class="anchor"></a><code><span><span class="keyword">type</span> chat_completion</span><span> = </span><span>{</span></code><ol><li id="type-chat_completion.choices" class="def record field anchored"><a href="#type-chat_completion.choices" class="anchor"></a><code><span>choices : <span><a href="#type-default_choice">default_choice</a> list</span>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-jsonaf_of_chat_completion"><a href="#val-jsonaf_of_chat_completion" class="anchor"></a><code><span><span class="keyword">val</span> jsonaf_of_chat_completion : 
  <span><a href="#type-chat_completion">chat_completion</a> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-chat_completion_of_jsonaf"><a href="#val-chat_completion_of_jsonaf" class="anchor"></a><code><span><span class="keyword">val</span> chat_completion_of_jsonaf : 
  <span><span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-chat_completion">chat_completion</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sexp_of_chat_completion"><a href="#val-sexp_of_chat_completion" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_chat_completion : <span><a href="#type-chat_completion">chat_completion</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Sexplib0</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-chat_completion_of_sexp"><a href="#val-chat_completion_of_sexp" class="anchor"></a><code><span><span class="keyword">val</span> chat_completion_of_sexp : <span><span class="xref-unresolved">Sexplib0</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-chat_completion">chat_completion</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_shape_chat_completion"><a href="#val-bin_shape_chat_completion" class="anchor"></a><code><span><span class="keyword">val</span> bin_shape_chat_completion : <span class="xref-unresolved">Bin_prot</span>.Shape.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_size_chat_completion"><a href="#val-bin_size_chat_completion" class="anchor"></a><code><span><span class="keyword">val</span> bin_size_chat_completion : <span><a href="#type-chat_completion">chat_completion</a> <span class="xref-unresolved">Bin_prot</span>.Size.sizer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_write_chat_completion"><a href="#val-bin_write_chat_completion" class="anchor"></a><code><span><span class="keyword">val</span> bin_write_chat_completion : <span><a href="#type-chat_completion">chat_completion</a> <span class="xref-unresolved">Bin_prot</span>.Write.writer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_writer_chat_completion"><a href="#val-bin_writer_chat_completion" class="anchor"></a><code><span><span class="keyword">val</span> bin_writer_chat_completion : <span><a href="#type-chat_completion">chat_completion</a> <span class="xref-unresolved">Bin_prot</span>.Type_class.writer</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_read_chat_completion"><a href="#val-bin_read_chat_completion" class="anchor"></a><code><span><span class="keyword">val</span> bin_read_chat_completion : <span><a href="#type-chat_completion">chat_completion</a> <span class="xref-unresolved">Bin_prot</span>.Read.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-__bin_read_chat_completion__"><a href="#val-__bin_read_chat_completion__" class="anchor"></a><code><span><span class="keyword">val</span> __bin_read_chat_completion__ : 
  <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> <a href="#type-chat_completion">chat_completion</a>)</span> <span class="xref-unresolved">Bin_prot</span>.Read.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_reader_chat_completion"><a href="#val-bin_reader_chat_completion" class="anchor"></a><code><span><span class="keyword">val</span> bin_reader_chat_completion : <span><a href="#type-chat_completion">chat_completion</a> <span class="xref-unresolved">Bin_prot</span>.Type_class.reader</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bin_chat_completion"><a href="#val-bin_chat_completion" class="anchor"></a><code><span><span class="keyword">val</span> bin_chat_completion : <span><a href="#type-chat_completion">chat_completion</a> <span class="xref-unresolved">Bin_prot</span>.Type_class.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-response_type"><a href="#type-response_type" class="anchor"></a><code><span><span class="keyword">type</span> <span>_ response_type</span></span><span> = </span></code><ol><li id="type-response_type.Stream" class="def variant constructor anchored"><a href="#type-response_type.Stream" class="anchor"></a><code><span>| </span><span><span class="constructor">Stream</span> : <span>(<span><a href="#type-stream_choice">stream_choice</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span> <span>unit <a href="#type-response_type">response_type</a></span></span></code></li><li id="type-response_type.Default" class="def variant constructor anchored"><a href="#type-response_type.Default" class="anchor"></a><code><span>| </span><span><span class="constructor">Default</span> : <span><a href="#type-default_choice">default_choice</a> <a href="#type-response_type">response_type</a></span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-model"><a href="#type-model" class="anchor"></a><code><span><span class="keyword">type</span> model</span><span> = </span></code><ol><li id="type-model.O3" class="def variant constructor anchored"><a href="#type-model.O3" class="anchor"></a><code><span>| </span><span><span class="constructor">O3</span></span></code></li><li id="type-model.O3_mini" class="def variant constructor anchored"><a href="#type-model.O3_mini" class="anchor"></a><code><span>| </span><span><span class="constructor">O3_mini</span></span></code></li><li id="type-model.Gpt4" class="def variant constructor anchored"><a href="#type-model.Gpt4" class="anchor"></a><code><span>| </span><span><span class="constructor">Gpt4</span></span></code></li><li id="type-model.O4_mini" class="def variant constructor anchored"><a href="#type-model.O4_mini" class="anchor"></a><code><span>| </span><span><span class="constructor">O4_mini</span></span></code></li><li id="type-model.Gpt4o" class="def variant constructor anchored"><a href="#type-model.Gpt4o" class="anchor"></a><code><span>| </span><span><span class="constructor">Gpt4o</span></span></code></li><li id="type-model.Gpt4_1" class="def variant constructor anchored"><a href="#type-model.Gpt4_1" class="anchor"></a><code><span>| </span><span><span class="constructor">Gpt4_1</span></span></code></li><li id="type-model.Gpt3" class="def variant constructor anchored"><a href="#type-model.Gpt3" class="anchor"></a><code><span>| </span><span><span class="constructor">Gpt3</span></span></code></li><li id="type-model.Gpt3_16k" class="def variant constructor anchored"><a href="#type-model.Gpt3_16k" class="anchor"></a><code><span>| </span><span><span class="constructor">Gpt3_16k</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-jsonaf_of_model"><a href="#val-jsonaf_of_model" class="anchor"></a><code><span><span class="keyword">val</span> jsonaf_of_model : <span><a href="#type-model">model</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-model_of_jsonaf"><a href="#val-model_of_jsonaf" class="anchor"></a><code><span><span class="keyword">val</span> model_of_jsonaf : <span><span class="xref-unresolved">Ppx_jsonaf_conv_lib</span>.Jsonaf_kernel.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-model">model</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sexp_of_model"><a href="#val-sexp_of_model" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_model : <span><a href="#type-model">model</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Sexplib0</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-model_of_sexp"><a href="#val-model_of_sexp" class="anchor"></a><code><span><span class="keyword">val</span> model_of_sexp : <span><span class="xref-unresolved">Sexplib0</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-model">model</a></span></code></div></div><p>Supported model identifiers (subset). Use <a href="#val-model_of_str_exn"><code>model_of_str_exn</code></a> to convert a raw string received from configuration or user input.</p><div class="odoc-spec"><div class="spec value anchored" id="val-model_of_str_exn"><a href="#val-model_of_str_exn" class="anchor"></a><code><span><span class="keyword">val</span> model_of_str_exn : <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-model">model</a></span></code></div></div><p><code>model_of_str_exn s</code> converts <code>s</code> to a concrete <a href="#type-model"><code>model</code></a> value. </p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Failure</code> <p>if <code>s</code> is not a recognised model name.</p></li></ul><div class="odoc-spec"><div class="spec value anchored" id="val-post_chat_completion"><a href="#val-post_chat_completion" class="anchor"></a><code><span><span class="keyword">val</span> post_chat_completion : 
  'a. <span><span><span class="type-var">'a</span> <a href="#type-response_type">response_type</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?max_tokens</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?temperature</span>:float <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?functions</span>:<span><a href="#type-func">func</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?tools</span>:<span><a href="#type-tool">tool</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?model</span>:<a href="#type-model">model</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?reasoning_effort</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">dir</span>:<span><span class="xref-unresolved">Eio</span>.Fs.dir_ty <span class="xref-unresolved">Eio</span>.Path.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'n</span> <span class="xref-unresolved">Eio</span>.Net.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">inputs</span>:<span><a href="#type-chat_message">chat_message</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>post_chat_completion res ?max_tokens ?temperature ?functions ?tools ?model ?reasoning_effort ~dir net ~inputs</code> sends the chat messages <code>inputs</code> to the OpenAI completions endpoint and returns a value that depends on <code>res</code>:</p><p>‚Ä¢ <code>Default</code> ‚Äì returns a <a href="#type-default_choice"><code>default_choice</code></a> containing the full assistant reply. ‚Ä¢ <code>Stream f</code> ‚Äì enables server-side streaming and invokes the callback <code>f</code> for every <a href="#type-stream_choice"><code>stream_choice</code></a> chunk received. The function then returns <code>unit</code>.</p><p>Parameters:</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">max_tokens</span> <p>Hard cap on tokens generated by the model (default 600).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">temperature</span> <p>Sampling temperature in the range <code>0,2</code>.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">functions</span> <p>List of function descriptions the model may call (legacy API).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">tools</span> <p>Rich tool list (preferred over <code>functions</code>).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">model</span> <p>Target model (default <a href="#type-model.Gpt4"><code>Gpt4</code></a>).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">reasoning_effort</span> <p>Hints the preferred quality/speed trade-off.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">dir</span> <p>Directory capability used by the helper <a href="../../Io/index.html#val-log"><code>Io.log</code></a> to dump debugging traces.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">net</span> <p>Network capability obtained from <code>Eio.Stdenv.net</code>.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">inputs</span> <p>Ordered list of user and system messages.</p></li></ul><p>Example ‚Äì blocking call:</p><pre class="language-ocaml"><code>  let reply =
    Completions.post_chat_completion
      Completions.Default
      ~dir
      net
      ~inputs:[ (* build messages *) ]
  in
  Format.printf &quot;Assistant said: %s\n&quot;
    (Option.value ~default:&quot;&quot; reply.message.content)</code></pre><p>Example ‚Äì streaming call:</p><pre class="language-ocaml"><code>  let stdout_choice { Completions.delta = { content; _ }; _ } =
    Option.iter content ~f:print_endline in
  Completions.post_chat_completion
    (Completions.Stream stdout_choice)
    ~model:Completions.Gpt3
    ~dir net ~inputs</code></pre></div></div></div></body></html>
