<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Export (ochat.Chat_tui.Export)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../';
let search_urls = ['../../db.js','../../../sherlodoc.js'];
</script><script src="../../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">Index</a> &#x00BB; <a href="../../index.html">ochat</a> &#x00BB; <a href="../index.html">Chat_tui</a> &#x00BB; Export</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="ðŸ”Ž Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Chat_tui.Export</span></code></h1></header><div class="odoc-content"><p>Archive the current conversation to a ChatMarkdown file.</p><p>The helper mirrors the original logic embedded in <code>Chat_tui.App.run_chat</code> prior to Task 13. No behaviour has been changed â€“ the code was merely moved into its own compilation unit so that it can be reused from different entry-points (CLI, TUI, tests).</p><p>Parameters:</p><ul><li><code>env</code> â€“ <code>Eio_unix.Stdenv.base</code> used for file IO.</li><li><code>model</code> â€“ in-memory UI state; only <code>history_items</code> are read.</li><li><code>prompt_file</code> â€“ original *.chatmd* file that seeded the session. It is copied verbatim to the destination directory so that the export remains self-contained.</li><li><code>target_path</code> â€“ path of the output *.chatmd* file (may be relative or absolute). Intermediate directories are created as needed.</li><li><code>cfg</code> â€“ runtime configuration parsed from the prompt; required by <a href="../Persistence/index.html#val-persist_session"><code>Chat_tui.Persistence.persist_session</code></a>.</li><li><code>initial_msg_count</code> â€“ number of static prompt messages so the persistence helper can avoid duplicating them.</li><li><code>session</code> â€“ optional active session (for attachment discovery).</li></ul><p>The function performs the following high-level steps:</p><ol><li>Ensure the parent directory of <code>target_path</code> exists.</li><li>Copy <code>prompt_file</code> into the destination directory.</li><li>Copy all attachment directories (<code>.chatmd</code>) that may reside next to the prompt, inside the current working directory, or the session directory.</li><li>Persist the runtime conversation beyond the static prompt using <a href="../Persistence/index.html#val-persist_session"><code>Chat_tui.Persistence.persist_session</code></a>.</li></ol><p>The implementation is mostly lifted as-is from the original <code>do_export</code> closure in <code>app.ml</code> with minor refactorings for parameterisation.</p><div class="odoc-spec"><div class="spec value anchored" id="val-archive"><a href="#val-archive" class="anchor"></a><code><span><span class="keyword">val</span> archive : 
  <span><span class="label">env</span>:<span class="xref-unresolved">Eio_unix</span>.Stdenv.base <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">model</span>:<a href="../Model/index.html#type-t">Model.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">prompt_file</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">target_path</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">cfg</span>:<a href="../../Chat_response/Config/index.html#type-t">Chat_response.Config.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">initial_msg_count</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">session</span>:<span><a href="../../Session/index.html#type-t">Session.t</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div></div></body></html>
