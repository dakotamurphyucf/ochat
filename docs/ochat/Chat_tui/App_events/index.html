<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>App_events (ochat.Chat_tui.App_events)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../';
let search_urls = ['../../db.js','../../../sherlodoc.js'];
</script><script src="../../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">Index</a> &#x00BB; <a href="../../index.html">ochat</a> &#x00BB; <a href="../index.html">Chat_tui</a> &#x00BB; App_events</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="ðŸ”Ž Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Chat_tui.App_events</span></code></h1><p>Event types used by <a href="../App/index.html"><code>Chat_tui.App</code></a>'s event loop.</p><p><a href="../App/index.html"><code>Chat_tui.App</code></a> uses two event queues:</p><ul><li><code>input_event</code> values coming from <a href="../../Notty_eio/Term/index.html#val-run"><code>Notty_eio.Term.run</code></a>.</li><li><code>internal_event</code> values produced by background fibres (streaming and compaction, type-ahead) and by the redraw scheduler.</li></ul><p>Streaming and compaction events are tagged with an operation id allocated by <a href="../App_runtime/index.html#val-alloc_op_id"><code>Chat_tui.App_runtime.alloc_op_id</code></a>. The reducer discards events whose id does not match the currently active operation, which makes it safe for cancelled worker fibres to race with new work.</p><p>Type-ahead completion uses the same pattern: a background worker publishes <code>`Typeahead_started</code> with its switch, then eventually reports <code>`Typeahead_done</code> / <code>`Typeahead_error</code>. The reducer additionally validates a completion against a snapshot (generation, base input, base cursor) so a stale suggestion cannot be applied after further editing.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-input_event"><a href="#type-input_event" class="anchor"></a><code><span><span class="keyword">type</span> input_event</span><span> = <span class="xref-unresolved">Notty</span>.Unescape.event</span></code></div><div class="spec-doc"><p>Raw terminal events (keypresses, paste start/end, ...).</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-typeahead_done"><a href="#type-typeahead_done" class="anchor"></a><code><span><span class="keyword">type</span> typeahead_done</span><span> = </span><span>{</span></code><ol><li id="type-typeahead_done.generation" class="def record field anchored"><a href="#type-typeahead_done.generation" class="anchor"></a><code><span>generation : int;</span></code></li><li id="type-typeahead_done.base_input" class="def record field anchored"><a href="#type-typeahead_done.base_input" class="anchor"></a><code><span>base_input : string;</span></code></li><li id="type-typeahead_done.base_cursor" class="def record field anchored"><a href="#type-typeahead_done.base_cursor" class="anchor"></a><code><span>base_cursor : int;</span></code></li><li id="type-typeahead_done.text" class="def record field anchored"><a href="#type-typeahead_done.text" class="anchor"></a><code><span>text : string;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Payload emitted when a type-ahead request completes successfully.</p><p>The fields form a snapshot of the editor at the time the request was started:</p><ul><li><code>generation</code> is <a href="../Model/index.html#type-t.typeahead_generation"><code>Chat_tui.Model.t.typeahead_generation</code></a> when the request was launched.</li><li><code>base_input</code> is the full draft buffer.</li><li><code>base_cursor</code> is the cursor position (byte offset) within <code>base_input</code>.</li><li><code>text</code> is the suggested suffix to insert at <code>base_cursor</code>.</li></ul><p>The reducer compares these fields to the current model state and applies the completion only when it is still applicable.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-internal_event"><a href="#type-internal_event" class="anchor"></a><code><span><span class="keyword">type</span> internal_event</span><span> = </span><span>[ </span></code><ol><li id="type-internal_event.Resize" class="def variant constructor anchored"><a href="#type-internal_event.Resize" class="anchor"></a><code><span>| </span><span>`Resize</span></code></li><li id="type-internal_event.Redraw" class="def variant constructor anchored"><a href="#type-internal_event.Redraw" class="anchor"></a><code><span>| </span><span>`Redraw</span></code></li><li id="type-internal_event.Streaming_started" class="def variant constructor anchored"><a href="#type-internal_event.Streaming_started" class="anchor"></a><code><span>| </span><span>`Streaming_started <span class="keyword">of</span> int * <span class="xref-unresolved">Eio</span>.Switch.t</span></code></li><li id="type-internal_event.Stream" class="def variant constructor anchored"><a href="#type-internal_event.Stream" class="anchor"></a><code><span>| </span><span>`Stream <span class="keyword">of</span> int * <a href="../../Openai/Responses/Response_stream/index.html#type-t">Openai.Responses.Response_stream.t</a></span></code></li><li id="type-internal_event.Stream_batch" class="def variant constructor anchored"><a href="#type-internal_event.Stream_batch" class="anchor"></a><code><span>| </span><span>`Stream_batch <span class="keyword">of</span> int * <span><a href="../../Openai/Responses/Response_stream/index.html#type-t">Openai.Responses.Response_stream.t</a> list</span></span></code></li><li id="type-internal_event.Tool_output" class="def variant constructor anchored"><a href="#type-internal_event.Tool_output" class="anchor"></a><code><span>| </span><span>`Tool_output <span class="keyword">of</span> int * <a href="../../Openai/Responses/Item/index.html#type-t">Openai.Responses.Item.t</a></span></code></li><li id="type-internal_event.Streaming_done" class="def variant constructor anchored"><a href="#type-internal_event.Streaming_done" class="anchor"></a><code><span>| </span><span>`Streaming_done <span class="keyword">of</span> int * <span><a href="../../Openai/Responses/Item/index.html#type-t">Openai.Responses.Item.t</a> list</span></span></code></li><li id="type-internal_event.Streaming_error" class="def variant constructor anchored"><a href="#type-internal_event.Streaming_error" class="anchor"></a><code><span>| </span><span>`Streaming_error <span class="keyword">of</span> int * exn</span></code></li><li id="type-internal_event.Typeahead_started" class="def variant constructor anchored"><a href="#type-internal_event.Typeahead_started" class="anchor"></a><code><span>| </span><span>`Typeahead_started <span class="keyword">of</span> int * <span class="xref-unresolved">Eio</span>.Switch.t</span></code></li><li id="type-internal_event.Typeahead_done" class="def variant constructor anchored"><a href="#type-internal_event.Typeahead_done" class="anchor"></a><code><span>| </span><span>`Typeahead_done <span class="keyword">of</span> int * <a href="#type-typeahead_done">typeahead_done</a></span></code></li><li id="type-internal_event.Typeahead_error" class="def variant constructor anchored"><a href="#type-internal_event.Typeahead_error" class="anchor"></a><code><span>| </span><span>`Typeahead_error <span class="keyword">of</span> int * exn</span></code></li><li id="type-internal_event.Submit_requested" class="def variant constructor anchored"><a href="#type-internal_event.Submit_requested" class="anchor"></a><code><span>| </span><span>`Submit_requested <span class="keyword">of</span> <a href="../App_runtime/index.html#type-submit_request">App_runtime.submit_request</a></span></code></li><li id="type-internal_event.Compact_requested" class="def variant constructor anchored"><a href="#type-internal_event.Compact_requested" class="anchor"></a><code><span>| </span><span>`Compact_requested</span></code></li><li id="type-internal_event.Compaction_started" class="def variant constructor anchored"><a href="#type-internal_event.Compaction_started" class="anchor"></a><code><span>| </span><span>`Compaction_started <span class="keyword">of</span> int * <span class="xref-unresolved">Eio</span>.Switch.t</span></code></li><li id="type-internal_event.Compaction_done" class="def variant constructor anchored"><a href="#type-internal_event.Compaction_done" class="anchor"></a><code><span>| </span><span>`Compaction_done <span class="keyword">of</span> int * <span><a href="../../Openai/Responses/Item/index.html#type-t">Openai.Responses.Item.t</a> list</span></span></code></li><li id="type-internal_event.Compaction_error" class="def variant constructor anchored"><a href="#type-internal_event.Compaction_error" class="anchor"></a><code><span>| </span><span>`Compaction_error <span class="keyword">of</span> int * exn</span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>Internal events emitted by helper fibres and schedulers.</p><p>The reducer treats the following events as operation lifecycle messages scoped by the tagged id:</p><ul><li><code>`Streaming_*</code> â€“ assistant streaming request lifecycle.</li><li><code>`Compaction_*</code> â€“ history compaction lifecycle.</li><li><code>`Typeahead_*</code> â€“ type-ahead completion lifecycle.</li></ul></div></div></div></body></html>
