<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Highlight_grammars (ochat.Chat_tui.Highlight_grammars)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../';
let search_urls = ['../../db.js','../../../sherlodoc.js'];
</script><script src="../../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> ‚Äì <a href="../../../index.html">Index</a> &#x00BB; <a href="../../index.html">ochat</a> &#x00BB; <a href="../index.html">Chat_tui</a> &#x00BB; Highlight_grammars</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="üîé Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Chat_tui.Highlight_grammars</span></code></h1><p>Vendored or built-in TextMate grammars bundled with the TUI.</p><p><code>Chat_tui.Highlight_grammars</code> exposes helpers that register a curated set of TextMate grammars into a <code>Highlight_tm_loader.registry</code>. Each function is independent so that call-sites can choose exactly which grammars to install, or they can rely on <a href="../Highlight_registry/index.html#val-get"><code>Chat_tui.Highlight_registry.get</code></a> for a pre-populated registry.</p><p>Grammar contents and patterns are implementation details: they may evolve over time without breaking callers, as long as scope names and language tags remain stable.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-add_ocaml"><a href="#val-add_ocaml" class="anchor"></a><code><span><span class="keyword">val</span> add_ocaml : <span><a href="../Highlight_tm_loader/index.html#type-registry">Highlight_tm_loader.registry</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Core</span>.Or_error.t</span></span></code></div><div class="spec-doc"><p><code>add_ocaml reg</code> adds an OCaml grammar (scopeName = <code>&quot;source.ocaml&quot;</code>) to <code>reg</code>. The function first tries vendored grammars <code>lib/chat_tui/grammars/ocaml.json</code> and <code>lib/chat_tui/grammars/ocaml.tmLanguage.json</code>; if neither is available or valid it falls back to a small embedded grammar.</p><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>Ok ()</code> on success, or <code>Error _</code> if all attempts to load a valid grammar fail.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_dune"><a href="#val-add_dune" class="anchor"></a><code><span><span class="keyword">val</span> add_dune : <span><a href="../Highlight_tm_loader/index.html#type-registry">Highlight_tm_loader.registry</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Core</span>.Or_error.t</span></span></code></div><div class="spec-doc"><p><code>add_dune reg</code> adds a Dune grammar (scopeName = <code>&quot;source.dune&quot;</code>) to <code>reg</code>. The grammar is embedded in the binary and covers typical <code>dune</code>, <code>dune-project</code>, and <code>dune-workspace</code> forms.</p><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>Ok ()</code> on success, or <code>Error _</code> if the embedded grammar cannot be parsed or converted.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_opam"><a href="#val-add_opam" class="anchor"></a><code><span><span class="keyword">val</span> add_opam : <span><a href="../Highlight_tm_loader/index.html#type-registry">Highlight_tm_loader.registry</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Core</span>.Or_error.t</span></span></code></div><div class="spec-doc"><p><code>add_opam reg</code> adds an OPAM grammar (scopeName = <code>&quot;source.opam&quot;</code>) to <code>reg</code>. The grammar is embedded and targets typical <code>.opam</code> manifest files.</p><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>Ok ()</code> on success, or <code>Error _</code> if the embedded grammar cannot be parsed or converted.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_shell"><a href="#val-add_shell" class="anchor"></a><code><span><span class="keyword">val</span> add_shell : <span><a href="../Highlight_tm_loader/index.html#type-registry">Highlight_tm_loader.registry</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Core</span>.Or_error.t</span></span></code></div><div class="spec-doc"><p><code>add_shell reg</code> adds a Shell/Bash grammar (scopeName = <code>&quot;source.shell&quot;</code>) to <code>reg</code>. The grammar is embedded and recognises POSIX shell and Bash constructs; common extensions <code>sh</code> and <code>bash</code> are resolved by the loader.</p><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>Ok ()</code> on success, or <code>Error _</code> if the embedded grammar cannot be parsed or converted.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_diff"><a href="#val-add_diff" class="anchor"></a><code><span><span class="keyword">val</span> add_diff : <span><a href="../Highlight_tm_loader/index.html#type-registry">Highlight_tm_loader.registry</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Core</span>.Or_error.t</span></span></code></div><div class="spec-doc"><p><code>add_diff reg</code> adds a Diff grammar (scopeName = <code>&quot;source.diff&quot;</code>) to <code>reg</code>. The grammar is embedded and highlights unified diff headers, hunk markers, and line prefixes for insertions, deletions, and context.</p><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>Ok ()</code> on success, or <code>Error _</code> if the embedded grammar cannot be parsed or converted.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_ochat_apply_patch"><a href="#val-add_ochat_apply_patch" class="anchor"></a><code><span><span class="keyword">val</span> add_ochat_apply_patch : 
  <span><a href="../Highlight_tm_loader/index.html#type-registry">Highlight_tm_loader.registry</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Core</span>.Or_error.t</span></span></code></div><div class="spec-doc"><p><code>add_ochat_apply_patch reg</code> adds the ochat <code>apply_patch</code> grammar (scopeName = <code>&quot;source.ochat-apply-patch&quot;</code>) to <code>reg</code>.</p><p>The grammar is tuned for the multi-pane patch view produced by the <code>ochat.apply_patch</code> tool. It recognises:</p><ul><li>the Unicode banner line starting with <code>&quot;‚îè‚îÅ[&quot;] and captures the filename separately;} {- per-file operation headers such as [&quot;*** Add File:&quot;], [&quot;*** Update File:&quot;], and [&quot;*** Delete File:&quot;];} {- numbered snippet lines of the form [&quot;  42 | code&quot;], highlighting the numeric margin and delegating the right-hand side to the Diff grammar via [&quot;source.diff&quot;].}} This is intended for internal tooling rather than general-purpose patch files. @return [Ok ()] on success, or [Error _] if the embedded grammar cannot be parsed or converted. </code></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_json"><a href="#val-add_json" class="anchor"></a><code><span><span class="keyword">val</span> add_json : <span><a href="../Highlight_tm_loader/index.html#type-registry">Highlight_tm_loader.registry</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Core</span>.Or_error.t</span></span></code></div><div class="spec-doc"><p><code>add_json reg</code> adds a JSON grammar (scopeName = <code>&quot;source.json&quot;</code>) to <code>reg</code>. The grammar is embedded and recognises object keys, strings, numbers, booleans, and <code>null</code>.</p><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>Ok ()</code> on success, or <code>Error _</code> if the embedded grammar cannot be parsed or converted.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_markdown"><a href="#val-add_markdown" class="anchor"></a><code><span><span class="keyword">val</span> add_markdown : <span><a href="../Highlight_tm_loader/index.html#type-registry">Highlight_tm_loader.registry</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Core</span>.Or_error.t</span></span></code></div><div class="spec-doc"><p><code>add_markdown reg</code> adds a Markdown grammar (scopeName = <code>&quot;source.gfm&quot;</code>) to <code>reg</code> by loading <code>lib/chat_tui/grammars/markdown.tmLanguage.json</code>. The grammar is intended for GitHub-flavoured Markdown and is used for both prose paragraphs and fenced code blocks.</p><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>Ok ()</code> on success, or <code>Error _</code> if the file cannot be read, parsed, or converted to a valid grammar. There is currently no embedded fallback; callers that ignore errors will see Markdown rendered as plain text.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_html"><a href="#val-add_html" class="anchor"></a><code><span><span class="keyword">val</span> add_html : <span><a href="../Highlight_tm_loader/index.html#type-registry">Highlight_tm_loader.registry</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Core</span>.Or_error.t</span></span></code></div><div class="spec-doc"><p>Add a minimal HTML grammar and a shim for <code>text.html.derivative</code>. This enables Markdown‚Äôs embedded HTML handling (inline and blocks).</p><p><code>add_html reg</code> adds two related grammars to <code>reg</code>:</p><ul><li><code>text.html.basic</code>, a small built-in grammar with basic tag/attribute/entity/comment rules, or a vendored grammar from <code>lib/chat_tui/grammars/html.tmLanguage.json</code> when present;</li><li><code>text.html.derivative</code>, a thin shim that simply includes <code>text.html.basic</code>, keeping Markdown grammars that refer to <code>text.html.derivative</code> working.</li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>Ok ()</code> on success, or <code>Error _</code> if both the vendored and built-in HTML grammars fail to load.</p></li></ul></div></div></div></body></html>
