<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Controller_cmdline (ochat.Chat_tui.Controller_cmdline)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../';
let search_urls = ['../../db.js','../../../sherlodoc.js'];
</script><script src="../../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">Index</a> &#x00BB; <a href="../../index.html">ochat</a> &#x00BB; <a href="../index.html">Chat_tui</a> &#x00BB; Controller_cmdline</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="ğŸ” Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Chat_tui.Controller_cmdline</span></code></h1><p>Command-line controller â€“ handles Vim-style ':' prompt.</p><p>This module becomes active when the TUIâ€™s editor is in <a href="../Model/index.html#type-editor_mode.Cmdline"><code>Model.editor_mode.Cmdline</code></a> mode. While in this mode the bottom line of the UI turns into a ':' command prompt that accepts a tiny subset of ex-style commands. The responsibilities of this module are to</p><p>â€¢ mutate the <a href="../Model/index.html#type-t.cmdline"><code>Model.t.cmdline</code></a> / <a href="../Model/index.html#type-t.cmdline_cursor"><code>Model.t.cmdline_cursor</code></a> fields when the user types or moves the caret; â€¢ leave command-line mode once the command has been evaluated; â€¢ convert the command into a <a href="../Controller_types/index.html#type-reaction"><code>Controller_types.reaction</code></a> value so that the outer controller can decide whether to redraw, submit the prompt, or terminate the program.</p><p>The set of recognised commands is deliberately minimal and kept in sync with the Vim semantics wherever it makes sense:</p><p>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Command â”‚ Effect â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ `q`, `quit` â”‚ Quit the application immediately â”‚ â”‚ `w` â”‚ &quot;Write&quot; â€“ submit the current input buffer â”‚ â”‚ `wq` â”‚ Submit the buffer and then quit â”‚ â”‚ `c`, `cmp`, compact â”‚ Summarise conversation context (compact) â”‚ â”‚ `d`, delete â”‚ Delete the currently selected message â”‚ â”‚ `e`, edit â”‚ Yank the selected message into the prompt â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p><p>Unknown commands are ignored and simply trigger a redraw so the prompt disappears. All commands are matched case-insensitively.</p><p>The implementation is purely in-memory; there is no IO here â€“ the caller performs the heavy-weight operations (networking, persistence â€¦) after receiving the reaction value.</p></header><div class="odoc-content"><p><code>insert_char m c</code> inserts printable character <code>c</code> at the current cursor position inside the command-line buffer of <code>m</code>. The cursor is moved one position to the right afterwards. The function does not perform any UTF-8 validation â€“ the surrounding controller guarantees that only single-byte ASCII reaches this path.</p><div class="odoc-spec"><div class="spec value anchored" id="val-insert_char"><a href="#val-insert_char" class="anchor"></a><code><span><span class="keyword">val</span> insert_char : <span><a href="../Model/index.html#type-t">Model.t</a> <span class="arrow">&#45;&gt;</span></span> <span>char <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><p><code>backspace m</code> removes the character immediately left of the cursor in the command-line buffer of <code>m</code> and moves the cursor one position to the left. Doing nothing if the cursor is at position 0.</p><div class="odoc-spec"><div class="spec value anchored" id="val-backspace"><a href="#val-backspace" class="anchor"></a><code><span><span class="keyword">val</span> backspace : <span><a href="../Model/index.html#type-t">Model.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><p><code>execute_command m line</code> evaluates the normalized <code>line</code> (without the leading ':') and returns the resulting <code>reaction</code>. The function is case-insensitive and trims surrounding whitespace before matching.</p><p>Regardless of the commandâ€™s success the function always leaves command-line mode, clears the prompt and resets the cursor, therefore callers do not need to worry about state hygiene.</p><p>The recognised commands map to reactions as follows:</p><p>â€¢ `q`, `quit`, `wq` â†’ <code>Quit</code> â€¢ `w` â†’ <code>Submit_input</code> â€¢ `d`, `delete` â†’ Delete the currently selected message and return <code>Redraw</code> â€¢ `e`, `edit` â†’ Copy the selected message into the insert buffer and return <code>Redraw</code> â€¢ `c`, `cmp`, `compact` â†’ Summarise conversation context via <code>Compact_context</code></p><p>Any other input results in <code>Redraw</code> to signal that a screen update is needed to hide the prompt again.</p><div class="odoc-spec"><div class="spec value anchored" id="val-execute_command"><a href="#val-execute_command" class="anchor"></a><code><span><span class="keyword">val</span> execute_command : <span><a href="../Model/index.html#type-t">Model.t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <a href="../Controller_types/index.html#type-reaction">Controller_types.reaction</a></span></code></div></div><p><code>handle_key_cmdline ~model ~term ev</code> is the top-level dispatch function used by <a href="../Controller/index.html"><code>Chat_tui.Controller</code></a> while the editor is in command-line mode. It updates <code>model</code> according to the Notty <code>ev</code>ent and returns the matching <code>reaction</code> variant.</p><p>The <code>term</code> argument is ignored for now but kept in the signature for symmetry with other controller modules.</p><div class="odoc-spec"><div class="spec value anchored" id="val-handle_key_cmdline"><a href="#val-handle_key_cmdline" class="anchor"></a><code><span><span class="keyword">val</span> handle_key_cmdline : 
  <span><span class="label">model</span>:<a href="../Model/index.html#type-t">Model.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">term</span>:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Notty</span>.Unescape.event <span class="arrow">&#45;&gt;</span></span>
  <a href="../Controller_types/index.html#type-reaction">Controller_types.reaction</a></span></code></div></div></div></body></html>
