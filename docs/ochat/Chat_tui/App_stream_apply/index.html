<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>App_stream_apply (ochat.Chat_tui.App_stream_apply)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../';
let search_urls = ['../../db.js','../../../sherlodoc.js'];
</script><script src="../../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">Index</a> &#x00BB; <a href="../../index.html">ochat</a> &#x00BB; <a href="../index.html">Chat_tui</a> &#x00BB; App_stream_apply</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="ðŸ”Ž Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Chat_tui.App_stream_apply</span></code></h1><p>Apply streaming events to the UI model.</p><p>The OpenAI Responses stream produces very fine-grained updates (token deltas, tool call argument fragments, tool outputs, ...). The app reduces those events to <a href="../Types/index.html#type-patch"><code>Types.patch</code></a> lists via <a href="../Stream/index.html"><code>Chat_tui.Stream</code></a> and then applies the patches to <a href="../Model/index.html#type-t"><code>Model.t</code></a>.</p><p>This module centralises the &quot;apply + request redraw&quot; part so that the main reducer stays focused on control flow.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-apply_stream_event"><a href="#val-apply_stream_event" class="anchor"></a><code><span><span class="keyword">val</span> apply_stream_event : 
  <span><a href="../Model/index.html#type-t">Model.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Redraw_throttle/index.html#type-t">Redraw_throttle.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Openai/Responses/Response_stream/index.html#type-t">Openai.Responses.Response_stream.t</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>apply_stream_event model throttler ev</code> applies a single streaming event.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">model</span> <p>UI model to mutate by applying patches derived from <code>ev</code>.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">throttler</span> <p>Redraw throttle to notify after applying patches.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">ev</span> <p>Single OpenAI streaming event.</p></li></ul><p>Example:</p><pre class="language-ocaml"><code>  Chat_tui.App_stream_apply.apply_stream_event model throttler ev</code></pre></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-apply_stream_batch"><a href="#val-apply_stream_batch" class="anchor"></a><code><span><span class="keyword">val</span> apply_stream_batch : 
  <span><a href="../Model/index.html#type-t">Model.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Redraw_throttle/index.html#type-t">Redraw_throttle.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../Openai/Responses/Response_stream/index.html#type-t">Openai.Responses.Response_stream.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>apply_stream_batch model throttler evs</code> applies a batch of streaming events.</p><p>The helper coalesces adjacent <a href="../Types/index.html#type-patch.Append_text"><code>Types.patch.Append_text</code></a> patches targeting the same buffer to keep patch volume small without losing incremental updates.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">model</span> <p>UI model to mutate by applying patches derived from <code>evs</code>.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">throttler</span> <p>Redraw throttle to notify after applying patches.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">evs</span> <p>Batch of OpenAI streaming events to apply.</p></li></ul><p>Example:</p><pre class="language-ocaml"><code>  Chat_tui.App_stream_apply.apply_stream_batch model throttler evs</code></pre></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-apply_tool_output"><a href="#val-apply_tool_output" class="anchor"></a><code><span><span class="keyword">val</span> apply_tool_output : 
  <span><a href="../Model/index.html#type-t">Model.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Redraw_throttle/index.html#type-t">Redraw_throttle.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Openai/Responses/Item/index.html#type-t">Openai.Responses.Item.t</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>apply_tool_output model throttler item</code> applies a tool output item and appends it to the history.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">model</span> <p>UI model to mutate by applying patches derived from <code>item</code> and appending <code>item</code> to the history.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">throttler</span> <p>Redraw throttle to notify after applying patches.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">item</span> <p>History item carrying tool output.</p></li></ul><p>Example:</p><pre class="language-ocaml"><code>  Chat_tui.App_stream_apply.apply_tool_output model throttler item</code></pre></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-replace_history"><a href="#val-replace_history" class="anchor"></a><code><span><span class="keyword">val</span> replace_history : 
  <span><a href="../Model/index.html#type-t">Model.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../Openai/Responses/Item/index.html#type-t">Openai.Responses.Item.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>replace_history model redraw_immediate items</code> replaces the modelâ€™s history and derived transcript messages.</p><p>This is typically used when streaming finishes and the authoritative list of items (including tool outputs) is known.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">model</span> <p>UI model to mutate by replacing its history and rebuilding derived fields such as <code>messages</code> and the tool-output index.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">redraw_immediate</span> <p>Callback used to render immediately after replacing the history.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">items</span> <p>Full OpenAI item list that should become the new history.</p></li></ul><p>Example:</p><pre class="language-ocaml"><code>  Chat_tui.App_stream_apply.replace_history model redraw_immediate items</code></pre></div></div></div></body></html>
