<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Dune_describe (ochat.Dune_describe)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../';
let search_urls = ['../db.js','../../sherlodoc.js'];
</script><script src="../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> ‚Äì <a href="../../index.html">Index</a> &#x00BB; <a href="../index.html">ochat</a> &#x00BB; Dune_describe</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="üîé Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Dune_describe</span></code></h1><p>Query Dune build metadata using <code>dune describe</code>.</p><p>The functions in this module run the following two Dune commands and turn their Canonical‚ÄêS-expression (csexp) output into strongly-typed OCaml values:</p><pre>  dune describe external-lib-deps --format csexp
  dune describe --format csexp</pre><p>The high-level entry-point is <a href="#val-run"><code>run</code></a>. It returns a <a href="#type-project_details"><code>project_details</code></a> value that contains, for every local library and executable in the current workspace: ‚Ä¢ the direct local and external library dependencies; ‚Ä¢ the modules that make up the component and their source locations; ‚Ä¢ the external opam packages required at link-time.</p><p>All paths returned by the API point to the source tree. Dune‚Äôs internal _build context prefix is removed for convenience.</p><p>If you need the raw, low-level representation emitted by Dune you can use the nested <a href="Deps/index.html"><code>Deps</code></a> and <a href="Item/index.html"><code>Item</code></a> sub-modules, but most users should find <a href="#type-project_details"><code>project_details</code></a> sufficient.</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#example">Example</a></li><li><a href="#raw-representations">Raw representations</a></li><li><a href="#high-level-api">High-level API</a></li></ul></nav></div><div class="odoc-content"><h2 id="example"><a href="#example" class="anchor"></a>Example</h2><pre class="language-ocaml"><code>  Eio_main.run @@ fun env -&gt;
  let details = Dune_describe.run env in
  List.iter details.local_libraries ~f:(fun lib -&gt;
    Format.printf &quot;library %s depends on %a\n&quot;
      lib.name
      (Format.pp_print_list Format.pp_print_string)
      lib.external_dependencies)</code></pre><h2 id="raw-representations"><a href="#raw-representations" class="anchor"></a>Raw representations</h2><p>The sub-modules below mirror the exact structure returned by the two Dune commands so that nothing is lost in translation. They are mainly intended for advanced use-cases.</p><div class="odoc-spec"><div class="spec module anchored" id="module-Deps"><a href="#module-Deps" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Deps/index.html">Deps</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Result of <code>dune describe external-lib-deps</code>.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Item"><a href="#module-Item" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Item/index.html">Item</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Result of <code>dune describe</code>.</p></div></div><h2 id="high-level-api"><a href="#high-level-api" class="anchor"></a>High-level API</h2><div class="odoc-spec"><div class="spec type anchored" id="type-module_info"><a href="#type-module_info" class="anchor"></a><code><span><span class="keyword">type</span> module_info</span><span> = </span><span>{</span></code><ol><li id="type-module_info.module_name" class="def record field anchored"><a href="#type-module_info.module_name" class="anchor"></a><code><span>module_name : string;</span></code></li><li id="type-module_info.impl" class="def record field anchored"><a href="#type-module_info.impl" class="anchor"></a><code><span>impl : <span>string option</span>;</span></code></li><li id="type-module_info.intf" class="def record field anchored"><a href="#type-module_info.intf" class="anchor"></a><code><span>intf : <span>string option</span>;</span></code></li></ol><code><span>}</span></code></div></div><p>A compiled executable with its direct dependencies.</p><div class="odoc-spec"><div class="spec type anchored" id="type-executable_info"><a href="#type-executable_info" class="anchor"></a><code><span><span class="keyword">type</span> executable_info</span><span> = </span><span>{</span></code><ol><li id="type-executable_info.names" class="def record field anchored"><a href="#type-executable_info.names" class="anchor"></a><code><span>names : <span>string list</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>All executable names produced by the stanza.</p><span class="comment-delim">*)</span></div></li><li id="type-executable_info.local_dependencies" class="def record field anchored"><a href="#type-executable_info.local_dependencies" class="anchor"></a><code><span>local_dependencies : <span>string list</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Depends-on local libraries.</p><span class="comment-delim">*)</span></div></li><li id="type-executable_info.external_dependencies" class="def record field anchored"><a href="#type-executable_info.external_dependencies" class="anchor"></a><code><span>external_dependencies : <span>string list</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Depends-on external libraries.</p><span class="comment-delim">*)</span></div></li><li id="type-executable_info.required_external_deps" class="def record field anchored"><a href="#type-executable_info.required_external_deps" class="anchor"></a><code><span>required_external_deps : <span>string list</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>External libraries that must be present at link-time, as reported by <code>dune describe external-lib-deps</code>.</p><span class="comment-delim">*)</span></div></li><li id="type-executable_info.modules" class="def record field anchored"><a href="#type-executable_info.modules" class="anchor"></a><code><span>modules : <span><a href="#type-module_info">module_info</a> list</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Source modules making up the executable.</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div></div><p>A local library defined in the workspace.</p><div class="odoc-spec"><div class="spec type anchored" id="type-local_lib_info"><a href="#type-local_lib_info" class="anchor"></a><code><span><span class="keyword">type</span> local_lib_info</span><span> = </span><span>{</span></code><ol><li id="type-local_lib_info.name" class="def record field anchored"><a href="#type-local_lib_info.name" class="anchor"></a><code><span>name : string;</span></code></li><li id="type-local_lib_info.local_dependencies" class="def record field anchored"><a href="#type-local_lib_info.local_dependencies" class="anchor"></a><code><span>local_dependencies : <span>string list</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Local libraries depended on.</p><span class="comment-delim">*)</span></div></li><li id="type-local_lib_info.external_dependencies" class="def record field anchored"><a href="#type-local_lib_info.external_dependencies" class="anchor"></a><code><span>external_dependencies : <span>string list</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>External library dependencies.</p><span class="comment-delim">*)</span></div></li><li id="type-local_lib_info.required_external_deps" class="def record field anchored"><a href="#type-local_lib_info.required_external_deps" class="anchor"></a><code><span>required_external_deps : <span>string list</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>External deps required at link-time.</p><span class="comment-delim">*)</span></div></li><li id="type-local_lib_info.modules" class="def record field anchored"><a href="#type-local_lib_info.modules" class="anchor"></a><code><span>modules : <span><a href="#type-module_info">module_info</a> list</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Implementation and interface files.</p><span class="comment-delim">*)</span></div></li><li id="type-local_lib_info.source_dir" class="def record field anchored"><a href="#type-local_lib_info.source_dir" class="anchor"></a><code><span>source_dir : string;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Absolute path to the library‚Äôs source directory.</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div></div><p>Consolidated information for the whole workspace.</p><div class="odoc-spec"><div class="spec type anchored" id="type-project_details"><a href="#type-project_details" class="anchor"></a><code><span><span class="keyword">type</span> project_details</span><span> = </span><span>{</span></code><ol><li id="type-project_details.local_libraries" class="def record field anchored"><a href="#type-project_details.local_libraries" class="anchor"></a><code><span>local_libraries : <span><a href="#type-local_lib_info">local_lib_info</a> list</span>;</span></code></li><li id="type-project_details.executables" class="def record field anchored"><a href="#type-project_details.executables" class="anchor"></a><code><span>executables : <span><a href="#type-executable_info">executable_info</a> list</span>;</span></code></li></ol><code><span>}</span></code></div></div><p>See <code>Eio.Stdenv.process_mgr</code>. We demand an object that at least exposes a <code>process_mgr</code> method; any extra capabilities are ignored.</p><div class="odoc-spec"><div class="spec value anchored" id="val-run"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : 
  <span><span>&lt; process_mgr : <span><span>[&gt; <span><span>[&gt; `Generic ]</span> <span class="xref-unresolved">Eio</span>.Process.mgr_ty</span> ]</span> <span class="xref-unresolved">Eio</span>.Resource.t</span>.. &gt;</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-project_details">project_details</a></span></code></div><div class="spec-doc"><p><code>run env</code> spawns the two Dune commands under <code>env</code> and returns a <a href="#type-project_details"><code>project_details</code></a> value. An exception is raised if either command exits with a non-zero status or if their output cannot be parsed.</p></div></div></div></body></html>
