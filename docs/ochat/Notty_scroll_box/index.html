<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Notty_scroll_box (ochat.Notty_scroll_box)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../';
let search_urls = ['../db.js','../../sherlodoc.js'];
</script><script src="../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">Index</a> &#x00BB; <a href="../index.html">ochat</a> &#x00BB; Notty_scroll_box</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="ðŸ”Ž Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Notty_scroll_box</span></code></h1></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#high-level-operations">High-level operations</a></li></ul></nav></div><div class="odoc-content"><p>Scrollable view onto a <code>Notty</code> image.</p><p>This module provides a tiny state-ful wrapper around a <code>Notty.I.t</code> that allows the caller to expose only a *window* â€“ a rectangular viewport â€“ of a potentially larger image. Vertical scrolling is achieved by cropping <code>scroll</code> rows from the top of the original image and then <i>snapping</i> the result to the requested viewport size using <code>Notty.I.vsnap</code> and <code>Notty.I.hsnap</code>.</p><p>The state carried by a scroll box consists of</p><ul><li><code>content</code> â€” the full underlying image</li><li><code>scroll</code> â€” the number of rows currently hidden <b>above</b> the viewport</li></ul><p>A value of <code>scroll = 0</code> therefore shows the beginning of the image, and increasing the offset moves the viewport further <b>down</b>. Horizontal scrolling is not supported; the content is simply cropped or padded to the desired width.</p><h2 id="high-level-operations"><a href="#high-level-operations" class="anchor"></a>High-level operations</h2><p>â€¢ <a href="#val-render"><code>render</code></a> converts a scroll box into an image of the exact dimensions requested by the caller. â€¢ <a href="#val-scroll_by"><code>scroll_by</code></a>, <a href="#val-scroll_to_top"><code>scroll_to_top</code></a> and <a href="#val-scroll_to_bottom"><code>scroll_to_bottom</code></a> adjust the scroll offset while ensuring it stays within the valid range for a given viewport height.</p><p>All mutating helpers make sure that the offset is clamped to <code>[0, max_scroll]</code> where <code>max_scroll</code> depends on the height of the viewport that will later be used for rendering. Calling <a href="#val-render"><code>render</code></a> also performs this clamping, so the invariant is preserved even if the user sets an invalid offset directly.</p><div class="odoc-spec"><div class="spec module anchored" id="module-I"><a href="#module-I" class="anchor"></a><code><span><span class="keyword">module</span> I</span><span> = <span class="xref-unresolved">Notty</span>.I</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span><span> = </span><span>{</span></code><ol><li id="type-t.content" class="def record field anchored"><a href="#type-t.content" class="anchor"></a><code><span><span class="keyword">mutable</span> content : <span class="xref-unresolved">I</span>.t;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Entire image to scroll through.</p><span class="comment-delim">*)</span></div></li><li id="type-t.scroll" class="def record field anchored"><a href="#type-t.scroll" class="anchor"></a><code><span><span class="keyword">mutable</span> scroll : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Rows hidden <b>above</b> the viewport.</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : <span><span class="optlabel">?scroll</span>:int <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">I</span>.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>create ?scroll content</code> creates a new scroll box initialised with <code>content</code>. <code>scroll</code> is clamped to a non-negative value but is <em>not</em> limited by any particular viewport height until <a href="#val-render"><code>render</code></a> is called.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_content"><a href="#val-set_content" class="anchor"></a><code><span><span class="keyword">val</span> set_content : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">I</span>.t <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>set_content t img</code> replaces the underlying image with <code>img</code>. The current <code>scroll</code> offset is kept intact; it will be clamped on the next <a href="#val-render"><code>render</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-content"><a href="#val-content" class="anchor"></a><code><span><span class="keyword">val</span> content : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">I</span>.t</span></code></div><div class="spec-doc"><p>Return the full underlying image.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-scroll"><a href="#val-scroll" class="anchor"></a><code><span><span class="keyword">val</span> scroll : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>Current scroll offset (rows hidden at the top).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-max_scroll"><a href="#val-max_scroll" class="anchor"></a><code><span><span class="keyword">val</span> max_scroll : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">height</span>:int <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>max_scroll t ~height</code> is the largest scroll offset that still leaves at least one row visible in a viewport of <code>height</code> rows. The result is <code>max 0 (I.height t.content - height)</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-clamp_scroll"><a href="#val-clamp_scroll" class="anchor"></a><code><span><span class="keyword">val</span> clamp_scroll : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">height</span>:int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Ensure that <code>t.scroll</code> lies in <code>[0, max_scroll]</code>. The check depends on the viewport <code>~height</code> that will be used for rendering.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-scroll_to"><a href="#val-scroll_to" class="anchor"></a><code><span><span class="keyword">val</span> scroll_to : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>scroll_to t n</code> sets the scroll offset to <code>n</code> without clamping. The value will be brought into range by the next call to <a href="#val-clamp_scroll"><code>clamp_scroll</code></a> or <a href="#val-render"><code>render</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-scroll_by"><a href="#val-scroll_by" class="anchor"></a><code><span><span class="keyword">val</span> scroll_by : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">height</span>:int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>scroll_by t ~height delta</code> adjusts the scroll offset by <code>delta</code> rows and immediately clamps it for a viewport of height <code>height</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-scroll_to_top"><a href="#val-scroll_to_top" class="anchor"></a><code><span><span class="keyword">val</span> scroll_to_top : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Move viewport to the very top of the image.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-scroll_to_bottom"><a href="#val-scroll_to_bottom" class="anchor"></a><code><span><span class="keyword">val</span> scroll_to_bottom : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">height</span>:int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Move viewport to the last full screenful of the image (bottom-most valid offset for a viewport of height <code>~height</code>).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-render"><a href="#val-render" class="anchor"></a><code><span><span class="keyword">val</span> render : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">width</span>:int <span class="arrow">&#45;&gt;</span></span> <span><span class="label">height</span>:int <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Notty</span>.image</span></code></div><div class="spec-doc"><p><code>render t ~width ~height</code> returns an image of exactly <code>width âœ• height</code> cells. The function first clamps the current offset using <code>height</code> and then constructs the viewport as</p><pre>  t.content                      (full image)
  |&gt; I.vcrop t.scroll 0          (* drop rows above the viewport *)
  |&gt; I.vsnap ~align:`Top height  (* pad or crop to desired height *)
  |&gt; I.hsnap ~align:`Left width  (* pad or crop to desired width  *)</pre><p>Horizontal snapping uses <code>`Left</code> alignment so that the leftmost columns of the content remain visible when the image is wider than the viewport.</p></div></div></div></body></html>
