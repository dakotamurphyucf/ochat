<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Recursive_mp (ochat.Recursive_mp)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../';
let search_urls = ['../db.js','../../sherlodoc.js'];
</script><script src="../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">Index</a> &#x00BB; <a href="../index.html">ochat</a> &#x00BB; Recursive_mp</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="ðŸ”Ž Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Recursive_mp</span></code></h1></header><div class="odoc-content"><p>Recursive Meta-Prompting: a lightweight monadic wrapper that repeatedly refines an existing prompt with the help of an <a href="../Evaluator/index.html"><code>Evaluator</code></a>. The current implementation demonstrates the control-flow and monotonicity guard without performing any fancy prompt transformation â€“ it merely appends a metadata field to indicate the iteration number. Replacing the transformation logic with an LLM-based agent can be done without changing the outward API.</p><div class="odoc-spec"><div class="spec module anchored" id="module-P"><a href="#module-P" class="anchor"></a><code><span><span class="keyword">module</span> P</span><span> = <a href="../Prompt_intf/index.html">Prompt_intf</a></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-E"><a href="#module-E" class="anchor"></a><code><span><span class="keyword">module</span> E</span><span> = <a href="../Evaluator/index.html">Evaluator</a></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Vdb"><a href="#module-Vdb" class="anchor"></a><code><span><span class="keyword">module</span> Vdb</span><span> = <a href="../Vector_db/index.html">Vector_db</a></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-transform_strategy"><a href="#type-transform_strategy" class="anchor"></a><code><span><span class="keyword">type</span> transform_strategy</span><span> = </span><span>{</span></code><ol><li id="type-transform_strategy.name" class="def record field anchored"><a href="#type-transform_strategy.name" class="anchor"></a><code><span>name : string;</span></code></li><li id="type-transform_strategy.apply" class="def record field anchored"><a href="#type-transform_strategy.apply" class="anchor"></a><code><span>apply : <span><a href="../Prompt_intf/index.html#type-t">P.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?env</span>:<span class="xref-unresolved">Eio_unix</span>.Stdenv.base <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">iteration</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">context</span>:<a href="../Context/index.html#type-t">Context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../Prompt_intf/index.html#type-t">P.t</a>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a t</span></span><span> = </span></code><ol><li id="type-t.Return" class="def variant constructor anchored"><a href="#type-t.Return" class="anchor"></a><code><span>| </span><span><span class="constructor">Return</span> <span class="keyword">of</span> <span class="type-var">'a</span></span></code></li><li id="type-t.Bind" class="def variant constructor anchored"><a href="#type-t.Bind" class="anchor"></a><code><span>| </span><span><span class="constructor">Bind</span> <span class="keyword">of</span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span> * <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-return"><a href="#val-return" class="anchor"></a><code><span><span class="keyword">val</span> return : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bind"><a href="#val-bind" class="anchor"></a><code><span><span class="keyword">val</span> bind : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-join"><a href="#val-join" class="anchor"></a><code><span><span class="keyword">val</span> join : <span><span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-refine_params"><a href="#type-refine_params" class="anchor"></a><code><span><span class="keyword">type</span> refine_params</span><span> = </span><span>{</span></code><ol><li id="type-refine_params.evaluator" class="def record field anchored"><a href="#type-refine_params.evaluator" class="anchor"></a><code><span>evaluator : <a href="../Evaluator/index.html#type-t">E.t</a>;</span></code></li><li id="type-refine_params.max_iters" class="def record field anchored"><a href="#type-refine_params.max_iters" class="anchor"></a><code><span>max_iters : int;</span></code></li><li id="type-refine_params.score_epsilon" class="def record field anchored"><a href="#type-refine_params.score_epsilon" class="anchor"></a><code><span>score_epsilon : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Stop when improvement over window â‰¤ <code>score_epsilon</code></p><span class="comment-delim">*)</span></div></li><li id="type-refine_params.plateau_window" class="def record field anchored"><a href="#type-refine_params.plateau_window" class="anchor"></a><code><span>plateau_window : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Deprecated: kept for backward-compatibility; no longer used now that Bayesian convergence is implemented.</p><span class="comment-delim">*)</span></div></li><li id="type-refine_params.bayes_alpha" class="def record field anchored"><a href="#type-refine_params.bayes_alpha" class="anchor"></a><code><span>bayes_alpha : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Credible interval significance level. The refinement loop stops when the posterior probability that the improvement Î” exceeds <code>score_epsilon</code> drops below <code>1. -. bayes_alpha</code> (e.g. 0.05 for a 95 % credible bound).</p><span class="comment-delim">*)</span></div></li><li id="type-refine_params.bandit_enabled" class="def record field anchored"><a href="#type-refine_params.bandit_enabled" class="anchor"></a><code><span>bandit_enabled : bool;</span></code></li><li id="type-refine_params.strategies" class="def record field anchored"><a href="#type-refine_params.strategies" class="anchor"></a><code><span>strategies : <span><a href="#type-transform_strategy">transform_strategy</a> list</span>;</span></code></li><li id="type-refine_params.proposer_model" class="def record field anchored"><a href="#type-refine_params.proposer_model" class="anchor"></a><code><span>proposer_model : <span><a href="../Openai/Responses/Request/index.html#type-model">Openai.Responses.Request.model</a> option</span>;</span></code></li><li id="type-refine_params.executor_model" class="def record field anchored"><a href="#type-refine_params.executor_model" class="anchor"></a><code><span>executor_model : <span><a href="../Openai/Responses/Request/index.html#type-model">Openai.Responses.Request.model</a> option</span>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-getenv_opt"><a href="#val-getenv_opt" class="anchor"></a><code><span><span class="keyword">val</span> getenv_opt : <span>string <span class="arrow">&#45;&gt;</span></span> <span>string option</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-api_key_opt"><a href="#val-api_key_opt" class="anchor"></a><code><span><span class="keyword">val</span> api_key_opt : <span><span>string option</span> lazy_t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-budget_opt"><a href="#val-budget_opt" class="anchor"></a><code><span><span class="keyword">val</span> budget_opt : <span><span>int option</span> lazy_t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-remove_reasoning"><a href="#val-remove_reasoning" class="anchor"></a><code><span><span class="keyword">val</span> remove_reasoning : <span>string <span class="arrow">&#45;&gt;</span></span> string</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ask_llm"><a href="#val-ask_llm" class="anchor"></a><code><span><span class="keyword">val</span> ask_llm : 
  <span><span class="label">env</span>:
    <span>&lt; fs : <span><span class="xref-unresolved">Eio</span>.Fs.dir_ty <span class="xref-unresolved">Eio</span>.Path.t</span>
      ; net : <span><span>[&gt; <span><span>[&gt; `Generic ]</span> <span class="xref-unresolved">Eio</span>.Net.ty</span> ]</span> <span class="xref-unresolved">Eio</span>.Net.t</span>.. &gt;</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">user_content</span>:<a href="../Prompt_intf/index.html#type-t">P.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">context</span>:<a href="../Context/index.html#type-t">Context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?model</span>:<a href="../Openai/Responses/Request/index.html#type-model">Openai.Responses.Request.model</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?guidelines</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span>string option</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-transform_prompt"><a href="#val-transform_prompt" class="anchor"></a><code><span><span class="keyword">val</span> transform_prompt : 
  <span><span class="optlabel">?env</span>:
    <span>&lt; fs : <span><span class="xref-unresolved">Eio</span>.Fs.dir_ty <span class="xref-unresolved">Eio</span>.Path.t</span>
      ; net : <span><span>[&gt; <span><span>[&gt; `Generic ]</span> <span class="xref-unresolved">Eio</span>.Net.ty</span> ]</span> <span class="xref-unresolved">Eio</span>.Net.t</span>.. &gt;</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">context</span>:<a href="../Context/index.html#type-t">Context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Prompt_intf/index.html#type-t">P.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">iteration</span>:int <span class="arrow">&#45;&gt;</span></span>
  <a href="../Prompt_intf/index.html#type-t">P.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-default_llm_strategy"><a href="#val-default_llm_strategy" class="anchor"></a><code><span><span class="keyword">val</span> default_llm_strategy : <a href="#type-transform_strategy">transform_strategy</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-heuristic_strategy"><a href="#val-heuristic_strategy" class="anchor"></a><code><span><span class="keyword">val</span> heuristic_strategy : <a href="#type-transform_strategy">transform_strategy</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-default_params"><a href="#val-default_params" class="anchor"></a><code><span><span class="keyword">val</span> default_params : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-refine_params">refine_params</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make_params"><a href="#val-make_params" class="anchor"></a><code><span><span class="keyword">val</span> make_params : 
  <span><span class="optlabel">?judges</span>:<span><a href="../Evaluator/index.html#type-judge">E.judge</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?max_iters</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?score_epsilon</span>:float <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?plateau_window</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?bayes_alpha</span>:float <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?bandit_enabled</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?strategies</span>:<span><a href="#type-transform_strategy">transform_strategy</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?proposer_model</span>:<a href="../Openai/Responses/Request/index.html#type-model">Openai.Responses.Request.model</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?executor_model</span>:<a href="../Openai/Responses/Request/index.html#type-model">Openai.Responses.Request.model</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-refine_params">refine_params</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-refine"><a href="#val-refine" class="anchor"></a><code><span><span class="keyword">val</span> refine : 
  <span><span class="optlabel">?context</span>:<a href="../Context/index.html#type-t">Context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?params</span>:<a href="#type-refine_params">refine_params</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?judges</span>:<span><a href="../Evaluator/index.html#type-judge">E.judge</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?max_iters</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?score_epsilon</span>:float <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?plateau_window</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?bayes_alpha</span>:float <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?bandit_enabled</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?strategies</span>:<span><a href="#type-transform_strategy">transform_strategy</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?proposer_model</span>:<a href="../Openai/Responses/Request/index.html#type-model">Openai.Responses.Request.model</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?executor_model</span>:<a href="../Openai/Responses/Request/index.html#type-model">Openai.Responses.Request.model</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Prompt_intf/index.html#type-t">P.t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../Prompt_intf/index.html#type-t">P.t</a></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Let_syntax"><a href="#module-Let_syntax" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Let_syntax/index.html">Let_syntax</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>
