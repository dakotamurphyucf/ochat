<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Ctx (ochat.Chat_response.Ctx)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../';
let search_urls = ['../../db.js','../../../sherlodoc.js'];
</script><script src="../../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">Index</a> &#x00BB; <a href="../../index.html">ochat</a> &#x00BB; <a href="../index.html">Chat_response</a> &#x00BB; Ctx</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="ðŸ”Ž Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Chat_response.Ctx</span></code></h1><p>Shared, immutable execution context passed around by the <a href="../index.html"><code>Chat_response</code></a> helper sub-modules.</p><p>The record bundles together the *capabilities* needed by most functions â€“ notably networking, filesystem access, and a shared cache â€“ so that callers only pass a single value instead of a long parameter list. A typical value is created once at program start and then threaded through the call-graph.</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#why-an-'env-type-parameter?">Why an <code>'env</code> type parameter?</a></li><li><a href="#thread-safety">Thread-safety</a></li></ul></nav></div><div class="odoc-content"><h2 id="why-an-'env-type-parameter?"><a href="#why-an-'env-type-parameter?" class="anchor"></a>Why an <code>'env</code> type parameter?</h2><p>Rather than taking a concrete <code>Eio_unix.Stdenv.base</code> we keep the environment abstract and only rely on <em>structural</em> typing: the object must implement at least <code>net</code>. This brings two benefits:</p><p>â€¢ The module remains agnostic of the chosen Eio backend (Unix, Mimic, testsâ€¦). â€¢ Unit tests can inject cheap stubs that satisfy the interface without spinning up real network resources.</p><h2 id="thread-safety"><a href="#thread-safety" class="anchor"></a>Thread-safety</h2><p>The context value itself is immutable, however the <code>cache</code> field is an internal <a href="../Cache/index.html"><code>Cache</code></a> instance that performs in-place updates. If you plan to share a cache between concurrent fibres, make sure the chosen implementation offers the required synchronisation or wrap it behind a mutex.</p><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>'env t</span></span><span> = <span class="keyword">private</span> </span><span>{</span></code><ol><li id="type-t.env" class="def record field anchored"><a href="#type-t.env" class="anchor"></a><code><span>env : <span class="type-var">'env</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Underlying Eio standard environment.</p><span class="comment-delim">*)</span></div></li><li id="type-t.dir" class="def record field anchored"><a href="#type-t.dir" class="anchor"></a><code><span>dir : <span><span class="xref-unresolved">Eio</span>.Fs.dir_ty <span class="xref-unresolved">Eio</span>.Path.t</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Base directory used when a function needs to access the file-system â€“ e.g. reading a local include.</p><span class="comment-delim">*)</span></div></li><li id="type-t.tool_dir" class="def record field anchored"><a href="#type-t.tool_dir" class="anchor"></a><code><span>tool_dir : <span><span class="xref-unresolved">Eio</span>.Fs.dir_ty <span class="xref-unresolved">Eio</span>.Path.t</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Current working directory applied when spawning a tool. It defaults to <code>dir</code> but callers may pick a different value to respect the userâ€™s CWD.</p><span class="comment-delim">*)</span></div></li><li id="type-t.cache" class="def record field anchored"><a href="#type-t.cache" class="anchor"></a><code><span>cache : <a href="../Cache/index.html#type-t">Cache.t</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Shared TTL-LRU instance for memoising results.</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : 
  <span><span class="label">env</span>:<span class="type-var">'env</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">dir</span>:<span><span class="xref-unresolved">Eio</span>.Fs.dir_ty <span class="xref-unresolved">Eio</span>.Path.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">tool_dir</span>:<span><span class="xref-unresolved">Eio</span>.Fs.dir_ty <span class="xref-unresolved">Eio</span>.Path.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">cache</span>:<a href="../Cache/index.html#type-t">Cache.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'env</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>create ~env ~dir ~tool_dir ~cache</code> creates a fresh context from its constituents. No validation is performed beyond structural typing of <code>env</code>; the caller is responsible for ensuring that the provided directories remain valid for the desired lifetime.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-of_env"><a href="#val-of_env" class="anchor"></a><code><span><span class="keyword">val</span> of_env : 
  <span><span class="label">env</span>:
    <span>(<span>&lt; fs : <span><span class="xref-unresolved">Eio</span>.Fs.dir_ty <span class="xref-unresolved">Eio</span>.Path.t</span>
      ; cwd : <span><span class="xref-unresolved">Eio</span>.Fs.dir_ty <span class="xref-unresolved">Eio</span>.Path.t</span>.. &gt;</span> <span class="keyword">as</span> 'env)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">cache</span>:<a href="../Cache/index.html#type-t">Cache.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'env</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>of_env ~env ~cache</code> is a convenience constructor that takes the standard values returned by <code>Eio.Stdenv.*</code> helpers:</p><pre>  dir      = Eio.Stdenv.fs  env
  tool_dir = Eio.Stdenv.cwd env</pre></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-net"><a href="#val-net" class="anchor"></a><code><span><span class="keyword">val</span> net : <span><span><span>&lt; net : <span class="type-var">'a</span>.. &gt;</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>net t</code> exposes the network namespace obtained from <code>t.env#net</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-env"><a href="#val-env" class="anchor"></a><code><span><span class="keyword">val</span> env : <span><span><span class="type-var">'env</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'env</span></span></code></div><div class="spec-doc"><p><code>env t</code> returns the underlying environment object. Prefer the specialised helpers provided by other modules when possible.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-dir"><a href="#val-dir" class="anchor"></a><code><span><span class="keyword">val</span> dir : <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Eio</span>.Fs.dir_ty <span class="xref-unresolved">Eio</span>.Path.t</span></span></code></div><div class="spec-doc"><p><code>dir t</code> returns the root directory used for local IO operations.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-cache"><a href="#val-cache" class="anchor"></a><code><span><span class="keyword">val</span> cache : <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <a href="../Cache/index.html#type-t">Cache.t</a></span></code></div><div class="spec-doc"><p><code>cache t</code> retrieves the shared TTL-LRU cache carried by the context.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tool_dir"><a href="#val-tool_dir" class="anchor"></a><code><span><span class="keyword">val</span> tool_dir : <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Eio</span>.Fs.dir_ty <span class="xref-unresolved">Eio</span>.Path.t</span></span></code></div><div class="spec-doc"><p><code>tool_dir t</code> returns the directory that acts as the current working directory when spawning tools. When the caller did not override the value it is equal to <a href="#val-dir"><code>dir</code></a>.</p></div></div></div></body></html>
