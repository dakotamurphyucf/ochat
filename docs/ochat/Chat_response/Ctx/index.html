<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Ctx (ochat.Chat_response.Ctx)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../';
let search_urls = ['../../db.js','../../../sherlodoc.js'];
</script><script src="../../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> ‚Äì <a href="../../../index.html">Index</a> &#x00BB; <a href="../../index.html">ochat</a> &#x00BB; <a href="../index.html">Chat_response</a> &#x00BB; Ctx</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="üîé Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Chat_response.Ctx</span></code></h1><p>Shared execution context used by the <a href="../index.html"><code>Chat_response</code></a> sub-modules.</p><p>The module provides a thin, immutable record bundling together:</p><p>‚Ä¢ <code>env</code> ‚Äì An Eio standard environment (usually <code>Eio_unix.Stdenv.base</code>) or a restricted object that exposes at least the <em>structural</em> methods we rely on (currently <code>#net</code>).</p><p>‚Ä¢ <code>dir</code> ‚Äì The root directory that should be considered ‚Äúcurrent‚Äù when resolving relative paths inside prompts or tool invocations. This is often <code>Eio.Stdenv.fs</code>, but callers may provide a sandboxed subtree if they want to restrict file-system access.</p><p>‚Ä¢ <code>cache</code> ‚Äì A <code>Cache.t</code> instance used to memoise network fetches and nested agent calls.</p><p>The record is designed to travel through all helper functions so that they can call </p><pre class="language-ocaml"><code>Ctx.net ctx</code></pre><p>or </p><pre class="language-ocaml"><code>Ctx.dir ctx</code></pre><p>instead of threading long parameter lists.</p><p>The polymorphic <code>'env</code> parameter is kept abstract in order to avoid a hard dependency on a concrete environment type. Any object that fulfils the structural requirements will compile. In practice this means the value is either the one supplied by <code>Eio_main.run</code> or a test double that provides compatible stubs.</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#api-at-a-glance">API at a glance</a></li></ul></nav></div><div class="odoc-content"><h2 id="api-at-a-glance"><a href="#api-at-a-glance" class="anchor"></a>API at a glance</h2><pre>  (* Constructors *)
  let ctx = Ctx.create ~env ~dir ~cache in
  let ctx' = Ctx.of_env ~env ~cache (* dir = Eio.Stdenv.fs env *)

  (* Accessors *)
  let net   = Ctx.net   ctx in  (* env#net *)
  let dir   = Ctx.dir   ctx in  (* Eio.Path.t *)
  let cache = Ctx.cache ctx in</pre><p>No function performs blocking IO; accessing a field is O(1). Thread-safety follows the rules of the underlying structures: the context itself is immutable but the <code>cache</code> it carries is mutable and not synchronised. Each fibre should therefore use its own context or ensure external synchronisation when sharing a cache.</p><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>'env t</span></span><span> = </span><span>{</span></code><ol><li id="type-t.env" class="def record field anchored"><a href="#type-t.env" class="anchor"></a><code><span>env : <span class="type-var">'env</span>;</span></code></li><li id="type-t.dir" class="def record field anchored"><a href="#type-t.dir" class="anchor"></a><code><span>dir : <span><span class="xref-unresolved">Eio</span>.Fs.dir_ty <span class="xref-unresolved">Eio</span>.Path.t</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Root directory used by <a href="../Fetch/index.html"><code>Fetch</code></a> helpers for reading local files.</p><span class="comment-delim">*)</span></div></li><li id="type-t.cache" class="def record field anchored"><a href="#type-t.cache" class="anchor"></a><code><span>cache : <a href="../Cache/index.html#type-t">Cache.t</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Shared TTL-LRU store for memoising agent answers and HTTP fetches.</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : <span><span class="label">env</span>:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">dir</span>:<span><span class="xref-unresolved">Eio</span>.Fs.dir_ty <span class="xref-unresolved">Eio</span>.Path.t</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">cache</span>:<a href="../Cache/index.html#type-t">Cache.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>create ~env ~dir ~cache</code> builds a fresh context from its parts.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-of_env"><a href="#val-of_env" class="anchor"></a><code><span><span class="keyword">val</span> of_env : 
  <span><span class="label">env</span>:<span>&lt; fs : <span><span class="xref-unresolved">Eio</span>.Fs.dir_ty <span class="xref-unresolved">Eio</span>.Path.t</span>.. &gt;</span> <span class="keyword">as</span> 'a <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">cache</span>:<a href="../Cache/index.html#type-t">Cache.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>of_env ~env ~cache</code> is a shorthand for</p><pre class="language-ocaml"><code>create ~env ~dir:(Eio.Stdenv.fs env) ~cache</code></pre><p>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-net"><a href="#val-net" class="anchor"></a><code><span><span class="keyword">val</span> net : <span><span><span>&lt; net : <span class="type-var">'a</span>.. &gt;</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>net t</code> exposes the network namespace (<code>env#net</code>).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-env"><a href="#val-env" class="anchor"></a><code><span><span class="keyword">val</span> env : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p>Raw access to the encapsulated environment. Use with care ‚Äì prefer the specialised helpers provided by other modules when possible.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-dir"><a href="#val-dir" class="anchor"></a><code><span><span class="keyword">val</span> dir : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Eio</span>.Fs.dir_ty <span class="xref-unresolved">Eio</span>.Path.t</span></span></code></div><div class="spec-doc"><p>Filesystem root for local IO operations.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-cache"><a href="#val-cache" class="anchor"></a><code><span><span class="keyword">val</span> cache : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <a href="../Cache/index.html#type-t">Cache.t</a></span></code></div><div class="spec-doc"><p>Shared cache instance carried by the context.</p></div></div></div></body></html>
