<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Uunf (docs.findlib-1.uunf.Uunf)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../../';
let search_urls = ['../../../db.js','../../../sherlodoc.js'];
</script><script src="../../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../../index.html">Index</a> &#x00BB; <a href="../../../index.html">docs</a> &#x00BB; <a href="../../index.html">findlib-1</a> &#x00BB; <a href="../index.html">uunf</a> &#x00BB; Uunf</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="ðŸ”Ž Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Uunf</span></code></h1><p>Unicode text normalization.</p><p><code>Uunf</code> normalizes Unicode text. It supports all Unicode normalization forms. The module is independent from any IO mechanism or Unicode text data structure and it can process text without a complete in-memory representation of the data.</p><p>The supported Unicode version is determined by the <a href="#val-unicode_version"><code>unicode_version</code></a> value.</p><p>Consult the <a href="#basics" title="basics">basics</a>, <a href="#limits" title="limits">limitations</a> and <a href="#examples" title="examples">examples</a> of use.</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#references">References</a></li><li><a href="#normalize">Normalize</a></li><li><a href="#props">Normalization properties</a></li><li><a href="#limits">Limitations</a></li><li><a href="#basics">Basics</a></li><li><a href="#examples">Examples</a><ul><li><a href="#utf8">UTF-8 normalization</a></li></ul></li></ul></nav></div><div class="odoc-content"><h4 id="references"><a href="#references" class="anchor"></a>References</h4><ul><li>The Unicode Consortium. <em><a href="http://www.unicode.org/versions/latest">The Unicode Standard</a></em>. (latest version)</li><li>Mark Davis. <em><a href="http://www.unicode.org/reports/tr15/">UAX #15 Unicode Normalization Forms</a></em>. (latest version)</li><li>The Unicode Consortium. <em><a href="http://www.unicode.org/charts/normalization/">Normalization charts</a>.</em></li></ul><h2 id="normalize"><a href="#normalize" class="anchor"></a>Normalize</h2><div class="odoc-spec"><div class="spec type anchored" id="type-form"><a href="#type-form" class="anchor"></a><code><span><span class="keyword">type</span> form</span><span> = </span><span>[ </span></code><ol><li id="type-form.NFD" class="def variant constructor anchored"><a href="#type-form.NFD" class="anchor"></a><code><span>| </span><span>`NFD</span></code></li><li id="type-form.NFC" class="def variant constructor anchored"><a href="#type-form.NFC" class="anchor"></a><code><span>| </span><span>`NFC</span></code></li><li id="type-form.NFKD" class="def variant constructor anchored"><a href="#type-form.NFKD" class="anchor"></a><code><span>| </span><span>`NFKD</span></code></li><li id="type-form.NFKC" class="def variant constructor anchored"><a href="#type-form.NFKC" class="anchor"></a><code><span>| </span><span>`NFKC</span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>The type for normalization forms.</p><ul><li><code>`NFD</code> <a href="http://www.unicode.org/glossary/#normalization_form_d">normalization form D</a>, canonical decomposition.</li><li><code>`NFC</code> <a href="http://www.unicode.org/glossary/#normalization_form_c">normalization form C</a>, canonical decomposition followed by canonical composition (<a href="http://www.w3.org/TR/charmod-norm/">recommended</a> for the www).</li><li><code>`NFKD</code> <a href="http://www.unicode.org/glossary/#normalization_form_kd">normalization form KD</a>, compatibility decomposition.</li><li><code>`NFKC</code> <a href="http://www.unicode.org/glossary/#normalization_form_kc">normalization form KC</a>, compatibility decomposition, followed by canonical composition.</li></ul></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>The type for Unicode text normalizers.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-ret"><a href="#type-ret" class="anchor"></a><code><span><span class="keyword">type</span> ret</span><span> = </span><span>[ </span></code><ol><li id="type-ret.Uchar" class="def variant constructor anchored"><a href="#type-ret.Uchar" class="anchor"></a><code><span>| </span><span>`Uchar <span class="keyword">of</span> <a href="../../../stdlib/Stdlib/Uchar/index.html#type-t">Uchar.t</a></span></code></li><li id="type-ret.End" class="def variant constructor anchored"><a href="#type-ret.End" class="anchor"></a><code><span>| </span><span>`End</span></code></li><li id="type-ret.Await" class="def variant constructor anchored"><a href="#type-ret.Await" class="anchor"></a><code><span>| </span><span>`Await</span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>The type for normalizer results. See <a href="#val-add"><code>add</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : <span><span>[&lt; <a href="#type-form">form</a> ]</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>create nf</code> is an Unicode text normalizer for the normal form <code>nf</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-form"><a href="#val-form" class="anchor"></a><code><span><span class="keyword">val</span> form : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-form">form</a></span></code></div><div class="spec-doc"><p><code>form n</code> is the normalization form of <code>n</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add"><a href="#val-add" class="anchor"></a><code><span><span class="keyword">val</span> add : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>[ <span>`Uchar of <a href="../../../stdlib/Stdlib/Uchar/index.html#type-t">Uchar.t</a></span> <span>| `Await</span> <span>| `End</span> ]</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-ret">ret</a></span></code></div><div class="spec-doc"><p><code>add n v</code> is:</p><ul><li><code>`Uchar u</code> if <code>u</code> is the next character in the normalized sequence. The client must then call <code>add</code> with <code>`Await</code> until <code>`Await</code> is returned.</li><li><code>`Await</code> when the normalizer is ready to add a new <code>`Uchar</code> or <code>`End</code>.</li></ul><p>For <code>v</code> use <code>`Uchar u</code> to add a new character to the sequence to normalize and <code>`End</code> to signal the end of sequence. After adding one of these two values, always call <code>add</code> with <code>`Await</code> until <code>`Await</code> is returned.</p><p><b>Raises.</b> <code>Invalid_argument</code> if <code>`Uchar </code> or <code>`End</code> is added directly after an <code>`Uchar</code> was returned by the normalizer or if an <code>`Uchar</code> is added after <code>`End</code> was added.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-reset"><a href="#val-reset" class="anchor"></a><code><span><span class="keyword">val</span> reset : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>reset n</code> resets the normalizer to a state equivalent to the state of <code>Uunf.create (Uunf.form n)</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-copy"><a href="#val-copy" class="anchor"></a><code><span><span class="keyword">val</span> copy : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>copy n</code> is a copy of <code>n</code> in its current state. Subsequent <a href="#val-add"><code>add</code></a>s on <code>n</code> do not affect the copy.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_ret"><a href="#val-pp_ret" class="anchor"></a><code><span><span class="keyword">val</span> pp_ret : <span><a href="../../../stdlib/Stdlib/Format/index.html#type-formatter">Format.formatter</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-ret">ret</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>pp_ret ppf v</code> prints an unspecified representation of <code>v</code> on <code>ppf</code>.</p></div></div><h2 id="props"><a href="#props" class="anchor"></a>Normalization properties</h2><p>These properties are used internally to implement the normalizers. They are not needed to use the module but are exposed as they may be useful to implement other algorithms.</p><div class="odoc-spec"><div class="spec value anchored" id="val-unicode_version"><a href="#val-unicode_version" class="anchor"></a><code><span><span class="keyword">val</span> unicode_version : string</span></code></div><div class="spec-doc"><p><code>unicode_version</code> is the Unicode version supported by the module.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ccc"><a href="#val-ccc" class="anchor"></a><code><span><span class="keyword">val</span> ccc : <span><a href="../../../stdlib/Stdlib/Uchar/index.html#type-t">Uchar.t</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>ccc u</code> is <code>u</code>'s <a href="http://www.unicode.org/glossary/#combining_class">canonical combining class</a> value.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-decomp"><a href="#val-decomp" class="anchor"></a><code><span><span class="keyword">val</span> decomp : <span><a href="../../../stdlib/Stdlib/Uchar/index.html#type-t">Uchar.t</a> <span class="arrow">&#45;&gt;</span></span> <span>int array</span></span></code></div><div class="spec-doc"><p><code>decomp u</code> is <code>u</code>'s <a href="http://www.unicode.org/glossary/#decomposition_mapping">decomposition mapping</a>. If the empty array is returned, <code>u</code> decomposes to itself.</p><p>The first number in the array contains additional information, it cannot be used as an <a href="../../../stdlib/Stdlib/Uchar/index.html#type-t"><code>Uchar.t</code></a>. Use <a href="#val-d_uchar"><code>d_uchar</code></a> on the number to get the actual character and <a href="#val-d_compatibility"><code>d_compatibility</code></a> to find out if this is a compatibility decomposition. All other characters of the array are guaranteed to be convertible using <a href="../../../stdlib/Stdlib/Uchar/index.html#val-of_int"><code>Uchar.of_int</code></a>.</p><p><b>Warning.</b> Do <b>not</b> mutate the array.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-d_uchar"><a href="#val-d_uchar" class="anchor"></a><code><span><span class="keyword">val</span> d_uchar : <span>int <span class="arrow">&#45;&gt;</span></span> <a href="../../../stdlib/Stdlib/Uchar/index.html#type-t">Uchar.t</a></span></code></div><div class="spec-doc"><p>See <a href="#val-decomp"><code>decomp</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-d_compatibility"><a href="#val-d_compatibility" class="anchor"></a><code><span><span class="keyword">val</span> d_compatibility : <span>int <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>See <a href="#val-decomp"><code>decomp</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-composite"><a href="#val-composite" class="anchor"></a><code><span><span class="keyword">val</span> composite : <span><a href="../../../stdlib/Stdlib/Uchar/index.html#type-t">Uchar.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../stdlib/Stdlib/Uchar/index.html#type-t">Uchar.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../stdlib/Stdlib/Uchar/index.html#type-t">Uchar.t</a> option</span></span></code></div><div class="spec-doc"><p><code>composite u1 u2</code> is the <a href="http://www.unicode.org/glossary/#primary_composite">primary composite</a> canonically equivalent to the sequence <code>&lt;u1,u2&gt;</code>, if any.</p></div></div><h2 id="limits"><a href="#limits" class="anchor"></a>Limitations</h2><p>An <code>Uunf</code> normalizer consumes only a small bounded amount of memory on ordinary, <em>meaningful</em> text. However on legal but <em>degenerate</em> text like a <a href="http://www.unicode.org/glossary/#starter">starter</a> followed by 10'000 combining <a href="http://www.unicode.org/glossary/#nonspacing_mark">non-spacing marks</a> it will have to bufferize all the marks (a workaround is to first convert your input to <a href="http://www.unicode.org/reports/tr15/#Stream_Safe_Text_Format">stream-safe text format</a>).</p><h2 id="basics"><a href="#basics" class="anchor"></a>Basics</h2><p>A normalizer is a stateful filter that inputs a sequence of characters and outputs an equivalent sequence in the requested normal form.</p><p>The function <a href="#val-create"><code>create</code></a> returns a new normalizer for a given normal form:</p><pre class="language-ocaml"><code>let nfd = Uunf.create `NFD</code></pre><p>To add characters to the sequence to normalize, call <a href="#val-add"><code>add</code></a> on <code>nfd</code> with <code>`Uchar _</code>. To end the sequence, call <a href="#val-add"><code>add</code></a> on <code>nfd</code> with <code>`End</code>. The normalized sequence of characters is returned, character by character, by the successive calls to <a href="#val-add"><code>add</code></a>.</p><p>The client and the normalizer must wait on each other to limit internal buffering: each time the client adds to the sequence by calling <a href="#val-add"><code>add</code></a> with <code>`Uchar</code> or <code>`End</code> it must continue to call <a href="#val-add"><code>add</code></a> with <code>`Await</code> until the normalizer returns <code>`Await</code>. In practice this leads to the following kind of control flow:</p><pre class="language-ocaml"><code>let rec add acc v = match Uunf.add nfd v with
| `Uchar u -&gt; add (u :: acc) `Await
| `Await | `End -&gt; acc</code></pre><p>For example to normalize the character <code>U+00E9</code> (Ã©) with <code>nfd</code> to a list of characters we can write:</p><pre class="language-ocaml"><code>let e_acute = Uchar.of_int 0x00E9
let e_acute_nfd = List.rev (add (add [] (`Uchar e_acute)) `End)</code></pre><p>The next section has more examples.</p><h2 id="examples"><a href="#examples" class="anchor"></a>Examples</h2><h3 id="utf8"><a href="#utf8" class="anchor"></a>UTF-8 normalization</h3><p><code>utf_8_normalize nf s</code> is the UTF-8 encoded normal form <code>nf</code> of the UTF-8 encoded string <code>s</code>.</p><pre class="language-ocaml"><code>let utf_8_normalize nf s =
  let rec add buf normalizer v = match Uunf.add normalizer v with
  | `Uchar u -&gt; Buffer.add_utf_8_uchar buf u; add buf normalizer `Await
  | `Await | `End -&gt; ()
  in
  let rec loop buf s i max normalizer =
    if i &gt; max then (add buf normalizer `End; Buffer.contents buf) else
    let dec = String.get_utf_8_uchar s i in
    add buf normalizer (`Uchar (Uchar.utf_decode_uchar dec));
    loop buf s (i + Uchar.utf_decode_length dec) max normalizer
  in
  let buf = Buffer.create (String.length s * 3) in
  let normalizer = Uunf.create nf in
  loop buf s 0 (String.length s - 1) normalizer</code></pre><p>Note that this functionality is available directly through <a href="../Uunf_string/index.html#val-normalize_utf_8"><code>Uunf_string.normalize_utf_8</code></a></p></div></body></html>
