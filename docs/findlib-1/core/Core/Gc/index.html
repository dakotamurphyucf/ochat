<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Gc (docs.findlib-1.core.Core.Gc)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../../../';
let search_urls = ['../../../../db.js','../../../../sherlodoc.js'];
</script><script src="../../../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../../../index.html">Index</a> &#x00BB; <a href="../../../../index.html">docs</a> &#x00BB; <a href="../../../index.html">findlib-1</a> &#x00BB; <a href="../../index.html">core</a> &#x00BB; <a href="../index.html">Core</a> &#x00BB; Gc</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="ðŸ”Ž Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Core.Gc</span></code></h1><p>This is a wrapper around INRIA's standard <code>Gc</code> module. Provides memory management control and statistics, and finalized values.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec module anchored" id="module-Stat"><a href="#module-Stat" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Stat/index.html">Stat</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-stat"><a href="#type-stat" class="anchor"></a><code><span><span class="keyword">type</span> stat</span><span> = <a href="Stat/index.html#type-t">Stat.t</a></span></code></div></div><p>The memory management counters are returned in a <code>stat</code> record.</p><p>The total amount of memory allocated by the program since it was started is (in words) <code>minor_words + major_words - promoted_words</code>. Multiply by the word size (4 on a 32-bit machine, 8 on a 64-bit machine) to get the number of bytes.</p><div class="odoc-spec"><div class="spec module anchored" id="module-Control"><a href="#module-Control" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Control/index.html">Control</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-control"><a href="#type-control" class="anchor"></a><code><span><span class="keyword">type</span> control</span><span> = <a href="Control/index.html#type-t">Control.t</a></span></code></div></div><p>The GC parameters are given as a <code>control</code> record. Note that these parameters can also be initialised by setting the OCAMLRUNPARAM environment variable. See the documentation of ocamlrun.</p><div class="odoc-spec"><div class="spec value external anchored" id="val-stat"><a href="#val-stat" class="anchor"></a><code><span><span class="keyword">val</span> stat : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-stat">stat</a></span></code></div><div class="spec-doc"><p>Return the current values of the memory management counters in a <code>stat</code> record that represent the program's total memory stats.</p><p>OCaml 4 runtime: This function examines every heap block to get the statistics.</p><p>OCaml 5 runtime: This function causes a full major collection.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-stat_size"><a href="#val-stat_size" class="anchor"></a><code><span><span class="keyword">val</span> stat_size : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a></span></code></div><div class="spec-doc"><p>Creating a <code>Stat.t</code> can allocate on the minor heap. Return the expected number of words allocated. *</p></div></div><div class="odoc-spec"><div class="spec value external anchored" id="val-quick_stat"><a href="#val-quick_stat" class="anchor"></a><code><span><span class="keyword">val</span> quick_stat : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-stat">stat</a></span></code></div><div class="spec-doc"><p>Same as <code>stat</code> except that <code>live_words</code>, <code>live_blocks</code>, <code>free_words</code>, <code>free_blocks</code>, <code>largest_free</code>, and <code>fragments</code> are set to 0.</p><p>OCaml 4 runtime: This function is much faster than <code>stat</code> because it does not need to go through the heap.</p><p>OCaml 5 runtime: Due to per-domain buffers it may only represent the state of the program's total memory usage since the last minor collection. As a result returned values are representing an approximation of the gc statistics.</p><p>This function is much faster than <code>stat</code> because it does not need to trigger a full major collection.</p></div></div><div class="odoc-spec"><div class="spec value external anchored" id="val-counters"><a href="#val-counters" class="anchor"></a><code><span><span class="keyword">val</span> counters : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Float/index.html#type-t">Base.Float.t</a> * <a href="../../../base/Base/Float/index.html#type-t">Base.Float.t</a> * <a href="../../../base/Base/Float/index.html#type-t">Base.Float.t</a></span></code></div><div class="spec-doc"><p>Return <code>(minor_words, promoted_words, major_words)</code> (on the OCaml 5 runtime, for the current domain or potentially previous domains). This function is as fast as <code>quick_stat</code>.</p><p>Note: on the OCaml 5 runtime, <code>quick_stat</code> and <code>counters</code> might not return the same value, even if there's only a single domain. If there's only one domain running then <code>counters</code> returns the exact number of minor words, promoted words and major words allocated so far.</p></div></div><p>On 32-bit machines the <code>int</code>s returned by the following functions may overflow.</p><div class="odoc-spec"><div class="spec value external anchored" id="val-minor_words"><a href="#val-minor_words" class="anchor"></a><code><span><span class="keyword">val</span> minor_words : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a></span></code></div><div class="spec-doc"><p>Number of words allocated in the minor heap by this domain (or, on the OCaml 5 runtime, potentially previous domains). This number is accurate in byte-code programs, but only an approximation in programs compiled to native code.</p><p>Note that <code>minor_words</code> does not allocate, but we do not annotate it as <code>noalloc</code> because we want the compiler to save the value of the allocation pointer register (%r15 on x86-64) to the global variable <code>caml_young_ptr</code> before the C stub tries to read its value.</p></div></div><div class="odoc-spec"><div class="spec value external anchored" id="val-major_words"><a href="#val-major_words" class="anchor"></a><code><span><span class="keyword">val</span> major_words : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value external anchored" id="val-promoted_words"><a href="#val-promoted_words" class="anchor"></a><code><span><span class="keyword">val</span> promoted_words : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value external anchored" id="val-minor_collections"><a href="#val-minor_collections" class="anchor"></a><code><span><span class="keyword">val</span> minor_collections : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value external anchored" id="val-major_collections"><a href="#val-major_collections" class="anchor"></a><code><span><span class="keyword">val</span> major_collections : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-compactions"><a href="#val-compactions" class="anchor"></a><code><span><span class="keyword">val</span> compactions : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-heap_words"><a href="#val-heap_words" class="anchor"></a><code><span><span class="keyword">val</span> heap_words : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-heap_chunks"><a href="#val-heap_chunks" class="anchor"></a><code><span><span class="keyword">val</span> heap_chunks : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-top_heap_words"><a href="#val-top_heap_words" class="anchor"></a><code><span><span class="keyword">val</span> top_heap_words : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value external anchored" id="val-major_plus_minor_words"><a href="#val-major_plus_minor_words" class="anchor"></a><code><span><span class="keyword">val</span> major_plus_minor_words : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a></span></code></div><div class="spec-doc"><p>This function returns <code>major_words () + minor_words ()</code>. It exists purely for speed (one call into C rather than two). Like <code>major_words</code> and <code>minor_words</code>, <code>major_plus_minor_words</code> avoids allocating a <code>stat</code> record or a float, and may overflow on 32-bit machines.</p><p>This function is not marked <code>[@@noalloc]</code> to ensure that the allocation pointer is up-to-date when the minor-heap measurement is made.</p></div></div><div class="odoc-spec"><div class="spec value external anchored" id="val-allocated_words"><a href="#val-allocated_words" class="anchor"></a><code><span><span class="keyword">val</span> allocated_words : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a></span></code></div><div class="spec-doc"><p>This function returns <code>major_words () - promoted_words () + minor_words ()</code>, as fast as possible. As <code>major_plus_minor_words</code>, we avoid allocating but cannot be marked <code>@@noalloc</code> yet. It may overflow in 32-bit mode.</p></div></div><div class="odoc-spec"><div class="spec value external anchored" id="val-get"><a href="#val-get" class="anchor"></a><code><span><span class="keyword">val</span> get : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-control">control</a></span></code></div><div class="spec-doc"><p>Return the current values of the GC parameters in a <code>control</code> record.</p></div></div><div class="odoc-spec"><div class="spec value external anchored" id="val-set"><a href="#val-set" class="anchor"></a><code><span><span class="keyword">val</span> set : <span><a href="#type-control">control</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a></span></code></div><div class="spec-doc"><p><code>set r</code> changes the GC parameters according to the <code>control</code> record <code>r</code>. The normal usage is: <code>Gc.set { (Gc.get()) with Gc.Control.verbose = 0x00d }</code></p></div></div><div class="odoc-spec"><div class="spec value external anchored" id="val-minor"><a href="#val-minor" class="anchor"></a><code><span><span class="keyword">val</span> minor : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a></span></code></div><div class="spec-doc"><p>Trigger a minor collection.</p></div></div><div class="odoc-spec"><div class="spec value external anchored" id="val-major_slice"><a href="#val-major_slice" class="anchor"></a><code><span><span class="keyword">val</span> major_slice : <span><a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a></span></code></div><div class="spec-doc"><p>Do a minor collection and a slice of major collection. The argument is the size of the slice, 0 to use the automatically-computed slice size. In all cases, the result is the computed slice size.</p></div></div><div class="odoc-spec"><div class="spec value external anchored" id="val-major"><a href="#val-major" class="anchor"></a><code><span><span class="keyword">val</span> major : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a></span></code></div><div class="spec-doc"><p>Do a minor collection and finish the current major collection cycle.</p></div></div><div class="odoc-spec"><div class="spec value external anchored" id="val-full_major"><a href="#val-full_major" class="anchor"></a><code><span><span class="keyword">val</span> full_major : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a></span></code></div><div class="spec-doc"><p>Do a minor collection, finish the current major collection cycle, and perform a complete new cycle. This will collect all currently unreachable blocks.</p></div></div><div class="odoc-spec"><div class="spec value external anchored" id="val-compact"><a href="#val-compact" class="anchor"></a><code><span><span class="keyword">val</span> compact : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a></span></code></div><div class="spec-doc"><p>Perform a full major collection and compact the heap. Note that heap compaction is a lengthy operation.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-print_stat"><a href="#val-print_stat" class="anchor"></a><code><span><span class="keyword">val</span> print_stat : <span><a href="../../../../stdlib/Stdlib/index.html#type-out_channel">out_channel</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a></span></code></div><div class="spec-doc"><p>Print the current values of the memory management counters (in human-readable form) into the channel argument.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-allocated_bytes"><a href="#val-allocated_bytes" class="anchor"></a><code><span><span class="keyword">val</span> allocated_bytes : <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Float/index.html#type-t">Base.Float.t</a></span></code></div><div class="spec-doc"><p>Return the total number of bytes allocated since the program was started. It is returned as a <code>float</code> to avoid overflow problems with <code>int</code> on 32-bit machines.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-keep_alive"><a href="#val-keep_alive" class="anchor"></a><code><span><span class="keyword">val</span> keep_alive : <span><span class="type-var">_</span> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a></span></code></div><div class="spec-doc"><p><code>keep_alive a</code> ensures that <code>a</code> is live at the point where <code>keep_alive a</code> is called. It is like <code>ignore a</code>, except that the compiler won't be able to simplify it and potentially collect <code>a</code> too soon.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Allocation_policy"><a href="#module-Allocation_policy" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Allocation_policy/index.html">Allocation_policy</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>The policy used for allocating in the heap.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tune"><a href="#val-tune" class="anchor"></a><code><span><span class="keyword">val</span> tune : 
  <span><span class="optlabel">?logger</span>:<span>(<span><a href="../../../base/Base/String/index.html#type-t">Base.String.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?minor_heap_size</span>:<a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?major_heap_increment</span>:<a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?space_overhead</span>:<a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?verbose</span>:<a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?max_overhead</span>:<a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?stack_limit</span>:<a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allocation_policy</span>:<a href="Allocation_policy/index.html#type-t">Allocation_policy.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?window_size</span>:<a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?custom_major_ratio</span>:<a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?custom_minor_ratio</span>:<a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?custom_minor_max_size</span>:<a href="../../../base/Base/Int/index.html#type-t">Base.Int.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a></span></code></div><div class="spec-doc"><p>Adjust the specified GC parameters.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-disable_compaction"><a href="#val-disable_compaction" class="anchor"></a><code><span><span class="keyword">val</span> disable_compaction : 
  <span><span class="optlabel">?logger</span>:<span>(<span><a href="../../../base/Base/String/index.html#type-t">Base.String.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">allocation_policy</span>:<span>[ `Don't_change <span><span>| `Set_to</span> of <a href="Allocation_policy/index.html#type-t">Allocation_policy.t</a></span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../../base/Base/Unit/index.html#type-t">Base.Unit.t</a></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-For_testing"><a href="#module-For_testing" class="anchor"></a><code><span><span class="keyword">module</span> <a href="For_testing/index.html">For_testing</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Expert"><a href="#module-Expert" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Expert/index.html">Expert</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>The <code>Expert</code> module contains functions that novice users should not use, due to their complexity.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Stable"><a href="#module-Stable" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Stable/index.html">Stable</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>
