<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Vector_db (docs.local.chatgpt.vector_db.Vector_db)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../../../../../';
let search_urls = ['../../../../db.js','../../../../sherlodoc.js'];
</script><script src="../../../../odoc.support/odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../../../index.html">Index</a> &#x00BB; <a href="../../../../index.html">docs</a> &#x00BB; <a href="../../../index.html">local</a> &#x00BB; <a href="../../index.html">chatgpt</a> &#x00BB; <a href="../index.html">vector_db</a> &#x00BB; Vector_db</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="ðŸ”Ž Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1>Module <code><span>Vector_db</span></code></h1><p>Vector Database</p><p>This module provides functionality for creating and querying a vector database, which is a collection of document vectors and their associated file paths. The database is represented as a matrix of vector representations and an index that maps the index of a document in the matrix to the file path of the document.</p><p>The main data type is <code>t</code>, which represents the vector database. The module also provides functions for creating a corpus, querying the database, and managing document vectors.</p><p>The <code>Vec</code> module defines the vector representation of documents and provides functions for reading and writing vectors to and from disk.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span><span> = </span><span>{</span></code><ol><li id="type-t.corpus" class="def record field anchored"><a href="#type-t.corpus" class="anchor"></a><code><span>corpus : <a href="../../../../findlib-1/owl/Owl/Mat/index.html#type-mat">Owl.Mat.mat</a>;</span></code></li><li id="type-t.index" class="def record field anchored"><a href="#type-t.index" class="anchor"></a><code><span>index : <span><span>(int, string)</span> <a href="../../../../findlib-1/core/Core/Hashtbl/index.html#type-t">Core.Hashtbl.t</a></span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>This represents the vector db. corpus is the matrix of vector representations of the underlying docs. the index is a hash table that maps the index of a doc in the matrix to the file path of the doc</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-path"><a href="#type-path" class="anchor"></a><code><span><span class="keyword">type</span> path</span><span> = <span><a href="../../../../findlib-1/eio/Eio/Fs/index.html#type-dir_ty">Eio.Fs.dir_ty</a> <a href="../../../../findlib-1/eio/Eio/Path/index.html#type-t">Eio.Path.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Vec"><a href="#module-Vec" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Vec/index.html">Vec</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_corpus"><a href="#val-create_corpus" class="anchor"></a><code><span><span class="keyword">val</span> create_corpus : <span><span><a href="Vec/index.html#type-t">Vec.t</a> array</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>create_corpus docs'</code> creates a vector database from an array of document vectors <code>docs'</code>.</p><p>The function normalizes each document vector and constructs a matrix <code>corpus</code> where each column represents a normalized document vector. It also creates an index, which is a hash table that maps the index of a document in the matrix to the file path of the document.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">docs'</span> <p>is an array of document vectors with their associated file paths.</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p>a record of type <code>t</code> containing the matrix of vector representations <code>corpus</code> and the index mapping document indices to file paths.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-query"><a href="#val-query" class="anchor"></a><code><span><span class="keyword">val</span> query : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../findlib-1/owl/Owl/Mat/index.html#type-mat">Owl.Mat.mat</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int array</span></span></code></div><div class="spec-doc"><p><code>query t doc k</code> returns the top <code>k</code> most similar documents to the given <code>doc</code> in the vector database <code>t</code>. The function computes the cosine similarity between the input <code>doc</code> and the documents in the database <code>t.corpus</code>, and returns the indices of the top <code>k</code> most similar documents.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">t</span> <p>is the vector database containing the corpus and index.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">doc</span> <p>is the document vector to be compared with the documents in the database.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">k</span> <p>is the number of top similar documents to be returned.</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p>an array of indices corresponding to the top <code>k</code> most similar documents in the database.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_doc"><a href="#val-add_doc" class="anchor"></a><code><span><span class="keyword">val</span> add_doc : <span><a href="../../../../findlib-1/owl/Owl/Mat/index.html#type-mat">Owl.Mat.mat</a> <span class="arrow">&#45;&gt;</span></span> <span><span>float array</span> <span class="arrow">&#45;&gt;</span></span> <a href="../../../../findlib-1/owl/Owl/Mat/index.html#type-mat">Owl.Mat.mat</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-initialize"><a href="#val-initialize" class="anchor"></a><code><span><span class="keyword">val</span> initialize : <span><a href="#type-path">path</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>initialize file</code> initializes a vector database by reading in an array of <code>Vec.t</code> from disk and creating a corpus.</p><p>The function reads an array of document vectors with their associated file paths from disk using the <code>Vec.read_vectors_from_disk</code> function. It then creates a corpus and index using the <code>create_corpus</code> function.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">file</span> <p>is the file name used to read the array of document vectors from disk.</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p>a record of type <code>t</code> containing the matrix of vector representations <code>corpus</code> and the index mapping document indices to file paths.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_docs"><a href="#val-get_docs" class="anchor"></a><code><span><span class="keyword">val</span> get_docs : <span><span><a href="../../../../findlib-1/eio/Eio/Fs/index.html#type-dir_ty">Eio.Fs.dir_ty</a> <a href="../../../../findlib-1/eio/Eio/Path/index.html#type-t">Eio.Path.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>int array</span> <span class="arrow">&#45;&gt;</span></span> <span>string list</span></span></code></div><div class="spec-doc"><p><code>get_docs dir t indexs</code> reads the documents corresponding to the given indices from disk and returns an array of their contents.</p><p>The function retrieves the file paths of the documents using the index hash table in <code>t</code> and reads the contents of the documents from disk using the <code>Doc.load_prompt</code> function.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">[dir]</span> <p>is the directory for loading the documents.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">t</span> <p>is the vector database containing the corpus and index.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">indexs</span> <p>is an array of indices corresponding to the documents to be read from disk.</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p>an list of strings containing the contents of the documents read from disk.</p></li></ul></div></div></div></body></html>
